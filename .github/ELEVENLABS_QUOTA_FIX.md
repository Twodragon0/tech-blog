# ElevenLabs 크레딧 부족 문제 해결 가이드

## 🔍 발견된 문제

### ElevenLabs API 크레딧 부족 오류

**오류 메시지:**
```json
{
  "detail": {
    "status": "quota_exceeded",
    "message": "This request exceeds your API key (Twodragon) quota of 5. You have 5 credits remaining, while 1727 credits are required for this request."
  }
}
```

**문제 분석:**
- 필요 크레딧: 1,727 크레딧 (대본 1,727자)
- 남은 크레딧: 5 크레딧
- ElevenLabs 크레딧 = 문자 수 (1자 = 1 크레딧)

## ✅ 적용된 개선사항

### 1. 대본 길이 제한 감소
- **변경 전**: 최대 3,000자 (약 5분 분량)
- **변경 후**: 최대 800자 (약 3분 분량)
- 무료 티어 크레딧 제한 고려

### 2. 프롬프트 최적화
- 대본 생성 시 "간결하게", "핵심만" 강조
- 크레딧 절약을 위한 짧은 대본 요청
- 목표 길이: 500-700자 (최대 800자)

### 3. 에러 핸들링 개선
- 크레딧 부족 오류 감지 및 상세 메시지
- 해결 방법 안내 추가
- 사용량 확인 링크 제공

## 📊 ElevenLabs 크레딧 시스템

### 무료 티어
- **월간 크레딧**: 10,000 크레딧
- **크레딧 = 문자 수**: 1자 = 1 크레딧
- **예상 사용량**: 약 12-20개 짧은 대본 (500-800자)

### 크레딧 계산
- 대본 500자 = 500 크레딧
- 대본 800자 = 800 크레딧
- 대본 1,727자 = 1,727 크레딧 ❌ (무료 티어 초과)

## 🔧 해결 방법

### 방법 1: 대본 길이 제한 (적용됨)
- 최대 대본 길이를 800자로 제한
- 프롬프트에서 간결한 요약 요청
- ✅ 이미 적용 완료

### 방법 2: 크레딧 확인 및 관리
1. [ElevenLabs Usage](https://elevenlabs.io/app/usage)에서 크레딧 확인
2. 월간 사용량 모니터링
3. 크레딧이 충분할 때까지 대기

### 방법 3: 유료 플랜 업그레이드
- **Starter 플랜**: $5/월, 30,000 크레딧
- **Creator 플랜**: $22/월, 100,000 크레딧
- **Pro 플랜**: $99/월, 500,000 크레딧

### 방법 4: 대본 분할 처리
- 긴 포스트를 여러 부분으로 나누어 처리
- 각 부분을 별도로 오디오 생성
- 나중에 합성

## 📝 코드 변경 사항

### `scripts/generate_audio.py`

```python
# 대본 길이 제한 감소
MAX_SCRIPT_LENGTH = 800  # 3000 → 800

# 프롬프트 최적화
prompt = f"""...3분 내외의 간결한 강의 대본으로 요약해줘...
- 3분 내외 분량 (약 500-700자, 최대 800자)
- 크레딧 절약을 위해 가능한 한 짧게 작성"""

# 크레딧 부족 오류 처리
if detail.get("status") == "quota_exceeded":
    log_message(f"⚠️ ElevenLabs 크레딧 부족: {message}", "ERROR")
    log_message(f"💡 해결 방법 안내...", "ERROR")
```

## 🎯 예상 효과

1. **크레딧 사용량 감소**: 1,727 → 800 크레딧 (53% 감소)
2. **성공률 증가**: 무료 티어 내에서 처리 가능
3. **비용 효율성**: 월간 크레딧으로 더 많은 포스트 처리 가능

## ⚠️ 주의사항

1. **대본 길이**: 800자로 제한되어 내용이 간결해질 수 있음
2. **크레딧 모니터링**: 정기적으로 사용량 확인 필요
3. **월간 제한**: 무료 티어는 월 10,000 크레딧 제한

## 📊 크레딧 사용량 추정

### 개선 전
- 대본 1,727자 = 1,727 크레딧
- 월간 처리 가능: 약 5-6개 포스트

### 개선 후
- 대본 800자 = 800 크레딧
- 월간 처리 가능: 약 12-13개 포스트

## 🔗 관련 문서

- [Cost Management](./COST_MANAGEMENT.md)
- [ElevenLabs Setup](./ELEVENLABS_SETUP.md)
- [Workflow Improvements](./WORKFLOW_IMPROVEMENTS.md)
