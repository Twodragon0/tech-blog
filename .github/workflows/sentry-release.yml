name: Sentry Release

# Sentry Release ìƒì„± ì›Œí¬í”Œë¡œìš°
# Free í‹°ì–´ ìµœì í™”: í”„ë¡œë•ì…˜ ë°°í¬ ì‹œì—ë§Œ ì‹¤í–‰, ì†ŒìŠ¤ë§µ ì—…ë¡œë“œ ì œì™¸

on:
  push:
    branches:
      - main
    # íŠ¹ì • íŒŒì¼ ë³€ê²½ ì‹œì—ë§Œ ì‹¤í–‰ (ë¹„ìš© ì ˆê°)
    paths:
      - '_includes/**'
      - '_layouts/**'
      - '_posts/**'
      - 'assets/**'
      - '_config.yml'
      - 'vercel.json'
      - '.github/workflows/sentry-release.yml'
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

jobs:
  create-sentry-release:
    runs-on: ubuntu-latest
    # íƒ€ì„ì•„ì›ƒ ì„¤ì • (ë¬´í•œ ì‹¤í–‰ ë°©ì§€)
    timeout-minutes: 5
    # Free í‹°ì–´ì—ì„œëŠ” Release ìƒì„± ì‹¤íŒ¨ë¥¼ ì¹˜ëª…ì  ì˜¤ë¥˜ë¡œ ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ
    continue-on-error: true
    
    permissions:
      contents: read
      # Sentry Release ìƒì„±ì— í•„ìš”í•œ ìµœì†Œ ê¶Œí•œë§Œ
      
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # ì „ì²´ íˆìŠ¤í† ë¦¬ í•„ìš” (ì»¤ë°‹ ì •ë³´ ì¶”ì¶œ)
      
      - name: Verify Sentry Configuration
        env:
          SENTRY_AUTH_TOKEN: ${{ secrets.SENTRY_AUTH_TOKEN }}
          SENTRY_ORG: ${{ secrets.SENTRY_ORG || 'twodragon' }}
          SENTRY_PROJECT: ${{ secrets.SENTRY_PROJECT || 'tech-blog' }}
        run: |
          echo "ğŸ” Verifying Sentry configuration..."
          echo "Organization: $SENTRY_ORG"
          echo "Project: $SENTRY_PROJECT"
          
          # Token ì¡´ì¬ í™•ì¸
          if [ -z "$SENTRY_AUTH_TOKEN" ]; then
            echo "âŒ SENTRY_AUTH_TOKEN is not set in GitHub Secrets"
            echo ""
            echo "ğŸ’¡ í•´ê²° ë°©ë²•:"
            echo "1. Sentry ëŒ€ì‹œë³´ë“œì—ì„œ Auth Token ìƒì„±:"
            echo "   https://sentry.io/settings/account/api/auth-tokens/"
            echo "2. Token ìƒì„± ì‹œ ë‹¤ìŒ ê¶Œí•œ ì„ íƒ:"
            echo "   - project:read"
            echo "   - project:releases (í•„ìˆ˜!)"
            echo "   - org:read"
            echo "3. ìƒì„±ëœ Tokenì„ GitHub Secretsì— ì¶”ê°€:"
            echo "   ë°©ë²• 1 (GitHub CLI):"
            echo "   gh secret set SENTRY_AUTH_TOKEN --body \"your-token-here\""
            echo ""
            echo "   ë°©ë²• 2 (GitHub ì›¹ UI):"
            echo "   Settings > Secrets and variables > Actions > New repository secret"
            echo "   Name: SENTRY_AUTH_TOKEN"
            echo "   Value: [ìƒì„±í•œ Token]"
            echo ""
            echo "4. Token í˜•ì‹ í™•ì¸:"
            echo "   - sntryu_ë¡œ ì‹œì‘í•˜ëŠ” ì¼ë°˜ Token"
            echo "   - sentry-releaseë¡œ ì‹œì‘í•˜ëŠ” Release ì „ìš© Token"
            exit 1
          fi
          
          # Token í˜•ì‹ í™•ì¸ (ë³´ì•ˆ: ì „ì²´ ê°’ì€ ì¶œë ¥í•˜ì§€ ì•ŠìŒ)
          TOKEN_PREFIX="${SENTRY_AUTH_TOKEN:0:15}"
          echo "Token prefix: ${TOKEN_PREFIX}... (ë³´ì•ˆìƒ ì „ì²´ ê°’ì€ í‘œì‹œí•˜ì§€ ì•ŠìŒ)"
          
          # Token í˜•ì‹ í™•ì¸ (sntryu_ ë˜ëŠ” sentry-releaseë¡œ ì‹œì‘)
          if [[ ! "$SENTRY_AUTH_TOKEN" =~ ^(sntryu_|sentry-release) ]]; then
            echo "âš ï¸  Token í˜•ì‹ í™•ì¸: sntryu_ ë˜ëŠ” sentry-releaseë¡œ ì‹œì‘í•´ì•¼ í•©ë‹ˆë‹¤"
            echo "   í˜„ì¬ Token ì ‘ë‘ì‚¬: ${SENTRY_AUTH_TOKEN:0:20}..."
            echo "   Token í˜•ì‹ì€ ìœ íš¨í•  ìˆ˜ ìˆì§€ë§Œ, ì¼ë°˜ì ì¸ í˜•ì‹ê³¼ ë‹¤ë¦…ë‹ˆë‹¤"
          else
            echo "âœ… Token í˜•ì‹ í™•ì¸ ì™„ë£Œ"
          fi
          
          # Sentry API ì—°ê²° í…ŒìŠ¤íŠ¸ (í”„ë¡œì íŠ¸ ì •ë³´ ì¡°íšŒ)
          echo "ğŸ”— Testing Sentry API connection..."
          RESPONSE=$(curl -s -w "\n%{http_code}" \
            -H "Authorization: Bearer $SENTRY_AUTH_TOKEN" \
            -H "Content-Type: application/json" \
            "https://sentry.io/api/0/projects/$SENTRY_ORG/$SENTRY_PROJECT/")
          
          HTTP_CODE=$(echo "$RESPONSE" | tail -n1)
          BODY=$(echo "$RESPONSE" | sed '$d')
          
          if [ "$HTTP_CODE" = "200" ]; then
            echo "âœ… Successfully connected to Sentry API"
            echo "âœ… Project access verified"
            
            # Token ê¶Œí•œ í™•ì¸ (releases API í…ŒìŠ¤íŠ¸)
            echo "ğŸ” Checking token permissions for releases..."
            RELEASE_TEST_CODE=$(curl -s -o /dev/null -w "%{http_code}" \
              -H "Authorization: Bearer $SENTRY_AUTH_TOKEN" \
              -H "Content-Type: application/json" \
              -X GET \
              "https://sentry.io/api/0/projects/$SENTRY_ORG/$SENTRY_PROJECT/releases/")
            
            if [ "$RELEASE_TEST_CODE" = "200" ] || [ "$RELEASE_TEST_CODE" = "404" ]; then
              echo "âœ… Token has 'project:releases' permission"
            elif [ "$RELEASE_TEST_CODE" = "403" ]; then
              echo "âŒ Token lacks 'project:releases' permission (HTTP 403)"
              echo ""
              echo "ğŸ’¡ í•´ê²° ë°©ë²•:"
              echo "1. Sentry ëŒ€ì‹œë³´ë“œì—ì„œ ê¸°ì¡´ Token ìˆ˜ì • ë˜ëŠ” ìƒˆ Token ìƒì„±:"
              echo "   https://sentry.io/settings/account/api/auth-tokens/"
              echo "2. Token ìƒì„±/ìˆ˜ì • ì‹œ ë‹¤ìŒ ê¶Œí•œì„ ë°˜ë“œì‹œ ì„ íƒ:"
              echo "   âœ… project:read"
              echo "   âœ… project:releases (í•„ìˆ˜!)"
              echo "   âœ… org:read"
              echo "3. ìƒˆ Tokenì„ GitHub Secretsì— ì—…ë°ì´íŠ¸:"
              echo "   Settings > Secrets and variables > Actions > SENTRY_AUTH_TOKEN > Update"
              exit 1
            else
              echo "âš ï¸  Unexpected response when checking releases permission (HTTP $RELEASE_TEST_CODE)"
            fi
          elif [ "$HTTP_CODE" = "401" ]; then
            echo "âŒ Authentication failed (HTTP 401)"
            echo "   Tokenì´ ìœ íš¨í•˜ì§€ ì•Šê±°ë‚˜ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤."
            echo ""
            echo "ğŸ’¡ í•´ê²° ë°©ë²•:"
            echo "1. Sentry ëŒ€ì‹œë³´ë“œì—ì„œ ìƒˆ Token ìƒì„±:"
            echo "   https://sentry.io/settings/account/api/auth-tokens/"
            echo "2. GitHub Secretsì˜ SENTRY_AUTH_TOKEN ì—…ë°ì´íŠ¸"
            exit 1
          elif [ "$HTTP_CODE" = "403" ]; then
            echo "âŒ Access denied (HTTP 403)"
            echo "   Tokenì— í”„ë¡œì íŠ¸ ì ‘ê·¼ ê¶Œí•œì´ ì—†ê±°ë‚˜ Organization/Project ì´ë¦„ì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤."
            echo ""
            
            # Tokenìœ¼ë¡œ ì ‘ê·¼ ê°€ëŠ¥í•œ Organization ëª©ë¡ ì¡°íšŒ
            echo "ğŸ” Discovering accessible organizations..."
            ORG_RESPONSE=$(curl -s -w "\n%{http_code}" \
              -H "Authorization: Bearer $SENTRY_AUTH_TOKEN" \
              -H "Content-Type: application/json" \
              "https://sentry.io/api/0/organizations/")
            
            ORG_HTTP_CODE=$(echo "$ORG_RESPONSE" | tail -n1)
            ORG_BODY=$(echo "$ORG_RESPONSE" | sed '$d')
            
            if [ "$ORG_HTTP_CODE" = "200" ]; then
              echo "âœ… Tokenìœ¼ë¡œ ì ‘ê·¼ ê°€ëŠ¥í•œ Organizations:"
              echo "$ORG_BODY" | jq -r '.[] | "   - \(.slug) (ID: \(.id))"' 2>/dev/null || echo "$ORG_BODY"
              echo ""
              
              # ì²« ë²ˆì§¸ Organizationì˜ Projects ì¡°íšŒ ì‹œë„
              FIRST_ORG=$(echo "$ORG_BODY" | jq -r '.[0].slug' 2>/dev/null)
              if [ -n "$FIRST_ORG" ] && [ "$FIRST_ORG" != "null" ]; then
                echo "ğŸ” Discovering projects in organization: $FIRST_ORG"
                PROJ_RESPONSE=$(curl -s -w "\n%{http_code}" \
                  -H "Authorization: Bearer $SENTRY_AUTH_TOKEN" \
                  -H "Content-Type: application/json" \
                  "https://sentry.io/api/0/organizations/$FIRST_ORG/projects/")
                
                PROJ_HTTP_CODE=$(echo "$PROJ_RESPONSE" | tail -n1)
                PROJ_BODY=$(echo "$PROJ_RESPONSE" | sed '$d')
                
                if [ "$PROJ_HTTP_CODE" = "200" ]; then
                  echo "âœ… Projects in '$FIRST_ORG':"
                  echo "$PROJ_BODY" | jq -r '.[] | "   - \(.slug) (ID: \(.id))"' 2>/dev/null || echo "$PROJ_BODY"
                  echo ""
                fi
              fi
            elif [ "$ORG_HTTP_CODE" = "403" ]; then
              echo "âŒ Tokenì— 'org:read' ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤."
            else
              echo "âš ï¸  Organization ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨ (HTTP $ORG_HTTP_CODE)"
            fi
            
            echo "ğŸ’¡ í•´ê²° ë°©ë²•:"
            echo "1. Sentry ëŒ€ì‹œë³´ë“œì—ì„œ Token ê¶Œí•œ í™•ì¸/ìˆ˜ì •:"
            echo "   https://sentry.io/settings/account/api/auth-tokens/"
            echo "2. ë‹¤ìŒ ê¶Œí•œì´ ì„ íƒë˜ì–´ ìˆëŠ”ì§€ í™•ì¸:"
            echo "   âœ… project:read (í•„ìˆ˜!)"
            echo "   âœ… project:releases (í•„ìˆ˜!)"
            echo "   âœ… org:read (ê¶Œì¥, Organization ëª©ë¡ ì¡°íšŒìš©)"
            echo "3. ìœ„ì— í‘œì‹œëœ Organization ë° Project ì´ë¦„ì„ í™•ì¸í•˜ê³ ,"
            echo "   ì›Œí¬í”Œë¡œìš°ì˜ SENTRY_ORGì™€ SENTRY_PROJECT ê°’ì„ ì—…ë°ì´íŠ¸í•˜ì„¸ìš”:"
            echo "   í˜„ì¬ ì„¤ì •:"
            echo "   - SENTRY_ORG: $SENTRY_ORG"
            echo "   - SENTRY_PROJECT: $SENTRY_PROJECT"
            echo ""
            echo "4. ë˜ëŠ” GitHub Secretsì— Organization/Project ì´ë¦„ì„ ì¶”ê°€:"
            echo "   gh secret set SENTRY_ORG --body \"your-org-slug\""
            echo "   gh secret set SENTRY_PROJECT --body \"your-project-slug\""
            exit 1
          elif [ "$HTTP_CODE" = "404" ]; then
            echo "âŒ Project not found (HTTP 404)"
            echo "   Organization ë˜ëŠ” Project ì´ë¦„ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."
            echo ""
            
            # Tokenìœ¼ë¡œ ì ‘ê·¼ ê°€ëŠ¥í•œ Organization ëª©ë¡ ì¡°íšŒ
            echo "ğŸ” Discovering accessible organizations..."
            ORG_RESPONSE=$(curl -s -w "\n%{http_code}" \
              -H "Authorization: Bearer $SENTRY_AUTH_TOKEN" \
              -H "Content-Type: application/json" \
              "https://sentry.io/api/0/organizations/")
            
            ORG_HTTP_CODE=$(echo "$ORG_RESPONSE" | tail -n1)
            ORG_BODY=$(echo "$ORG_RESPONSE" | sed '$d')
            
            if [ "$ORG_HTTP_CODE" = "200" ]; then
              echo "âœ… Tokenìœ¼ë¡œ ì ‘ê·¼ ê°€ëŠ¥í•œ Organizations:"
              echo "$ORG_BODY" | jq -r '.[] | "   - \(.slug) (ID: \(.id))"' 2>/dev/null || echo "$ORG_BODY"
              echo ""
              
              # ê° Organizationì˜ Projects ì¡°íšŒ
              ORG_SLUGS=$(echo "$ORG_BODY" | jq -r '.[].slug' 2>/dev/null)
              if [ -n "$ORG_SLUGS" ]; then
                for ORG_SLUG in $ORG_SLUGS; do
                  if [ "$ORG_SLUG" != "null" ] && [ -n "$ORG_SLUG" ]; then
                    echo "ğŸ” Discovering projects in organization: $ORG_SLUG"
                    PROJ_RESPONSE=$(curl -s -w "\n%{http_code}" \
                      -H "Authorization: Bearer $SENTRY_AUTH_TOKEN" \
                      -H "Content-Type: application/json" \
                      "https://sentry.io/api/0/organizations/$ORG_SLUG/projects/")
                    
                    PROJ_HTTP_CODE=$(echo "$PROJ_RESPONSE" | tail -n1)
                    PROJ_BODY=$(echo "$PROJ_RESPONSE" | sed '$d')
                    
                    if [ "$PROJ_HTTP_CODE" = "200" ]; then
                      PROJ_COUNT=$(echo "$PROJ_BODY" | jq 'length' 2>/dev/null || echo "0")
                      if [ "$PROJ_COUNT" -gt 0 ]; then
                        echo "âœ… Projects in '$ORG_SLUG':"
                        echo "$PROJ_BODY" | jq -r '.[] | "   - \(.slug) (ID: \(.id))"' 2>/dev/null || echo "$PROJ_BODY"
                        echo ""
                      else
                        echo "   â„¹ï¸  No projects found in this organization"
                        echo ""
                      fi
                    elif [ "$PROJ_HTTP_CODE" = "403" ]; then
                      echo "   âš ï¸  No permission to list projects in this organization"
                      echo ""
                    fi
                  fi
                done
              fi
            elif [ "$ORG_HTTP_CODE" = "403" ]; then
              echo "âŒ Tokenì— 'org:read' ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤."
              echo "   Organization ëª©ë¡ì„ ì¡°íšŒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
              echo ""
            else
              echo "âš ï¸  Organization ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨ (HTTP $ORG_HTTP_CODE)"
              echo ""
            fi
            
            echo "ğŸ’¡ í•´ê²° ë°©ë²•:"
            echo ""
            echo "ğŸ“‹ í”„ë¡œì íŠ¸ê°€ ì—†ëŠ” ê²½ìš°:"
            echo "1. Sentry ëŒ€ì‹œë³´ë“œì—ì„œ í”„ë¡œì íŠ¸ ìƒì„±:"
            echo "   https://sentry.io/organizations/$SENTRY_ORG/projects/new/"
            echo ""
            echo "2. í”„ë¡œì íŠ¸ ìƒì„± ì‹œ:"
            echo "   - Platform: JavaScript ì„ íƒ"
            echo "   - Project Name: tech-blog (ë˜ëŠ” ì›í•˜ëŠ” ì´ë¦„)"
            echo "   - Project SlugëŠ” ìë™ ìƒì„±ë˜ì§€ë§Œ, 'tech-blog'ë¡œ ì„¤ì • ê¶Œì¥"
            echo ""
            echo "ğŸ“‹ í”„ë¡œì íŠ¸ê°€ ì´ë¯¸ ìˆëŠ” ê²½ìš°:"
            echo "1. ìœ„ì— í‘œì‹œëœ Organization ë° Project ì´ë¦„ì„ í™•ì¸í•˜ì„¸ìš”"
            echo "2. GitHub Secretsì— ì˜¬ë°”ë¥¸ ê°’ì„ ì„¤ì •:"
            echo "   - SENTRY_ORG: Organization slug (í˜„ì¬: $SENTRY_ORG)"
            echo "   - SENTRY_PROJECT: Project slug (í˜„ì¬: $SENTRY_PROJECT)"
            echo ""
            echo "3. GitHub CLIë¡œ ì„¤ì •í•˜ëŠ” ë°©ë²•:"
            echo "   gh secret set SENTRY_ORG --body \"$SENTRY_ORG\""
            echo "   gh secret set SENTRY_PROJECT --body \"ì‹¤ì œ-í”„ë¡œì íŠ¸-slug\""
            echo ""
            echo "4. ë˜ëŠ” GitHub ì›¹ UIì—ì„œ ì„¤ì •:"
            echo "   Settings > Secrets and variables > Actions > New repository secret"
            echo ""
            echo "5. Sentry ëŒ€ì‹œë³´ë“œì—ì„œ í”„ë¡œì íŠ¸ ëª©ë¡ í™•ì¸:"
            echo "   https://sentry.io/organizations/$SENTRY_ORG/projects/"
            echo ""
            echo "6. í”„ë¡œì íŠ¸ ì„¤ì •ì—ì„œ ì •í™•í•œ Slug í™•ì¸:"
            echo "   Project Settings > General > Project Slug"
            exit 1
          else
            echo "âš ï¸  Unexpected response (HTTP $HTTP_CODE)"
            if [ -n "$BODY" ]; then
              echo "Response: $BODY"
            fi
          fi
      
      - name: Check if Release Exists
        id: check_release
        env:
          SENTRY_AUTH_TOKEN: ${{ secrets.SENTRY_AUTH_TOKEN }}
          SENTRY_ORG: ${{ secrets.SENTRY_ORG || 'twodragon' }}
          SENTRY_PROJECT: ${{ secrets.SENTRY_PROJECT || 'tech-blog' }}
        run: |
          RELEASE_VERSION="${{ github.sha }}"
          echo "ğŸ” Checking if release $RELEASE_VERSION already exists..."
          
          HTTP_CODE=$(curl -s -o /dev/null -w "%{http_code}" \
            -H "Authorization: Bearer $SENTRY_AUTH_TOKEN" \
            -H "Content-Type: application/json" \
            "https://sentry.io/api/0/projects/$SENTRY_ORG/$SENTRY_PROJECT/releases/$RELEASE_VERSION/")
          
          if [ "$HTTP_CODE" = "200" ]; then
            echo "â„¹ï¸  Release $RELEASE_VERSION already exists"
            echo "exists=true" >> $GITHUB_OUTPUT
          elif [ "$HTTP_CODE" = "404" ]; then
            echo "âœ… Release $RELEASE_VERSION does not exist, will create new"
            echo "exists=false" >> $GITHUB_OUTPUT
          else
            echo "âš ï¸  Unexpected response (HTTP $HTTP_CODE), will attempt to create"
            echo "exists=false" >> $GITHUB_OUTPUT
          fi
      
      - name: Create Sentry Release
        id: create_release
        if: steps.check_release.outputs.exists != 'true'
        # Free í‹°ì–´ ìµœì í™”: ì†ŒìŠ¤ë§µ ì—…ë¡œë“œ ì œì™¸ (ë¹„ìš© ì ˆê°)
        continue-on-error: true
        uses: getsentry/action-release@v1
        env:
          # GitHub Secretsì— ì €ì¥ í•„ìš”
          SENTRY_AUTH_TOKEN: ${{ secrets.SENTRY_AUTH_TOKEN }}
          SENTRY_ORG: ${{ secrets.SENTRY_ORG || 'twodragon' }}
          SENTRY_PROJECT: ${{ secrets.SENTRY_PROJECT || 'tech-blog' }}
          # ë””ë²„ê·¸ ë¡œê·¸ í™œì„±í™” (ë¬¸ì œ í•´ê²°ìš©)
          SENTRY_LOG_LEVEL: debug
        with:
          environment: production
          version: ${{ github.sha }}
          # Free í‹°ì–´ ìµœì í™”: ì†ŒìŠ¤ë§µ ì œì™¸ (Jekyll ì •ì  ì‚¬ì´íŠ¸ì´ë¯€ë¡œ ë¶ˆí•„ìš”)
          sourcemaps: false
          # ì»¤ë°‹ ì •ë³´ë§Œ ì¶”ì  (ë¹„ìš© ì ˆê°)
          set_commits: auto
          # GitHub í†µí•©ì„ í†µí•œ ì»¤ë°‹ ì •ë³´ ìë™ ì—°ê²°
          ignore_missing: true
          # ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë¦´ë¦¬ìŠ¤ ë¬´ì‹œ
          ignore_empty: true
          # Free í‹°ì–´ ìµœì í™”: ìµœì†Œí•œì˜ ì •ë³´ë§Œ ì „ì†¡
          finalize: true
      
      - name: Handle Release Creation Result
        id: handle_release
        if: always() && steps.create_release.outcome != 'success'
        env:
          SENTRY_AUTH_TOKEN: ${{ secrets.SENTRY_AUTH_TOKEN }}
          SENTRY_ORG: ${{ secrets.SENTRY_ORG || 'twodragon' }}
          SENTRY_PROJECT: ${{ secrets.SENTRY_PROJECT || 'tech-blog' }}
        run: |
          RELEASE_VERSION="${{ github.sha }}"
          echo "âš ï¸  Release creation had issues, checking final status..."
          
          # ìµœì¢… ìƒíƒœ í™•ì¸ (ì¬ì‹œë„ ë¡œì§ í¬í•¨)
          MAX_RETRIES=3
          RETRY_COUNT=0
          HTTP_CODE=0
          
          while [ $RETRY_COUNT -lt $MAX_RETRIES ]; do
            sleep $((RETRY_COUNT + 1))  # ì ì§„ì  ëŒ€ê¸° (1ì´ˆ, 2ì´ˆ, 3ì´ˆ)
            
            HTTP_CODE=$(curl -s -o /dev/null -w "%{http_code}" \
              -H "Authorization: Bearer $SENTRY_AUTH_TOKEN" \
              -H "Content-Type: application/json" \
              "https://sentry.io/api/0/projects/$SENTRY_ORG/$SENTRY_PROJECT/releases/$RELEASE_VERSION/")
            
            if [ "$HTTP_CODE" = "200" ]; then
              echo "âœ… Release $RELEASE_VERSION exists (created successfully)"
              echo "âœ… Continuing workflow..."
              echo "success=true" >> $GITHUB_OUTPUT
              exit 0
            fi
            
            RETRY_COUNT=$((RETRY_COUNT + 1))
            echo "âš ï¸  Retry $RETRY_COUNT/$MAX_RETRIES: Release not found (HTTP $HTTP_CODE)"
          done
          
          # ëª¨ë“  ì¬ì‹œë„ ì‹¤íŒ¨ ì‹œ
          echo "âŒ Release $RELEASE_VERSION does not exist after $MAX_RETRIES retries"
          echo "âŒ HTTP Status: $HTTP_CODE"
          echo ""
          echo "Common issues:"
          echo "1. Token lacks 'project:releases' permission"
          echo "2. Organization or project name mismatch"
          echo "3. Rate limiting (free tier) - Sentry Free í‹°ì–´ëŠ” ì›” 5,000 ì´ë²¤íŠ¸ ì œí•œ"
          echo "4. Network/API issues"
          echo ""
          echo "ğŸ’¡ í•´ê²° ë°©ë²•:"
          echo "- Free í‹°ì–´ ì œí•œ ë‚´ì—ì„œ ìš´ì˜ ì¤‘ì´ë©´ Release ìƒì„± ì‹¤íŒ¨ëŠ” ì •ìƒì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤"
          echo "- ì›Œí¬í”Œë¡œìš°ëŠ” ê³„ì† ì§„í–‰ë˜ì§€ë§Œ ReleaseëŠ” ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤"
          echo "success=false" >> $GITHUB_OUTPUT
          # Free í‹°ì–´ì—ì„œëŠ” Release ìƒì„± ì‹¤íŒ¨ë¥¼ ì¹˜ëª…ì  ì˜¤ë¥˜ë¡œ ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ
          exit 0
      
      - name: Output Release Info
        if: always()
        continue-on-error: true
        env:
          SENTRY_AUTH_TOKEN: ${{ secrets.SENTRY_AUTH_TOKEN }}
          SENTRY_ORG: ${{ secrets.SENTRY_ORG || 'twodragon' }}
          SENTRY_PROJECT: ${{ secrets.SENTRY_PROJECT || 'tech-blog' }}
        run: |
          RELEASE_VERSION="${{ github.sha }}"
          
          # ìµœì¢… ë¦´ë¦¬ìŠ¤ ì¡´ì¬ ì—¬ë¶€ í™•ì¸ (ì¬ì‹œë„ í¬í•¨)
          MAX_RETRIES=2
          RETRY_COUNT=0
          HTTP_CODE=0
          
          while [ $RETRY_COUNT -lt $MAX_RETRIES ]; do
            HTTP_CODE=$(curl -s -o /dev/null -w "%{http_code}" \
              -H "Authorization: Bearer $SENTRY_AUTH_TOKEN" \
              -H "Content-Type: application/json" \
              "https://sentry.io/api/0/projects/$SENTRY_ORG/$SENTRY_PROJECT/releases/$RELEASE_VERSION/")
            
            if [ "$HTTP_CODE" = "200" ]; then
              break
            fi
            
            if [ $RETRY_COUNT -lt $((MAX_RETRIES - 1)) ]; then
              sleep 2
              RETRY_COUNT=$((RETRY_COUNT + 1))
            else
              break
            fi
          done
          
          if [ "$HTTP_CODE" = "200" ]; then
            if [ "${{ steps.check_release.outputs.exists }}" = "true" ]; then
              echo "â„¹ï¸  Sentry Release already existed"
            else
              echo "âœ… Sentry Release created successfully"
            fi
            echo ""
            echo "Release: $RELEASE_VERSION"
            echo "Environment: production"
            echo "Project: tech-blog"
            echo "Org: twodragon"
            echo ""
            echo "View release: https://sentry.io/organizations/twodragon/releases/$RELEASE_VERSION/"
          else
            echo "âš ï¸  Sentry Release not found (HTTP $HTTP_CODE)"
            echo "Release: $RELEASE_VERSION"
            echo "HTTP Status: $HTTP_CODE"
            echo ""
            echo "ğŸ’¡ ì°¸ê³ :"
            echo "- Free í‹°ì–´ ì œí•œìœ¼ë¡œ ì¸í•´ Release ìƒì„±ì´ ì‹¤íŒ¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤"
            echo "- ì´ëŠ” ì›Œí¬í”Œë¡œìš° ì‹¤íŒ¨ë¡œ ì²˜ë¦¬ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤ (continue-on-error)"
            echo "- Releaseê°€ ì—†ì–´ë„ Sentry ë¡œê·¸ ìˆ˜ì§‘ì€ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤"
            echo "- ì›Œí¬í”Œë¡œìš°ëŠ” ì„±ê³µìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤"
          fi
