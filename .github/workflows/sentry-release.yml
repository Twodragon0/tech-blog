name: Sentry Release

# Sentry Release ìƒì„± ì›Œí¬í”Œë¡œìš°
# Free í‹°ì–´ ìµœì í™”: í”„ë¡œë•ì…˜ ë°°í¬ ì‹œì—ë§Œ ì‹¤í–‰, ì†ŒìŠ¤ë§µ ì—…ë¡œë“œ ì œì™¸

on:
  push:
    branches:
      - main
    # íŠ¹ì • íŒŒì¼ ë³€ê²½ ì‹œì—ë§Œ ì‹¤í–‰ (ë¹„ìš© ì ˆê°)
    paths:
      - '_includes/**'
      - '_layouts/**'
      - '_posts/**'
      - 'assets/**'
      - '_config.yml'
      - 'vercel.json'
      - '.github/workflows/sentry-release.yml'
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

jobs:
  create-sentry-release:
    runs-on: ubuntu-latest
    # íƒ€ì„ì•„ì›ƒ ì„¤ì • (ë¬´í•œ ì‹¤í–‰ ë°©ì§€)
    timeout-minutes: 5
    
    permissions:
      contents: read
      # Sentry Release ìƒì„±ì— í•„ìš”í•œ ìµœì†Œ ê¶Œí•œë§Œ
      
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # ì „ì²´ íˆìŠ¤í† ë¦¬ í•„ìš” (ì»¤ë°‹ ì •ë³´ ì¶”ì¶œ)
      
      - name: Verify Sentry Configuration
        env:
          SENTRY_AUTH_TOKEN: ${{ secrets.SENTRY_AUTH_TOKEN }}
          SENTRY_ORG: twodragon
          SENTRY_PROJECT: tech-blog
        run: |
          echo "ğŸ” Verifying Sentry configuration..."
          echo "Organization: $SENTRY_ORG"
          echo "Project: $SENTRY_PROJECT"
          echo "Token: ${SENTRY_AUTH_TOKEN:0:10}..." # ì²« 10ìë§Œ í‘œì‹œ
          
          # Sentry CLIë¡œ í”„ë¡œì íŠ¸ í™•ì¸ (ë””ë²„ê·¸ ëª¨ë“œ)
          if command -v sentry-cli &> /dev/null; then
            echo "Checking project access..."
            sentry-cli projects list --org $SENTRY_ORG 2>&1 || echo "sentry-cli not available in runner"
          fi
      
      - name: Create Sentry Release
        # Free í‹°ì–´ ìµœì í™”: ì†ŒìŠ¤ë§µ ì—…ë¡œë“œ ì œì™¸ (ë¹„ìš© ì ˆê°)
        uses: getsentry/action-release@v1
        env:
          # GitHub Secretsì— ì €ì¥ í•„ìš”
          SENTRY_AUTH_TOKEN: ${{ secrets.SENTRY_AUTH_TOKEN }}
          SENTRY_ORG: twodragon
          SENTRY_PROJECT: tech-blog
          # ë””ë²„ê·¸ ë¡œê·¸ í™œì„±í™” (ë¬¸ì œ í•´ê²°ìš©)
          SENTRY_LOG_LEVEL: debug
        with:
          environment: production
          version: ${{ github.sha }}
          # Free í‹°ì–´ ìµœì í™”: ì†ŒìŠ¤ë§µ ì œì™¸ (Jekyll ì •ì  ì‚¬ì´íŠ¸ì´ë¯€ë¡œ ë¶ˆí•„ìš”)
          sourcemaps: false
          # ì»¤ë°‹ ì •ë³´ë§Œ ì¶”ì  (ë¹„ìš© ì ˆê°)
          set_commits: auto
          # GitHub í†µí•©ì„ í†µí•œ ì»¤ë°‹ ì •ë³´ ìë™ ì—°ê²°
          ignore_missing: true
      
      - name: Output Release Info
        if: success()
        run: |
          echo "âœ… Sentry Release created successfully"
          echo "Release: ${{ github.sha }}"
          echo "Environment: production"
          echo "Project: tech-blog"
          echo "Org: twodragon"
