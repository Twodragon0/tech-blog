---
layout: post
title: "클라우드 보안 과정 7기 - 4주차 AWS 취약점 점검 및 ISMS 대응 가이드"
date: 2025-05-09 17:35:20 +0900
categories: [cloud]
tags: [AWS, ISMS, Vulnerability, Compliance]
excerpt: "AWS 취약점 점검 및 ISMS-P 대응 가이드. Inspector, GuardDuty, Security Hub 활용 및 인증 준비 실무 정리."
comments: true
original_url: https://twodragon.tistory.com/682
image: /assets/images/2025-05-09-Cloud_Security_Course_7Batch_-_4Week_AWS_Vulnerability_Inspection_and_ISMS_Response_Guide.svg
image_alt: "Cloud Security Course 7Batch 4Week: AWS Vulnerability Inspection and ISMS Response Guide"
toc: true
description: 클라우드 보안 7기 4주차. AWS 취약점 점검 도구(Inspector, Security Hub, GuardDuty), ISMS-P 인증 대응, AWS re:Invent 2025 보안 발표(Security Agent, IAM Policy Autopilot), AI 보안 솔루션 실무 정리.
keywords: [AWS, ISMS-P, Inspector, Security-Hub, GuardDuty, 취약점점검, Compliance, Security-Agent, IAM-Policy-Autopilot, 보안인증]
author: "Yongho Ha"
certifications: [isms-p, aws-saa]
schema_type: Article
---

<div class="ai-summary-card">
<div class="ai-summary-header">
  <span class="ai-badge">AI 요약</span>
</div>
<div class="ai-summary-content">
  <div class="summary-row">
    <span class="summary-label">제목</span>
    <span class="summary-value">클라우드 보안 과정 7기 - 4주차 AWS 취약점 점검 및 ISMS 대응 가이드</span>
  </div>
  <div class="summary-row">
    <span class="summary-label">카테고리</span>
    <span class="summary-value"><span class="category-tag cloud">Cloud</span></span>
  </div>
  <div class="summary-row">
    <span class="summary-label">태그</span>
    <span class="summary-value tags">
      <span class="tag">AWS</span>
      <span class="tag">ISMS</span>
      <span class="tag">Vulnerability</span>
      <span class="tag">Compliance</span>
    </span>
  </div>
  <div class="summary-row highlights">
    <span class="summary-label">핵심 내용</span>
    <ul class="summary-list">
      <li><strong>AWS 취약점 점검 도구</strong>: Security Hub(통합 보안 관리), Inspector(EC2/ECR/EC2/Lambda 취약점 스캔), Trusted Advisor(비용/성능/보안 권장사항), GuardDuty(위협 탐지), Config(컴플라이언스 규칙 자동 점검)</li>
      <li><strong>ISMS-P 인증 대응</strong>: 보안 감사 프로세스, 컴플라이언스 대응 전략, AWS Artifact(보안 문서 확보), AWS Config Rules(컴플라이언스 규칙 자동 점검), Security Hub(보안 표준 준수 현황 통합 관리), CloudTrail(감사 로그 수집 및 보관)</li>
      <li><strong>AWS re:Invent 2025 보안 발표</strong>: AWS Security Agent(자동화된 보안 리뷰, 컨텍스트 인식 침투 테스트), GuardDuty Extended Threat Detection(2개 새로운 공격 시퀀스 탐지), GuardDuty Malware Protection for AWS Backup(증분 스캔), Security Hub GA 업데이트(보안 위험 중앙 집중화, 히스토리 트렌드, 노출 요약, 커스텀 위젯), IAM Policy Autopilot(AI 기반 IAM 정책 자동 생성)</li>
      <li><strong>실무 보안 역량 강화</strong>: 20분 강의 + 5분 휴식 루틴, 취약점 스캔 자동화, ISMS 통제항목 매핑, 보안 개선 추이 증빙, 감사 대응 대시보드 구성</li>
      <li><strong>AI 보안 솔루션</strong>: AgentCore Identity(AI 에이전트용 인증), Third-party 보안 통합(SentinelOne, Salt Security, HiddenLayer), aws login 명령어(브라우저 기반 CLI 인증, SSO 연동)</li>
    </ul>
  </div>
  <div class="summary-row">
    <span class="summary-label">기술/도구</span>
    <span class="summary-value">AWS, ISMS-P, Vulnerability Assessment</span>
  </div>
  <div class="summary-row">
    <span class="summary-label">대상 독자</span>
    <span class="summary-value">클라우드 아키텍트, DevOps 엔지니어, 클라우드 관리자</span>
  </div>
</div>
<div class="ai-summary-footer">
  이 포스팅은 AI가 쉽게 이해하고 활용할 수 있도록 구조화된 요약을 포함합니다.
</div>
</div>

## Executive Summary

### 보안 현황 스코어카드

| 평가 항목 | 현황 | 목표 | 개선 필요 |
|---------|-----|-----|----------|
| **취약점 탐지 자동화** | 80% | 95% | Inspector 전체 EC2 적용 |
| **ISMS-P 통제 준수** | 75% | 90% | Config Rules 추가 |
| **보안 가시성** | 70% | 95% | Security Hub 통합 |
| **위협 탐지 정확도** | 85% | 95% | GuardDuty 룰 튜닝 |
| **감사 로그 보존** | 90% | 100% | CloudTrail 장기 보관 |
| **IAM 최소 권한** | 65% | 90% | Policy Autopilot 도입 |

**핵심 개선 과제:**
1. AWS Inspector 전체 워크로드 스캔 활성화 (현재 커버리지 80% → 목표 95%)
2. ISMS-P 64개 통제항목 중 48개 완료, 16개 보완 필요
3. Security Hub 통합 대시보드 구축 (현재 개별 서비스 확인 → 중앙 관리)
4. IAM 과도 권한 정책 58개 발견 → Policy Autopilot으로 최적화

### 이번 주차 학습 목표

이번 4주차는 AWS 클라우드 환경에서 **취약점 점검 자동화**와 **ISMS-P 인증 대응**을 실전처럼 수행하는 것을 목표로 합니다. 단순한 이론이 아닌, 실제 감사 상황에서 요구되는 증적 수집, 통제 매핑, 경영진 보고까지 전 과정을 다룹니다.

**실무 중심 학습:**
- AWS 보안 서비스 5종 (Inspector, GuardDuty, Security Hub, Config, Trusted Advisor) 통합 운영
- ISMS-P 인증 64개 통제항목 중 AWS 관련 32개 핵심 통제 매핑
- 취약점 관리 프로세스 (탐지 → 분류 → 대응 → 보고) 전체 사이클
- 한국 규제 대응 (개인정보보호법, 전자금융거래법, 정보통신망법)

### 경영진 보고 형식

**보안 위험 요약 (한 페이지)**

```
보안 현황 종합 리포트
기준일: 2025년 5월 9일

[1] 전체 보안 위험 레벨: MEDIUM (5개 HIGH, 23개 MEDIUM, 47개 LOW)

[2] 즉시 조치 필요 (HIGH 위험 5건)
  - EC2 인스턴스 15대 공개 노출 (0.0.0.0/0 허용)
  - RDS 암호화 미적용 DB 3개
  - CloudTrail 로그 90일 이상 보관 미설정
  - IAM 루트 계정 MFA 미설정
  - S3 버킷 퍼블릭 액세스 차단 미설정 7건

[3] ISMS-P 인증 준비 현황: 75% 완료 (48/64 통제항목)

[4] 예상 투자 비용
  - 취약점 조치: 월 $2,000 (EC2 보안그룹 재설정, RDS 암호화 활성화)
  - 로깅 장기 보관: 월 $500 (S3 Glacier 이전)
  - 총 예상 비용: 월 $2,500

[5] 조치 일정
  - 1주차: HIGH 위험 5건 완전 제거
  - 2-3주차: MEDIUM 위험 23건 중 우선순위 상위 10건 조치
  - 4주차: ISMS-P 인증 잔여 16개 통제항목 보완

[6] 비즈니스 영향
  - 정보 유출 시 예상 손실: 평균 57억원 (한국인터넷진흥원 2024 통계)
  - 개인정보보호법 위반 시 매출의 3% 또는 최대 5억원 과징금
  - 고객 신뢰도 저하로 인한 매출 감소 예상: 연 10-15%
```

## 서론

안녕하세요, Twodragon입니다.

이번 4주차에서는 AWS 취약점 점검 및 ISMS-P 인증 대응을 중심으로 실무에 꼭 필요한 보안 역량을 다집니다. 강의는 20분 발표 + 5분 휴식으로 구성되며, 집중력 향상과 피로도 최소화를 목표로 합니다.

**실무에서 겪는 가장 큰 어려움:**
1. AWS 보안 서비스가 너무 많아 어디서부터 시작해야 할지 모름
2. ISMS-P 인증 준비 시 어떤 증적을 어떻게 수집해야 할지 불명확
3. 취약점을 발견했지만 우선순위를 정하고 대응하는 체계가 없음
4. 경영진에게 보안 현황을 효과적으로 보고하는 방법을 모름

이 글에서는 위 4가지 실무 고민을 해결하는 구체적인 방법을 제시합니다. 클라우드 보안 과정 7기 - 4주차 AWS 취약점 점검 및 ISMS 대응 가이드에 대해 실무 중심으로 상세히 다룹니다.

**이 글을 읽고 나면:**
- AWS 5대 보안 서비스를 통합 운영하는 아키텍처를 구성할 수 있습니다
- ISMS-P 인증 준비 시 필요한 64개 통제항목 중 AWS 관련 32개를 정확히 대응할 수 있습니다
- 취약점 발견부터 수정, 검증, 보고까지 전체 프로세스를 자동화할 수 있습니다
- 경영진에게 설득력 있는 보안 대시보드를 제시할 수 있습니다

<img src="{% raw %}{{ '/assets/images/2025-05-09-Cloud_Security_Course_7Batch_-_4Week_AWS_Vulnerability_Inspection_and_ISMS_Response_Guide_image.png' | relative_url }}{% endraw %}" alt="Cloud Security Course 7Batch 4Week: AWS Vulnerability Inspection and ISMS Response Guide" loading="lazy" class="post-image">

## 1. 4주차 커리큘럼 개요

### 1.1 학습 목표

이번 4주차에서는 AWS 취약점 점검 및 ISMS-P 인증 대응을 중심으로 실무에 필요한 보안 역량을 학습합니다.

| 시간 | 주제 | 내용 |
|------|------|------|
| 10:00 - 10:20 | 근황 토크 | 한 주간의 보안 이슈 공유 및 Q&A |
| 10:25 - 10:50 | AWS 취약점 점검 | Inspector, SecurityHub, Config Rules |
| 11:00 - 11:25 | ISMS-P 대응 | 주요 인증 항목 및 증적 수집 |
| 11:30 - 11:50 | 실습 | 자동화된 취약점 점검 구성 |

### 1.2 AWS 취약점 점검 도구

![AWS Security Services - Inspector, SecurityHub, Config, GuardDuty](/assets/images/diagrams/2025-05-09-aws-security-services.svg)

<details>
<summary>텍스트 버전 (접근성용)</summary>

```
AWS Security Services:
- Inspector (Vulnerability Scanning)
- SecurityHub (Unified Dashboard)
- Config (Compliance Rules)
- GuardDuty (Threat Detection)
```

</details>

### 1.3 ISMS-P 인증 핵심 체크리스트

AWS 환경에서 ISMS-P 인증 대응 시 확인해야 할 핵심 항목:

- [ ] **접근 제어**: IAM 정책 최소 권한 원칙 적용
- [ ] **암호화**: S3 버킷 기본 암호화, EBS 암호화
- [ ] **로깅**: CloudTrail 전 리전 활성화
- [ ] **모니터링**: CloudWatch 알람 설정

## 2. AWS 보안 아키텍처 전체 구성도

### 2.1 통합 보안 아키텍처 다이어그램

```
┌─────────────────────────────────────────────────────────────────────┐
│                     AWS Organization (Multi-Account)                 │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐             │
│  │  Prod Acct   │  │   Dev Acct   │  │  Security    │             │
│  │              │  │              │  │   Acct       │             │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘             │
│         │                 │                 │                       │
└─────────┼─────────────────┼─────────────────┼───────────────────────┘
          │                 │                 │
          ▼                 ▼                 ▼
┌─────────────────────────────────────────────────────────────────────┐
│                        CloudTrail (전체 리전)                        │
│  - 모든 API 호출 로깅                                               │
│  - S3 장기 보관 (90일 → 7년)                                        │
│  - CloudWatch Logs 실시간 분석                                      │
└─────────────────────────────────────────────────────────────────────┘
          │
          ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    AWS Security Hub (중앙 집중)                      │
│  ┌────────────────┐  ┌────────────────┐  ┌────────────────┐       │
│  │   Inspector    │  │   GuardDuty    │  │  Config Rules  │       │
│  │ 취약점 스캔     │  │  위협 탐지      │  │ 컴플라이언스    │       │
│  └────────────────┘  └────────────────┘  └────────────────┘       │
│  ┌────────────────┐  ┌────────────────┐  ┌────────────────┐       │
│  │Trusted Advisor │  │   Macie        │  │  Access        │       │
│  │ 모범 사례 권고  │  │ 민감 데이터     │  │  Analyzer      │       │
│  └────────────────┘  └────────────────┘  └────────────────┘       │
└─────────────────────────────────────────────────────────────────────┘
          │
          ▼
┌─────────────────────────────────────────────────────────────────────┐
│                  EventBridge + SNS + Lambda                          │
│  - Security Hub 결과 자동 분류                                       │
│  - HIGH/CRITICAL 위험 즉시 알림 (Slack, Email, PagerDuty)          │
│  - JIRA 티켓 자동 생성 (취약점 추적)                                │
│  - 자동 조치 (예: 퍼블릭 S3 버킷 차단)                              │
└─────────────────────────────────────────────────────────────────────┘
          │
          ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    QuickSight 대시보드                               │
│  - 경영진 보고용 시각화                                              │
│  - 취약점 트렌드 분석                                               │
│  - ISMS-P 통제 준수율                                               │
└─────────────────────────────────────────────────────────────────────┘
```

### 2.2 취약점 라이프사이클 플로우

```
[1] 탐지 (Detection)
    ↓
    AWS Inspector → CVE 스캔 (EC2, Lambda, ECR)
    GuardDuty → 위협 인텔리전스 매칭
    Config Rules → 설정 규칙 위반 탐지
    ↓
[2] 집계 (Aggregation)
    ↓
    Security Hub → 중앙 집중 (ASFF 표준 포맷)
    ↓
[3] 분류 (Classification)
    ↓
    CVSS Score 자동 계산
    ISMS-P 통제항목 자동 매핑
    비즈니스 영향도 평가 (재무, 법률, 평판)
    ↓
[4] 우선순위 결정 (Prioritization)
    ↓
    CRITICAL → 즉시 조치 (4시간 내)
    HIGH → 24시간 내
    MEDIUM → 1주일 내
    LOW → 월 단위 계획 조치
    ↓
[5] 조치 (Remediation)
    ↓
    자동 조치 (SSM Automation, Lambda)
    수동 조치 (JIRA 티켓, 담당자 할당)
    ↓
[6] 검증 (Verification)
    ↓
    재스캔 (Inspector, Config)
    수동 검증 (침투 테스트)
    ↓
[7] 보고 (Reporting)
    ↓
    경영진 보고 (QuickSight)
    감사 증적 (S3 장기 보관)
    ISMS-P 인증 제출
```

## 3. MITRE ATT&CK 매핑 (클라우드 공격 기법)

| MITRE Tactic | Technique ID | AWS 탐지 방법 | ISMS-P 통제항목 |
|--------------|--------------|---------------|----------------|
| **Initial Access** | T1078 (Valid Accounts) | GuardDuty - UnauthorizedAccess:IAMUser/ConsoleLogin | 9.1.2 계정 관리 |
| **Persistence** | T1098 (Account Manipulation) | CloudTrail - CreateUser, AttachUserPolicy | 9.1.3 권한 관리 |
| **Privilege Escalation** | T1098.001 (IAM Policy Modification) | Config Rule - iam-policy-no-statements-with-admin-access | 9.1.1 접근권한 부여 |
| **Defense Evasion** | T1562.008 (Disable CloudTrail) | CloudWatch Alarm - StopLogging, DeleteTrail | 10.1.1 로그 수집 |
| **Credential Access** | T1552.005 (Cloud Instance Metadata API) | GuardDuty - UnauthorizedAccess:EC2/MetadataDNSRebind | 9.2.1 사용자 인증 |
| **Discovery** | T1580 (Cloud Infrastructure Discovery) | CloudTrail - DescribeInstances, ListBuckets (비정상 빈도) | 11.1.1 접근통제 모니터링 |
| **Lateral Movement** | T1021 (Remote Services) | VPC Flow Logs - 비정상 내부 트래픽 | 8.2.4 네트워크 접근 통제 |
| **Collection** | T1530 (Data from Cloud Storage) | Macie - S3 민감 데이터 대량 다운로드 | 10.2.1 개인정보 암호화 |
| **Exfiltration** | T1537 (Transfer Data to Cloud Account) | GuardDuty - Exfiltration:S3/ObjectRead.Unusual | 8.3.2 정보 전송 시 보호 |
| **Impact** | T1485 (Data Destruction) | CloudTrail - DeleteBucket, DeleteObject (대량) | 8.1.1 정보 보호 |

### 3.1 실제 공격 시나리오와 탐지 방법

**시나리오 1: 탈취된 액세스 키를 이용한 권한 상승 공격**

```
공격 흐름:
1. 개발자 노트북 침해 → AWS 액세스 키 유출
2. 공격자가 도쿄 리전에서 액세스 키 사용 (정상 위치: 서울)
3. IAM 정책 조작 시도 (AdministratorAccess 권한 추가)
4. S3 버킷 전체 리스트 확인 후 민감 데이터 다운로드

AWS 탐지:
- GuardDuty: UnauthorizedAccess:IAMUser/AnomalousAccess (지리적 이상 탐지)
- CloudTrail: AttachUserPolicy 이벤트 (IAM 정책 변경)
- Macie: S3 객체 대량 액세스 패턴 이상
- Config: iam-user-unused-credentials-check (미사용 키 탐지)

ISMS-P 통제 매핑:
- 9.1.2 계정 관리 (미사용 계정/키 정기 점검)
- 9.2.1 사용자 인증 (MFA 필수 적용)
- 11.1.1 접근통제 모니터링 (이상 행위 탐지)

조치:
1. 즉시 액세스 키 비활성화 (IAM Console 또는 CLI)
2. 영향 범위 분석 (CloudTrail 로그 전수 조사)
3. 권한 재설정 및 MFA 강제 적용
4. 사후 보고서 작성 (경영진 + ISMS 감사)
```

**시나리오 2: 퍼블릭 S3 버킷 악용**

```
공격 흐름:
1. S3 버킷 퍼블릭 액세스 차단 미설정
2. 외부 공격자가 Shodan/스캔으로 버킷 발견
3. 고객 개인정보 파일 다운로드 (1만 건)
4. 다크웹 유출 또는 랜섬웨어 협박

AWS 탐지:
- Macie: S3 버킷 퍼블릭 액세스 알림
- Config: s3-bucket-public-read-prohibited 규칙 실패
- CloudTrail: GetObject 이벤트 (외부 IP에서 대량 요청)
- Trusted Advisor: S3 버킷 권한 경고

ISMS-P 통제 매핑:
- 8.2.2 네트워크 보안 (외부 접근 통제)
- 10.2.1 개인정보 암호화 (저장 데이터 암호화)
- 8.1.1 정보 보호 (데이터 분류 및 보호)

조치:
1. 즉시 버킷 퍼블릭 액세스 차단
2. 유출된 데이터 범위 확인
3. 법적 대응 (개인정보보호위원회 신고)
4. 전사 S3 버킷 전수 조사 및 보안 강화
```

## 4. SIEM 탐지 쿼리

<!--
Splunk SPL Query: AWS Inspector 취약점 HIGH 이상 탐지

index=aws_security sourcetype=aws:inspector
| search severity IN ("HIGH", "CRITICAL")
| eval cvss_score=tonumber(cvssScore)
| where cvss_score >= 7.0
| stats count by title, severity, cvss_score, resourceId
| sort -cvss_score
| table title, severity, cvss_score, resourceId, count
| where count > 5
-->

<!--
Azure Sentinel KQL Query: GuardDuty 이상 접근 탐지

AWSGuardDuty
| where Severity in ("High", "Critical")
| where ThreatName contains "UnauthorizedAccess"
| extend GeoIP = parse_json(RemoteIpDetails)
| extend Country = GeoIP.Country.CountryName
| where Country != "South Korea"
| project TimeGenerated, AccountId, ThreatName, Severity, Country, ResourceType
| summarize EventCount = count() by ThreatName, Country, bin(TimeGenerated, 1h)
| where EventCount > 3
| order by EventCount desc
-->

<!--
Splunk SPL Query: CloudTrail IAM 권한 변경 탐지

index=aws_cloudtrail sourcetype=aws:cloudtrail
| search eventName IN ("AttachUserPolicy", "AttachRolePolicy", "PutUserPolicy", "PutRolePolicy")
| where errorCode=""
| eval policy_arn=mvindex('requestParameters.policyArn', 0)
| search policy_arn="*AdministratorAccess*" OR policy_arn="*PowerUserAccess*"
| table _time, userIdentity.userName, eventName, policy_arn, sourceIPAddress
| sort -_time
-->

<!--
Azure Sentinel KQL Query: S3 버킷 퍼블릭 노출 탐지

AWSCloudTrail
| where EventName in ("PutBucketPublicAccessBlock", "DeleteBucketPublicAccessBlock")
| extend BucketName = parse_json(RequestParameters).bucketName
| extend PublicAccessBlock = parse_json(RequestParameters).PublicAccessBlockConfiguration
| where isempty(PublicAccessBlock) or PublicAccessBlock.BlockPublicAcls == "false"
| project TimeGenerated, UserIdentityUserName, BucketName, SourceIPAddress, UserAgent
| join kind=inner (
    AWSConfig
    | where ResourceType == "AWS::S3::Bucket"
    | where ComplianceType == "NON_COMPLIANT"
) on $left.BucketName == $right.ResourceId
-->

## 5. 한국 기업 환경 분석

### 5.1 국내 규제 준수 요구사항

한국 기업이 AWS를 사용할 때 필수적으로 준수해야 하는 법률 및 인증:

| 법률/인증 | 주요 요구사항 | AWS 대응 서비스 | ISMS-P 연계 |
|----------|--------------|----------------|------------|
| **개인정보보호법** | 개인정보 암호화, 접근 통제, 유출 시 신고 | KMS, S3 암호화, CloudTrail | 10.1 개인정보 수집 |
| **정보통신망법** | 로그 6개월 보관, 침해사고 대응체계 | CloudWatch Logs, Security Hub | 11.3 침해사고 대응 |
| **전자금융거래법** | 금융 데이터 암호화, 접근 통제, 백업 | RDS 암호화, Backup, IAM | 8.1 정보 보호 |
| **신용정보법** | 신용정보 암호화, 국내 저장 원칙 | 서울 리전, KMS | 8.2 접근통제 |
| **ISMS-P** | 64개 통제항목 준수, 정기 점검 | Security Hub, Config | 전체 통제항목 |
| **클라우드 보안 인증** | CSA STAR, ISO 27017/27018 | AWS Artifact (인증서 확보) | 2.1 정보보호 정책 |

### 5.2 한국 기업 보안 운영 특성

**조직 구조 특성:**
- 보안 전담 인력 부족 (중소기업 평균 1-2명)
- 클라우드 보안 전문성 부족 (온프레미스 중심)
- 경영진의 보안 투자 우선순위 낮음

**대응 전략:**
1. **자동화 우선**: 수동 점검 최소화, AWS 네이티브 서비스 활용
2. **통합 대시보드**: Security Hub로 단일 화면 관리
3. **외부 전문가 활용**: AWS Professional Services, 파트너사 컨설팅
4. **단계별 구축**: CRITICAL → HIGH → MEDIUM 순차 대응

### 5.3 산업별 보안 우선순위

**금융업 (은행, 증권, 보험):**
- 최우선: RDS/DynamoDB 암호화, IAM MFA 강제
- CloudTrail 7년 보관 (금융감독원 규정)
- 서울 리전 단일 사용 (데이터 해외 이전 제한)

**전자상거래/유통:**
- 최우선: S3 버킷 퍼블릭 차단, WAF 적용
- Macie로 고객 개인정보 탐지
- GuardDuty로 계정 탈취 탐지

**의료/헬스케어:**
- 최우선: 의료 데이터 암호화 (KMS)
- 생명윤리법 준수 (연구용 데이터 익명화)
- 접근 로그 감사 (CloudTrail 실시간 분석)

**공공/교육:**
- 최우선: 행정안전부 클라우드 보안 가이드 준수
- G-Cloud 인증 (AWS Korea 서울 리전)
- 개인정보 국외 이전 금지

## 6. 위협 헌팅 쿼리 (Threat Hunting)

### 6.1 IAM 권한 상승 탐지

```python
# CloudTrail 로그에서 IAM 정책 변경 패턴 분석
import boto3
from datetime import datetime, timedelta

def hunt_iam_privilege_escalation():
    """
    IAM 권한 상승 공격 패턴 탐지:
    - 짧은 시간 내 여러 정책 변경
    - 관리자 권한 추가
    - 비정상 시간대 변경 (새벽 2-5시)
    """
    client = boto3.client('cloudtrail')

    # 지난 24시간 IAM 이벤트 조회
    end_time = datetime.now()
    start_time = end_time - timedelta(hours=24)

    response = client.lookup_events(
        LookupAttributes=[
            {'AttributeKey': 'EventName', 'AttributeValue': 'AttachUserPolicy'},
        ],
        StartTime=start_time,
        EndTime=end_time
    )

    suspicious_events = []
    for event in response['Events']:
        event_time = event['EventTime']
        # 새벽 시간대 (KST 02:00-05:00) 체크
        if 17 <= event_time.hour <= 20:  # UTC 기준
            user = event['Username']
            policy_arn = event['CloudTrailEvent']['requestParameters']['policyArn']
            if 'AdministratorAccess' in policy_arn:
                suspicious_events.append({
                    'time': event_time,
                    'user': user,
                    'policy': policy_arn,
                    'source_ip': event.get('SourceIPAddress', 'unknown')
                })

    return suspicious_events
```

### 6.2 S3 데이터 유출 탐지

```python
def hunt_s3_data_exfiltration():
    """
    S3 데이터 대량 다운로드 탐지:
    - 5분 내 100개 이상 객체 다운로드
    - 외부 IP에서 접근 (VPC 외부)
    - 비정상 User-Agent
    """
    client = boto3.client('cloudtrail')

    response = client.lookup_events(
        LookupAttributes=[
            {'AttributeKey': 'EventName', 'AttributeValue': 'GetObject'},
        ],
        StartTime=datetime.now() - timedelta(hours=1)
    )

    # IP별 요청 수 집계
    ip_requests = {}
    for event in response['Events']:
        source_ip = event.get('SourceIPAddress', 'unknown')
        if source_ip not in ip_requests:
            ip_requests[source_ip] = []
        ip_requests[source_ip].append(event)

    # 5분 내 100개 이상 요청한 IP 탐지
    alerts = []
    for ip, events in ip_requests.items():
        if len(events) >= 100:
            time_span = (events[-1]['EventTime'] - events[0]['EventTime']).seconds
            if time_span <= 300:  # 5분
                alerts.append({
                    'ip': ip,
                    'request_count': len(events),
                    'time_span_seconds': time_span,
                    'user_agent': events[0].get('UserAgent', 'unknown')
                })

    return alerts
```

### 6.3 암호화폐 채굴 탐지

```python
def hunt_cryptomining():
    """
    EC2 인스턴스 암호화폐 채굴 탐지:
    - GuardDuty CryptoCurrency 탐지 결과
    - 비정상 네트워크 트래픽 (VPC Flow Logs)
    - 높은 CPU 사용률 (CloudWatch Metrics)
    """
    guardduty = boto3.client('guardduty')
    detector_id = guardduty.list_detectors()['DetectorIds'][0]

    findings = guardduty.list_findings(
        DetectorId=detector_id,
        FindingCriteria={
            'Criterion': {
                'type': {
                    'Eq': ['CryptoCurrency:EC2/BitcoinTool.B!DNS']
                }
            }
        }
    )

    if findings['FindingIds']:
        details = guardduty.get_findings(
            DetectorId=detector_id,
            FindingIds=findings['FindingIds']
        )

        return [{
            'instance_id': f['Resource']['InstanceDetails']['InstanceId'],
            'severity': f['Severity'],
            'first_seen': f['Service']['EventFirstSeen'],
            'description': f['Description']
        } for f in details['Findings']]

    return []
```

## 7. 2025년 AWS re:Invent 보안 발표

2025년 AWS re:Invent에서 발표된 보안 기능들은 취약점 점검 및 ISMS 대응에 직접적인 도움을 줍니다.

### 7.1 취약점 점검 자동화 강화

#### AWS Security Agent (Preview)
개발 전 과정에서 자동화된 보안 리뷰를 수행하는 새로운 에이전트입니다.

**주요 기능:**
- 자동화된 애플리케이션 보안 리뷰
- 컨텍스트 인식 침투 테스트
- ISMS-P 인증 대응에 필요한 취약점 점검 자동화

> **참고**: AWS Security Agent 관련 내용은 [AWS re:Invent 2025 발표](https://reinvent.awsevents.com/) 및 [AWS Security 문서](https://docs.aws.amazon.com/security/)를 참조하세요.
>
> ```python
> # AWS Security Agent 활용 예시 (개념적 코드)...
> ```

<!-- 전체 코드는 위 링크 참조
```python
# AWS Security Agent 활용 예시 (개념적 코드)
def security_review_pipeline():
    """
    개발 파이프라인에 Security Agent 통합
    - 코드 커밋 시 자동 보안 리뷰
    - 배포 전 침투 테스트 수행
    - ISMS 통제항목 자동 검증
    """
    stages = [
        "코드 보안 분석",
        "의존성 취약점 스캔",
        "컨텍스트 기반 침투 테스트",
        "ISMS 통제항목 매핑"
    ]
    return stages

```
-->

#### GuardDuty Extended Threat Detection
- EC2 인스턴스 및 ECS 태스크용 **2개의 새로운 공격 시퀀스 탐지** 추가
- 복합 공격 패턴 자동 연결로 위협 탐지 정확도 향상

#### GuardDuty Malware Protection for AWS Backup
- EC2, EBS, S3 백업에서 악성코드 자동 스캔
- **증분 스캔**: 변경된 부분만 스캔하여 효율성 극대화
- ISMS 백업 보안 통제항목 대응

### 7.2 보안 중앙 관리 강화

#### AWS Security Hub GA 업데이트

| 기능 | ISMS 대응 효과 |
|------|---------------|
| 보안 위험 중앙 집중화 | 통합 보안 현황 관리 |
| 히스토리 트렌드 | 보안 개선 추이 증빙 |
| 노출 요약 | 취약점 현황 리포트 |
| 커스텀 위젯 | 감사 대응 대시보드 |

### 7.3 IAM 정책 자동화

#### IAM Policy Autopilot
- **오픈소스 MCP 서버** 기반
- AI 코딩 어시스턴트가 IAM 정책을 자동 생성
- 최소 권한 원칙 자동 준수

> **참고**: 관련 예제는 [공식 문서](https://www.json.org/json-en.html)를 참조하세요.

```json
{
  "PolicyName": "AutoPilot-Generated-Policy",
  "Description": "IAM Policy Autopilot이 자동 생성한 최소 권한 정책",
  "Features": [
    "실제 사용 패턴 분석",
    "불필요한 권한 자동 제거",
    "ISMS 접근통제 요구사항 반영"
  ]
}
```

### 7.4 운영 편의성 개선

#### aws login 명령어
> **참고**: AWS CLI 인증 관련 내용은 [AWS CLI 공식 문서](https://docs.aws.amazon.com/cli/latest/userguide/) 및 [AWS IAM Identity Center](https://docs.aws.amazon.com/singlesignon/latest/userguide/)를 참조하세요.

```bash
# 브라우저 기반 CLI 인증
aws login

# ISMS 대응 장점:
# - 자격증명 관리 간소화
# - SSO 연동으로 중앙 인증 관리
# - 감사 로그 통합
```

#### AWS Organizations Account Migration
- 조직 간 계정 직접 이동 (standalone 변환 불필요)
- ISMS 대응 시 조직 구조 변경 용이

### 7.5 AI 보안 솔루션

#### AgentCore Identity
- AI 에이전트용 인증 시스템
- 사용자 권한 기반 접근 제어
- ISMS AI 보안 통제 대응

#### Third-party 보안 통합
- **SentinelOne**: Singularity + Security Hub/CloudWatch 통합, Purple AI MCP Server
- **Salt Security**: Ask Pepper AI (Bedrock 기반 API 보호)
- **HiddenLayer**: Amazon Bedrock, SageMaker 네이티브 지원

## 8. 실무 구현 가이드

### 8.1 Security Hub 통합 구성

#### Terraform으로 Security Hub 활성화

```hcl
# security_hub.tf
resource "aws_securityhub_account" "main" {
  enable_default_standards = true
}

# CIS AWS Foundations Benchmark 활성화
resource "aws_securityhub_standards_subscription" "cis" {
  standards_arn = "arn:aws:securityhub:::ruleset/cis-aws-foundations-benchmark/v/1.2.0"
  depends_on    = [aws_securityhub_account.main]
}

# AWS Foundational Security Best Practices 활성화
resource "aws_securityhub_standards_subscription" "fsbp" {
  standards_arn = "arn:aws:securityhub:ap-northeast-2::standards/aws-foundational-security-best-practices/v/1.0.0"
  depends_on    = [aws_securityhub_account.main]
}

# Inspector 통합
resource "aws_securityhub_product_subscription" "inspector" {
  product_arn = "arn:aws:securityhub:ap-northeast-2::product/aws/inspector"
  depends_on  = [aws_securityhub_account.main]
}

# GuardDuty 통합
resource "aws_securityhub_product_subscription" "guardduty" {
  product_arn = "arn:aws:securityhub:ap-northeast-2::product/aws/guardduty"
  depends_on  = [aws_securityhub_account.main]
}

# Config 통합
resource "aws_securityhub_product_subscription" "config" {
  product_arn = "arn:aws:securityhub:ap-northeast-2::product/aws/config"
  depends_on  = [aws_securityhub_account.main]
}
```

### 8.2 EventBridge를 통한 자동 대응

```python
# lambda/security_hub_auto_remediation.py
import boto3
import json

def lambda_handler(event, context):
    """
    Security Hub 결과를 받아 자동 조치 수행
    - HIGH/CRITICAL 위험 즉시 알림
    - 자동 조치 가능한 항목은 즉시 수정
    - JIRA 티켓 자동 생성
    """

    finding = event['detail']['findings'][0]
    severity = finding['Severity']['Label']
    resource_type = finding['Resources'][0]['Type']

    # CRITICAL/HIGH 위험 즉시 Slack 알림
    if severity in ['CRITICAL', 'HIGH']:
        send_slack_alert(finding)

    # S3 버킷 퍼블릭 노출 자동 차단
    if 'S3' in resource_type and 'Public' in finding['Title']:
        bucket_name = finding['Resources'][0]['Id'].split(':')[-1]
        block_s3_public_access(bucket_name)

    # JIRA 티켓 자동 생성
    create_jira_ticket(finding)

    return {'statusCode': 200}

def send_slack_alert(finding):
    """Slack으로 보안 경고 전송"""
    # 실제 구현에서는 Slack Webhook URL 사용
    pass

def block_s3_public_access(bucket_name):
    """S3 버킷 퍼블릭 액세스 차단"""
    s3 = boto3.client('s3')
    s3.put_public_access_block(
        Bucket=bucket_name,
        PublicAccessBlockConfiguration={
            'BlockPublicAcls': True,
            'IgnorePublicAcls': True,
            'BlockPublicPolicy': True,
            'RestrictPublicBuckets': True
        }
    )

def create_jira_ticket(finding):
    """JIRA에 보안 티켓 자동 생성"""
    # 실제 구현에서는 JIRA API 사용
    pass
```

#### EventBridge Rule 설정

```hcl
# eventbridge.tf
resource "aws_cloudwatch_event_rule" "security_hub_findings" {
  name        = "security-hub-critical-findings"
  description = "Security Hub CRITICAL/HIGH 위험 자동 대응"

  event_pattern = jsonencode({
    source      = ["aws.securityhub"]
    detail-type = ["Security Hub Findings - Imported"]
    detail = {
      findings = {
        Severity = {
          Label = ["CRITICAL", "HIGH"]
        }
      }
    }
  })
}

resource "aws_cloudwatch_event_target" "lambda" {
  rule      = aws_cloudwatch_event_rule.security_hub_findings.name
  target_id = "SecurityHubAutoRemediation"
  arn       = aws_lambda_function.auto_remediation.arn
}
```

### 8.3 ISMS-P 통제항목 자동 매핑

```python
# scripts/isms_mapping.py
import boto3
import json

ISMS_CONTROL_MAPPING = {
    "9.1.1": {
        "name": "접근권한 부여",
        "aws_services": ["IAM", "Security Hub"],
        "config_rules": [
            "iam-user-mfa-enabled",
            "iam-user-unused-credentials-check",
            "iam-policy-no-statements-with-admin-access"
        ]
    },
    "8.2.2": {
        "name": "네트워크 보안",
        "aws_services": ["VPC", "Security Groups", "WAF"],
        "config_rules": [
            "restricted-ssh",
            "restricted-common-ports",
            "vpc-sg-open-only-to-authorized-ports"
        ]
    },
    "10.2.1": {
        "name": "개인정보 암호화",
        "aws_services": ["KMS", "S3", "RDS"],
        "config_rules": [
            "s3-default-encryption-kms",
            "rds-storage-encrypted",
            "ec2-ebs-encryption-by-default"
        ]
    }
    # ... 총 64개 통제항목 매핑
}

def generate_isms_compliance_report():
    """
    ISMS-P 인증 증적용 컴플라이언스 리포트 생성
    - AWS Config Rules 준수 현황
    - Security Hub 보안 표준 점수
    - 미준수 항목 상세 내역
    """
    config = boto3.client('config')

    compliance_summary = {}

    for control_id, control_info in ISMS_CONTROL_MAPPING.items():
        compliant = 0
        non_compliant = 0

        for rule_name in control_info['config_rules']:
            response = config.describe_compliance_by_config_rule(
                ConfigRuleNames=[rule_name]
            )

            if response['ComplianceByConfigRules']:
                compliance_type = response['ComplianceByConfigRules'][0]['Compliance']['ComplianceType']
                if compliance_type == 'COMPLIANT':
                    compliant += 1
                else:
                    non_compliant += 1

        total = compliant + non_compliant
        compliance_rate = (compliant / total * 100) if total > 0 else 0

        compliance_summary[control_id] = {
            'name': control_info['name'],
            'compliant': compliant,
            'non_compliant': non_compliant,
            'rate': compliance_rate
        }

    return compliance_summary

if __name__ == '__main__':
    report = generate_isms_compliance_report()
    print(json.dumps(report, indent=2, ensure_ascii=False))
```

### 8.4 CloudFormation으로 보안 스택 배포

```yaml
# cloudformation/security-baseline.yaml
AWSTemplateFormatVersion: '2010-09-09'
Description: 'AWS 보안 기본 설정 - ISMS-P 대응'

Resources:
  # CloudTrail 전 리전 로깅
  CloudTrailBucket:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: !Sub 'cloudtrail-logs-${AWS::AccountId}'
      BucketEncryption:
        ServerSideEncryptionConfiguration:
          - ServerSideEncryptionByDefault:
              SSEAlgorithm: AES256
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true

  CloudTrail:
    Type: AWS::CloudTrail::Trail
    Properties:
      TrailName: isms-compliance-trail
      S3BucketName: !Ref CloudTrailBucket
      IncludeGlobalServiceEvents: true
      IsLogging: true
      IsMultiRegionTrail: true

  # GuardDuty 활성화
  GuardDutyDetector:
    Type: AWS::GuardDuty::Detector
    Properties:
      Enable: true
      FindingPublishingFrequency: FIFTEEN_MINUTES

  # Config 활성화
  ConfigRecorder:
    Type: AWS::Config::ConfigurationRecorder
    Properties:
      Name: isms-config-recorder
      RoleArn: !GetAtt ConfigRole.Arn
      RecordingGroup:
        AllSupported: true
        IncludeGlobalResourceTypes: true

  ConfigRole:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Version: '2012-10-17'
        Statement:
          - Effect: Allow
            Principal:
              Service: config.amazonaws.com
            Action: sts:AssumeRole
      ManagedPolicyArns:
        - arn:aws:iam::aws:policy/service-role/ConfigRole

  # Config Rules - 핵심 보안 규칙
  RootAccountMfaEnabled:
    Type: AWS::Config::ConfigRule
    Properties:
      ConfigRuleName: root-account-mfa-enabled
      Source:
        Owner: AWS
        SourceIdentifier: ROOT_ACCOUNT_MFA_ENABLED

  S3BucketPublicReadProhibited:
    Type: AWS::Config::ConfigRule
    Properties:
      ConfigRuleName: s3-bucket-public-read-prohibited
      Source:
        Owner: AWS
        SourceIdentifier: S3_BUCKET_PUBLIC_READ_PROHIBITED

  RdsStorageEncrypted:
    Type: AWS::Config::ConfigRule
    Properties:
      ConfigRuleName: rds-storage-encrypted
      Source:
        Owner: AWS
        SourceIdentifier: RDS_STORAGE_ENCRYPTED
```

## 9. 경영진 보고 대시보드 구성

### 9.1 QuickSight 대시보드 설계

```sql
-- Athena 쿼리: Security Hub 취약점 트렌드 분석
-- 데이터 소스: Security Hub → S3 → Glue → Athena
CREATE OR REPLACE VIEW security_vulnerability_trend AS
SELECT
    date_trunc('day', from_iso8601_timestamp(createdat)) AS report_date,
    severity.label AS severity,
    COUNT(*) AS vulnerability_count,
    resources[1].type AS resource_type
FROM security_hub_findings
WHERE
    recordstate = 'ACTIVE'
    AND workflow.status != 'RESOLVED'
GROUP BY
    date_trunc('day', from_iso8601_timestamp(createdat)),
    severity.label,
    resources[1].type
ORDER BY
    report_date DESC,
    vulnerability_count DESC;

-- ISMS-P 통제 준수율
CREATE OR REPLACE VIEW isms_compliance_rate AS
SELECT
    control_id,
    control_name,
    SUM(CASE WHEN compliance_type = 'COMPLIANT' THEN 1 ELSE 0 END) AS compliant_count,
    SUM(CASE WHEN compliance_type = 'NON_COMPLIANT' THEN 1 ELSE 0 END) AS non_compliant_count,
    ROUND(
        100.0 * SUM(CASE WHEN compliance_type = 'COMPLIANT' THEN 1 ELSE 0 END) /
        NULLIF(COUNT(*), 0),
        2
    ) AS compliance_rate
FROM config_compliance_mapping
GROUP BY control_id, control_name
ORDER BY compliance_rate ASC;
```

### 9.2 경영진 보고서 자동 생성

```python
# scripts/generate_executive_report.py
import boto3
from datetime import datetime, timedelta
import json

def generate_executive_report(output_file='executive_report.html'):
    """
    경영진용 보안 현황 리포트 자동 생성
    - 전체 위험 레벨 요약
    - 즉시 조치 필요 항목 (HIGH/CRITICAL)
    - ISMS-P 준수율
    - 예상 비용
    - 비즈니스 영향도
    """

    # Security Hub 데이터 수집
    securityhub = boto3.client('securityhub')
    findings = securityhub.get_findings(
        Filters={
            'RecordState': [{'Value': 'ACTIVE', 'Comparison': 'EQUALS'}],
            'WorkflowStatus': [{'Value': 'NEW', 'Comparison': 'EQUALS'}]
        }
    )

    # 심각도별 집계
    severity_count = {'CRITICAL': 0, 'HIGH': 0, 'MEDIUM': 0, 'LOW': 0}
    for finding in findings['Findings']:
        severity = finding['Severity']['Label']
        severity_count[severity] += 1

    # ISMS-P 준수율 계산 (예시)
    isms_compliance_rate = 75  # 실제로는 Config Rules 결과 집계

    # 예상 비용 계산
    estimated_cost = {
        'remediation': 2000,  # 취약점 조치 비용
        'logging': 500,       # 로그 장기 보관 비용
        'total': 2500
    }

    # HTML 리포트 생성
    html_content = f"""
    <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <title>보안 현황 종합 리포트</title>
        <style>
            body {{ font-family: Arial, sans-serif; margin: 40px; }}
            .header {{ background-color: #f44336; color: white; padding: 20px; }}
            .section {{ margin: 20px 0; padding: 20px; border: 1px solid #ddd; }}
            .critical {{ color: #d32f2f; font-weight: bold; }}
            .high {{ color: #f57c00; font-weight: bold; }}
            table {{ width: 100%; border-collapse: collapse; }}
            th, td {{ padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }}
        </style>
    </head>
    <body>
        <div class="header">
            <h1>보안 현황 종합 리포트</h1>
            <p>기준일: {datetime.now().strftime('%Y년 %m월 %d일')}</p>
        </div>

        <div class="section">
            <h2>[1] 전체 보안 위험 레벨</h2>
            <p class="critical">
                CRITICAL: {severity_count['CRITICAL']}건
            </p>
            <p class="high">
                HIGH: {severity_count['HIGH']}건
            </p>
            <p>
                MEDIUM: {severity_count['MEDIUM']}건 | LOW: {severity_count['LOW']}건
            </p>
        </div>

        <div class="section">
            <h2>[2] 즉시 조치 필요 (HIGH 위험)</h2>
            <ul>
                <li>EC2 인스턴스 15대 공개 노출 (0.0.0.0/0 허용)</li>
                <li>RDS 암호화 미적용 DB 3개</li>
                <li>CloudTrail 로그 90일 이상 보관 미설정</li>
                <li>IAM 루트 계정 MFA 미설정</li>
                <li>S3 버킷 퍼블릭 액세스 차단 미설정 7건</li>
            </ul>
        </div>

        <div class="section">
            <h2>[3] ISMS-P 인증 준비 현황</h2>
            <p><strong>{isms_compliance_rate}% 완료</strong> (48/64 통제항목)</p>
            <p>잔여 16개 통제항목 보완 필요</p>
        </div>

        <div class="section">
            <h2>[4] 예상 투자 비용</h2>
            <table>
                <tr>
                    <th>항목</th>
                    <th>월 비용 (USD)</th>
                </tr>
                <tr>
                    <td>취약점 조치</td>
                    <td>${estimated_cost['remediation']}</td>
                </tr>
                <tr>
                    <td>로그 장기 보관</td>
                    <td>${estimated_cost['logging']}</td>
                </tr>
                <tr>
                    <th>총 예상 비용</th>
                    <th>${estimated_cost['total']}</th>
                </tr>
            </table>
        </div>

        <div class="section">
            <h2>[5] 비즈니스 영향</h2>
            <ul>
                <li>정보 유출 시 예상 손실: 평균 57억원 (한국인터넷진흥원 2024 통계)</li>
                <li>개인정보보호법 위반 시 매출의 3% 또는 최대 5억원 과징금</li>
                <li>고객 신뢰도 저하로 인한 매출 감소 예상: 연 10-15%</li>
            </ul>
        </div>

        <div class="section">
            <h2>[6] 조치 일정</h2>
            <ul>
                <li><strong>1주차:</strong> HIGH 위험 5건 완전 제거</li>
                <li><strong>2-3주차:</strong> MEDIUM 위험 23건 중 우선순위 상위 10건 조치</li>
                <li><strong>4주차:</strong> ISMS-P 인증 잔여 16개 통제항목 보완</li>
            </ul>
        </div>
    </body>
    </html>
    """

    with open(output_file, 'w', encoding='utf-8') as f:
        f.write(html_content)

    print(f"경영진 보고서 생성 완료: {output_file}")

if __name__ == '__main__':
    generate_executive_report()
```

## 10. 실전 트러블슈팅

### 10.1 Inspector 스캔이 실행되지 않는 경우

**증상:**
- Inspector 대시보드에서 EC2 인스턴스가 보이지 않음
- 스캔 결과가 업데이트되지 않음

**원인 및 해결:**

1. **SSM Agent 미설치/미실행**
   ```bash
   # EC2 인스턴스에 접속
   sudo systemctl status amazon-ssm-agent

   # 미설치 시 설치 (Amazon Linux 2)
   sudo yum install -y amazon-ssm-agent
   sudo systemctl enable amazon-ssm-agent
   sudo systemctl start amazon-ssm-agent
   ```

2. **IAM 역할 권한 부족**
   ```json
   {
     "Version": "2012-10-17",
     "Statement": [
       {
         "Effect": "Allow",
         "Action": [
           "ssm:UpdateInstanceInformation",
           "ssmmessages:CreateControlChannel",
           "ssmmessages:CreateDataChannel",
           "ssmmessages:OpenControlChannel",
           "ssmmessages:OpenDataChannel"
         ],
         "Resource": "*"
       },
       {
         "Effect": "Allow",
         "Action": [
           "s3:GetObject"
         ],
         "Resource": "arn:aws:s3:::aws-ssm-ap-northeast-2/*"
       }
     ]
   }
   ```

3. **네트워크 연결 문제**
   - VPC 엔드포인트 설정 (프라이빗 서브넷인 경우)
   ```hcl
   resource "aws_vpc_endpoint" "ssm" {
     vpc_id            = aws_vpc.main.id
     service_name      = "com.amazonaws.ap-northeast-2.ssm"
     vpc_endpoint_type = "Interface"
     subnet_ids        = aws_subnet.private[*].id
     security_group_ids = [aws_security_group.vpc_endpoints.id]
   }
   ```

### 10.2 GuardDuty 오탐 (False Positive) 대응

**증상:**
- 정상 트래픽을 위협으로 탐지 (예: 백업 도구의 대량 데이터 전송)

**해결 방법:**

1. **신뢰할 수 있는 IP 목록 등록**
   ```bash
   aws guardduty create-ip-set \
     --detector-id <DETECTOR_ID> \
     --name "Trusted-IPs" \
     --format TXT \
     --location s3://my-bucket/trusted-ips.txt \
     --activate
   ```

2. **특정 Finding 억제 (Suppression Rule)**
   ```python
   import boto3

   guardduty = boto3.client('guardduty')
   detector_id = 'YOUR_DETECTOR_ID'

   guardduty.create_filter(
       DetectorId=detector_id,
       Name='Suppress-Backup-Traffic',
       Action='ARCHIVE',
       FindingCriteria={
           'Criterion': {
               'type': {
                   'Eq': ['UnauthorizedAccess:EC2/TorClient']
               },
               'resource.instanceDetails.instanceId': {
                   'Eq': ['i-1234567890abcdef0']  # 백업 서버 인스턴스
               }
           }
       }
   )
   ```

### 10.3 Security Hub 통합 문제

**증상:**
- Inspector 결과가 Security Hub에 나타나지 않음
- Config Rules 결과가 반영 안 됨

**해결 방법:**

1. **제품 통합 확인**
   ```bash
   aws securityhub list-enabled-products-for-import
   ```

2. **제품 통합 활성화**
   ```bash
   aws securityhub enable-import-findings-for-product \
     --product-arn "arn:aws:securityhub:ap-northeast-2::product/aws/inspector"
   ```

3. **리전 일치 확인**
   - Security Hub와 통합 서비스가 같은 리전에 있어야 함
   - 멀티 리전 통합 시 Aggregation 설정 필요

### 10.4 CloudTrail 로그 분석 성능 문제

**증상:**
- Athena 쿼리가 너무 느림 (수 분 소요)
- 비용이 예상보다 높음

**해결 방법:**

1. **파티셔닝 적용**
   ```sql
   -- Glue 크롤러로 파티션 자동 생성 후
   MSCK REPAIR TABLE cloudtrail_logs;

   -- 파티션 활용 쿼리
   SELECT *
   FROM cloudtrail_logs
   WHERE year = '2025'
     AND month = '05'
     AND day = '09'
     AND eventname = 'AttachUserPolicy';
   ```

2. **컬럼 프로젝션 최소화**
   ```sql
   -- 나쁜 예 (전체 컬럼 스캔)
   SELECT * FROM cloudtrail_logs;

   -- 좋은 예 (필요한 컬럼만)
   SELECT eventtime, eventname, username, sourceipaddress
   FROM cloudtrail_logs
   WHERE year = '2025' AND month = '05';
   ```

3. **결과 캐싱**
   - Athena 쿼리 결과 24시간 캐싱 활용
   - QuickSight SPICE 인메모리 엔진 사용

## 11. 자주 묻는 질문 (Troubleshooting)

**Q1: Inspector는 어떤 워크로드를 스캔하나요?**
A: EC2 인스턴스, ECR 이미지, Lambda 함수를 스캔합니다. ECS 태스크는 ECR 이미지를 통해 간접 스캔됩니다.

**Q2: GuardDuty는 실시간 탐지인가요?**
A: 네, 5-15분 간격으로 위협을 탐지하고 알림을 전송합니다. FIFTEEN_MINUTES 설정이 기본입니다.

**Q3: ISMS-P 인증 시 AWS 서비스만으로 충분한가요?**
A: AWS 네이티브 서비스로 대부분의 통제항목을 대응할 수 있지만, 조직의 보안 정책 문서화와 프로세스 수립은 별도로 필요합니다.

**Q4: Config Rules와 Security Hub의 차이는?**
A: Config Rules는 리소스 설정 규칙 준수를 점검하고, Security Hub는 여러 보안 서비스의 결과를 통합하여 중앙에서 관리합니다.

**Q5: CloudTrail 로그를 얼마나 보관해야 하나요?**
A: 법적 요구사항에 따라 다르지만, 금융권은 7년, 일반 기업은 최소 1년 보관을 권장합니다. S3 Glacier로 장기 보관 시 비용 절감 가능합니다.

## 결론

클라우드 보안 과정 7기 - 4주차 AWS 취약점 점검 및 ISMS 대응 가이드에 대해 다루었습니다. 올바른 설정과 지속적인 모니터링을 통해 안전하고 효율적인 환경을 구축할 수 있습니다.

2025년 re:Invent에서 발표된 새로운 보안 기능들, 특히 **AWS Security Agent**, **IAM Policy Autopilot**, **GuardDuty Extended Threat Detection**은 취약점 점검 자동화와 ISMS-P 인증 대응에 큰 도움이 될 것입니다.

**핵심 요약:**

1. **통합 보안 아키텍처**: Security Hub 중심으로 Inspector, GuardDuty, Config, Macie, Trusted Advisor를 통합 운영
2. **자동화 우선**: EventBridge + Lambda로 HIGH/CRITICAL 위험 즉시 대응
3. **ISMS-P 매핑**: 64개 통제항목 중 AWS 관련 32개를 Config Rules와 Security Hub로 자동 검증
4. **경영진 보고**: QuickSight 대시보드로 비즈니스 영향도 중심 시각화
5. **위협 헌팅**: CloudTrail, VPC Flow Logs를 활용한 능동적 위협 탐지
6. **한국 규제 준수**: 개인정보보호법, 정보통신망법, 전자금융거래법 대응

**다음 단계 액션 아이템:**

- [ ] Security Hub 활성화 및 표준 (CIS, FSBP) 적용
- [ ] Inspector 전체 워크로드 스캔 활성화 (목표: 95% 커버리지)
- [ ] EventBridge + Lambda 자동 대응 파이프라인 구축
- [ ] ISMS-P 통제항목 매핑 스크립트 실행 및 갭 분석
- [ ] 경영진 보고 대시보드 구축 (QuickSight)
- [ ] 위협 헌팅 쿼리 정기 실행 (주 1회)
- [ ] CloudTrail 로그 7년 보관 정책 설정 (S3 Glacier)

---

## 참고 자료 (Comprehensive References)

### AWS 공식 문서

| 서비스 | 문서 URL | 설명 |
|--------|---------|------|
| **Security Hub** | [https://docs.aws.amazon.com/securityhub/](https://docs.aws.amazon.com/securityhub/) | 중앙 집중 보안 관리 |
| **Inspector** | [https://docs.aws.amazon.com/inspector/](https://docs.aws.amazon.com/inspector/) | 취약점 자동 스캔 |
| **GuardDuty** | [https://docs.aws.amazon.com/guardduty/](https://docs.aws.amazon.com/guardduty/) | 지능형 위협 탐지 |
| **Config** | [https://docs.aws.amazon.com/config/](https://docs.aws.amazon.com/config/) | 리소스 설정 추적 |
| **CloudTrail** | [https://docs.aws.amazon.com/cloudtrail/](https://docs.aws.amazon.com/cloudtrail/) | API 감사 로깅 |
| **Macie** | [https://docs.aws.amazon.com/macie/](https://docs.aws.amazon.com/macie/) | 민감 데이터 탐지 |
| **IAM Access Analyzer** | [https://docs.aws.amazon.com/IAM/latest/UserGuide/what-is-access-analyzer.html](https://docs.aws.amazon.com/IAM/latest/UserGuide/what-is-access-analyzer.html) | 외부 액세스 분석 |

### ISMS-P 관련 자료

| 기관/문서 | URL | 설명 |
|----------|-----|------|
| **한국인터넷진흥원 (KISA)** | [https://isms.kisa.or.kr/](https://isms.kisa.or.kr/) | ISMS-P 인증 공식 사이트 |
| **ISMS-P 인증기준 해설서** | [https://isms.kisa.or.kr/main/ispims/notice/?boardId=bbs_0000000000000016&mode=view&cntId=13](https://isms.kisa.or.kr/main/ispims/notice/?boardId=bbs_0000000000000016&mode=view&cntId=13) | 64개 통제항목 상세 해설 |
| **클라우드 보안 인증제** | [https://csap.kisa.or.kr/](https://csap.kisa.or.kr/) | CSA STAR 한국 버전 |

### 보안 프레임워크

| 프레임워크 | URL | 설명 |
|----------|-----|------|
| **CIS AWS Foundations Benchmark** | [https://www.cisecurity.org/benchmark/amazon_web_services](https://www.cisecurity.org/benchmark/amazon_web_services) | AWS 보안 모범 사례 |
| **NIST Cybersecurity Framework** | [https://www.nist.gov/cyberframework](https://www.nist.gov/cyberframework) | 사이버 보안 프레임워크 |
| **MITRE ATT&CK for Cloud** | [https://attack.mitre.org/matrices/enterprise/cloud/](https://attack.mitre.org/matrices/enterprise/cloud/) | 클라우드 공격 기법 분류 |
| **AWS Well-Architected Security Pillar** | [https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html](https://docs.aws.amazon.com/wellarchitected/latest/security-pillar/welcome.html) | AWS 보안 아키텍처 원칙 |

### 한국 법률 및 규제

| 법률 | URL | 주요 내용 |
|------|-----|---------|
| **개인정보보호법** | [https://www.law.go.kr/법령/개인정보보호법](https://www.law.go.kr/법령/개인정보보호법) | 개인정보 처리 규정 |
| **정보통신망법** | [https://www.law.go.kr/법령/정보통신망이용촉진및정보보호등에관한법률](https://www.law.go.kr/법령/정보통신망이용촉진및정보보호등에관한법률) | 침해사고 대응 의무 |
| **전자금융거래법** | [https://www.law.go.kr/법령/전자금융거래법](https://www.law.go.kr/법령/전자금융거래법) | 금융 데이터 보호 |
| **클라우드컴퓨팅법** | [https://www.law.go.kr/법령/클라우드컴퓨팅발전및이용자보호에관한법률](https://www.law.go.kr/법령/클라우드컴퓨팅발전및이용자보호에관한법률) | 클라우드 서비스 규제 |

### 보안 도구 및 오픈소스

| 도구 | URL | 용도 |
|------|-----|------|
| **Prowler** | [https://github.com/prowler-cloud/prowler](https://github.com/prowler-cloud/prowler) | AWS 보안 평가 오픈소스 |
| **ScoutSuite** | [https://github.com/nccgroup/ScoutSuite](https://github.com/nccgroup/ScoutSuite) | 멀티 클라우드 보안 감사 |
| **CloudMapper** | [https://github.com/duo-labs/cloudmapper](https://github.com/duo-labs/cloudmapper) | AWS 네트워크 시각화 |
| **aws-vault** | [https://github.com/99designs/aws-vault](https://github.com/99designs/aws-vault) | AWS 자격증명 안전 저장 |

### 보안 블로그 및 뉴스

| 사이트 | URL | 설명 |
|-------|-----|------|
| **AWS Security Blog** | [https://aws.amazon.com/blogs/security/](https://aws.amazon.com/blogs/security/) | AWS 공식 보안 블로그 |
| **KISA 인터넷 보호나라** | [https://www.boho.or.kr/](https://www.boho.or.kr/) | 한국 보안 동향 |
| **Krebs on Security** | [https://krebsonsecurity.com/](https://krebsonsecurity.com/) | 글로벌 보안 뉴스 |
| **The Hacker News** | [https://thehackernews.com/](https://thehackernews.com/) | 보안 취약점 속보 |

### 커뮤니티 및 포럼

| 커뮤니티 | URL | 설명 |
|---------|-----|------|
| **AWS re:Post (Security)** | [https://repost.aws/tags/security](https://repost.aws/tags/security) | AWS 공식 Q&A |
| **r/aws (Reddit)** | [https://www.reddit.com/r/aws/](https://www.reddit.com/r/aws/) | AWS 커뮤니티 |
| **정보보호 커뮤니티 (보안프로젝트)** | [https://www.boannews.com/media/t_list.asp](https://www.boannews.com/media/t_list.asp) | 한국 보안 커뮤니티 |

### 온라인 강의 (edu.2twodragon.com)

| 과정 | 설명 | 링크 |
|------|------|------|
| **AWS 취약점 점검** | Inspector, Security Hub, 취약점 스캔 자동화 | [수강하기](https://edu.2twodragon.com/courses/aws-vulnerability) |
| **ISMS-P 인증 대응** | 관리체계 수립, 보호대책 구현, 인증 실무 | [수강하기](https://edu.2twodragon.com/courses/isms-p) |
| **AWS 클라우드 보안** | IAM, VPC, Security Groups, GuardDuty | [수강하기](https://edu.2twodragon.com/courses/aws-security) |

### YouTube 영상

| 주제 | 설명 | 링크 |
|------|------|------|
| **AWS WAF 네트워크 시나리오** | AWS WAF와 전체적인 네트워크 보안 구성 | [시청하기](https://youtu.be/r84IuPv_4TI) |

### 실습 환경 및 도구

| 도구 | URL | 설명 |
|------|-----|------|
| **AWS Skill Builder** | [https://skillbuilder.aws/](https://skillbuilder.aws/) | AWS 공식 학습 플랫폼 |
| **AWS Workshop Studio** | [https://workshops.aws/](https://workshops.aws/) | 실습 워크샵 |
| **CloudGoat** | [https://github.com/RhinoSecurityLabs/cloudgoat](https://github.com/RhinoSecurityLabs/cloudgoat) | AWS 취약점 실습 환경 |

---

**마지막 업데이트:** 2025년 5월 9일
**문의:** [tech@2twodragon.com](mailto:tech@2twodragon.com)
**블로그:** [https://tech.2twodragon.com](https://tech.2twodragon.com)
