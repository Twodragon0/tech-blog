<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 750 520" font-family="system-ui, -apple-system, sans-serif">
  <defs>
    <linearGradient id="blueGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#2563eb"/>
      <stop offset="100%" stop-color="#1d4ed8"/>
    </linearGradient>
    <linearGradient id="greenGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#16a34a"/>
      <stop offset="100%" stop-color="#15803d"/>
    </linearGradient>
    <linearGradient id="purpleGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#7c3aed"/>
      <stop offset="100%" stop-color="#5b21b6"/>
    </linearGradient>
    <linearGradient id="tealGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#0d9488"/>
      <stop offset="100%" stop-color="#0f766e"/>
    </linearGradient>
    <marker id="arrow" viewBox="0 0 10 7" refX="10" refY="3.5" markerWidth="10" markerHeight="7" orient="auto-start-reverse">
      <polygon points="0 0, 10 3.5, 0 7" fill="#94a3b8"/>
    </marker>
    <filter id="shadow" x="-3%" y="-3%" width="108%" height="108%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-color="#000" flood-opacity="0.4"/>
    </filter>
  </defs>

  <rect width="750" height="520" fill="#0d1117" rx="8"/>

  <!-- Outer container -->
  <rect x="30" y="10" width="690" height="500" rx="10" fill="none" stroke="#334155" stroke-width="1.5"/>
  <text x="375" y="35" text-anchor="middle" fill="#f1f5f9" font-size="17" font-weight="bold">PromptDefense Class Architecture</text>

  <!-- User Input -->
  <rect x="290" y="50" width="170" height="38" rx="8" fill="#475569" filter="url(#shadow)"/>
  <text x="375" y="74" text-anchor="middle" fill="#f1f5f9" font-size="13" font-weight="bold">User Input</text>
  <line x1="375" y1="88" x2="375" y2="110" stroke="#94a3b8" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Layer 1: validate_input() -->
  <rect x="60" y="120" width="630" height="100" rx="10" fill="url(#blueGrad)" filter="url(#shadow)"/>
  <text x="375" y="143" text-anchor="middle" fill="#f1f5f9" font-size="14" font-weight="bold">validate_input() - Layer 1</text>
  <rect x="85" y="155" width="170" height="50" rx="6" fill="#1e40af" opacity="0.6"/>
  <text x="170" y="177" text-anchor="middle" fill="#bfdbfe" font-size="12">Length Check</text>
  <text x="170" y="195" text-anchor="middle" fill="#93c5fd" font-size="10">max: 4000 chars</text>
  <line x1="255" y1="180" x2="285" y2="180" stroke="#94a3b8" stroke-width="1.5" marker-end="url(#arrow)"/>
  <rect x="295" y="155" width="170" height="50" rx="6" fill="#1e40af" opacity="0.6"/>
  <text x="380" y="177" text-anchor="middle" fill="#bfdbfe" font-size="12">Pattern Matching</text>
  <text x="380" y="195" text-anchor="middle" fill="#93c5fd" font-size="10">7 attack regex</text>
  <line x1="465" y1="180" x2="495" y2="180" stroke="#94a3b8" stroke-width="1.5" marker-end="url(#arrow)"/>
  <rect x="505" y="155" width="160" height="50" rx="6" fill="#1e40af" opacity="0.6"/>
  <text x="585" y="180" text-anchor="middle" fill="#bfdbfe" font-size="12">Return (ok, err)</text>

  <line x1="375" y1="220" x2="375" y2="250" stroke="#94a3b8" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="405" y="240" fill="#64748b" font-size="10">(if valid)</text>

  <!-- Layer 2: build_safe_prompt() -->
  <rect x="60" y="260" width="630" height="90" rx="10" fill="url(#purpleGrad)" filter="url(#shadow)"/>
  <text x="375" y="283" text-anchor="middle" fill="#f1f5f9" font-size="14" font-weight="bold">build_safe_prompt() - Layer 2</text>
  <text x="375" y="306" text-anchor="middle" fill="#c4b5fd" font-size="11">&lt;|system|&gt; {system_prompt} + Safety Instructions &lt;|/system|&gt;</text>
  <text x="375" y="325" text-anchor="middle" fill="#c4b5fd" font-size="11">&lt;|user|&gt; {user_input} &lt;|/user|&gt; â†’ &lt;|assistant|&gt;</text>

  <line x1="375" y1="350" x2="375" y2="378" stroke="#94a3b8" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Layer 3: validate_output() -->
  <rect x="60" y="388" width="630" height="70" rx="10" fill="url(#tealGrad)" filter="url(#shadow)"/>
  <text x="375" y="411" text-anchor="middle" fill="#f1f5f9" font-size="14" font-weight="bold">validate_output() - Layer 3</text>
  <text x="375" y="433" text-anchor="middle" fill="#ccfbf1" font-size="11">Forbidden Pattern Check | Sensitive Info Filtering | Format Compliance</text>

  <line x1="375" y1="458" x2="375" y2="476" stroke="#94a3b8" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Safe Output -->
  <rect x="290" y="483" width="170" height="38" rx="8" fill="url(#greenGrad)" filter="url(#shadow)"/>
  <text x="375" y="507" text-anchor="middle" fill="#f1f5f9" font-size="13" font-weight="bold">Safe Output</text>
</svg>