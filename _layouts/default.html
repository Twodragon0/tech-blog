<!DOCTYPE html>
<html lang="{{ site.lang | default: 'ko' }}">
{% include head.html %}
{% include sentry.html %}
{% include error-handler.html %}
<body>
  <a href="#main-content" class="skip-link">본문으로 건너뛰기</a>
  {% include header.html %}

  <main id="main-content" class="main-content" role="main">
    <div class="container">
      {{ content }}
    </div>
  </main>

  {% include footer.html %}
  {% include chat-widget.html %}
  <!-- Chat widget is loaded on-demand when user interacts -->
  <script>
    // Lazy load chat widget script only when user interacts
    (function() {
      let chatWidgetLoaded = false;
      const chatToggle = document.getElementById('chat-widget-toggle');
      
      function loadChatWidget() {
        if (chatWidgetLoaded) return;
        chatWidgetLoaded = true;
        
        const script = document.createElement('script');
        script.src = "{{ "/assets/js/chat-widget.js" | relative_url }}";
        script.defer = true;
        document.body.appendChild(script);
      }
      
      // Load on toggle click or after 3 seconds (if user is still on page)
      if (chatToggle) {
        chatToggle.addEventListener('click', loadChatWidget, { once: true });
        
        // Also load after 3 seconds if user hasn't left (non-blocking)
        setTimeout(function() {
          if (document.visibilityState === 'visible') {
            requestIdleCallback ? requestIdleCallback(loadChatWidget) : setTimeout(loadChatWidget, 0);
          }
        }, 3000);
      }
    })();
  </script>
</body>
</html>
