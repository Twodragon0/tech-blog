{% if include.content %}
{% assign headers = include.content | split: '<h' %}
{% if headers.size > 2 %}
<div class="toc-container">
  <div class="toc-card">
    <div class="toc-header">
      <div class="toc-title-section">
        <div class="toc-icon">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
        </div>
        <h4 class="toc-title">목차</h4>
        <span class="toc-count" id="toc-count"></span>
      </div>
      <button class="toc-expand-btn" id="toc-toggle" aria-label="목차 펼치기/접기">
        <span class="btn-text">전체보기</span>
        <svg class="chevron-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="6 9 12 15 18 9"/>
        </svg>
      </button>
    </div>

    <nav class="toc-nav" id="toc-content" aria-label="Table of Contents">
      <div class="toc-grid">
        {% assign item_count = 0 %}
        {% for header in headers %}
          {% if header contains 'id="' %}
            {% assign level = header | slice: 0, 1 %}
            {% if level == "2" %}
              {% assign id_start = header | split: 'id="' | last %}
              {% assign id = id_start | split: '"' | first %}
              {% assign title_start = header | split: '>' | slice: 1 | join: '>' %}
              {% assign title = title_start | split: '</h' | first | strip_html %}
              {% assign item_count = item_count | plus: 1 %}
              <a href="#{{ id }}" class="toc-card-item" data-index="{{ item_count }}">
                <span class="toc-item-number">{{ item_count }}</span>
                <span class="toc-item-text">{{ title }}</span>
                <svg class="toc-item-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M5 12h14M12 5l7 7-7 7"/>
                </svg>
              </a>
            {% endif %}
          {% endif %}
        {% endfor %}
      </div>
    </nav>
  </div>
</div>

<script src="{{ '/assets/js/toc.js' | relative_url }}?v={{ site.time | date: '%Y%m%d%H%M' }}" defer></script>
{% endif %}
{% endif %}
