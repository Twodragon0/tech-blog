<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Early console noise filter: í™•ì¥ í”„ë¡œê·¸ë¨/CSP/Giscus ë…¸ì´ì¦ˆ (Chrome, Safari) -->
  <script>
  (function(){
    var _e=console.error,_w=console.warn;
    function sup(m){if(typeof m!=='string')m=(m&&m.message)||String(m);return /runtime\.lastError|message port closed|Framing.*violates.*Content Security Policy|frame-ancestors\s*'self'|report-only.*frame-ancestors|violation has been logged|giscus\.app.*404|discussions.*404|GET.*giscus\.app.*404/i.test(m);}
    console.error=function(){if(arguments[0]!==undefined&&sup(arguments[0]))return;_e.apply(console,arguments);};
    console.warn=function(){if(arguments[0]!==undefined&&sup(arguments[0]))return;_w.apply(console,arguments);};
  })();
  </script>

  <!-- Security Headers -->
  <!--
    ë³´ì•ˆ í—¤ë” ì„¤ì •:
    - Vercel.jsonì—ì„œ HTTP í—¤ë”ë¡œ ì¤‘ì•™ ê´€ë¦¬ë©ë‹ˆë‹¤.
    - Content-Security-Policy (CSP)
      * 'unsafe-eval'ì€ Google Translate, Google Ads ë“± third-party ìŠ¤í¬ë¦½íŠ¸ í˜¸í™˜ì„±ì„ ìœ„í•´ í•„ìš”í•©ë‹ˆë‹¤.
      * ì´ëŠ” ì •ìƒì ì¸ ì„¤ì •ì´ë©°, third-party ìŠ¤í¬ë¦½íŠ¸ì˜ eval() ì‚¬ìš©ì„ í—ˆìš©í•©ë‹ˆë‹¤.
    - X-Content-Type-Options
    - Referrer-Policy
    - Strict-Transport-Security
    - X-Frame-Options
    
    ì°¸ê³ :
    - CSP eval() ê²½ê³ : Google Translate, Google Ads ë“± third-party ìŠ¤í¬ë¦½íŠ¸ê°€ eval()ì„ ì‚¬ìš©í•˜ë¯€ë¡œ
      'unsafe-eval'ì´ í•„ìš”í•©ë‹ˆë‹¤. ì´ëŠ” ë³´ì•ˆ ê°ì‚¬ ë„êµ¬ì—ì„œ ê²½ê³ ë¥¼ í‘œì‹œí•  ìˆ˜ ìˆì§€ë§Œ,
      third-party ìŠ¤í¬ë¦½íŠ¸ í˜¸í™˜ì„±ì„ ìœ„í•´ í•„ìš”í•œ ì„¤ì •ì…ë‹ˆë‹¤.
    - Form field id/name: Giscus ë“± third-party ìœ„ì ¯ì´ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ëŠ” form í•„ë“œëŠ”
      id/name ì†ì„±ì´ ì—†ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” third-party ìœ„ì ¯ì˜ ì •ìƒì ì¸ ë™ì‘ì…ë‹ˆë‹¤.
  -->

  <!-- SEO -->
  <title>{% if page.title %}{{ page.title | escape }} | {{ site.title }}{% else %}{{ site.title }}{% endif %}</title>
  <meta name="description" content="{% if page.excerpt %}{{ page.excerpt | strip_html | strip_newlines | truncate: 160 }}{% elsif page.description %}{{ page.description }}{% else %}{{ site.description }}{% endif %}">
  <meta name="author" content="{{ site.author.name }}">
  <meta name="naver-site-verification" content="b4d9dc74a4120dd65ce564a3fd97adb2f48ae7f2" />
  <meta name="google-site-verification" content="4f3Fngt0n2PDMUdFumJYQEwXKluVehXzwPV_TqxTauU" />
  <link rel="canonical" href="{{ page.url | absolute_url }}">

  <!-- Open Graph -->
  <meta property="og:title" content="{% if page.title %}{{ page.title | escape }}{% else %}{{ site.title }}{% endif %}">
  <meta property="og:description" content="{% if page.excerpt %}{{ page.excerpt | strip_html | strip_newlines | truncate: 160 }}{% elsif page.description %}{{ page.description }}{% else %}{{ site.description }}{% endif %}">
  <meta property="og:url" content="{{ page.url | absolute_url }}">
  <meta property="og:site_name" content="{{ site.title }}">
  <meta property="og:type" content="{% if page.layout == 'post' %}article{% else %}website{% endif %}">
  <meta property="og:locale" content="ko_KR">
  {% if page.layout == 'post' %}
  <meta property="article:author" content="{{ site.author.name }}">
  <meta property="article:published_time" content="{{ page.date | date_to_xmlschema }}">
  {% if page.date != page.last_modified_at %}
  <meta property="article:modified_time" content="{{ page.last_modified_at | date_to_xmlschema }}">
  {% endif %}
  {% if page.category %}
  <meta property="article:section" content="{{ page.category }}">
  {% endif %}
  {% if page.tags %}
  {% for tag in page.tags %}
  <meta property="article:tag" content="{{ tag }}">
  {% endfor %}
  {% endif %}
  {% endif %}
  {% comment %}OG ì´ë¯¸ì§€ ìš°ì„ ìˆœìœ„: 1) page.og_image, 2) ìë™ ìƒì„±ëœ OG ì´ë¯¸ì§€, 3) page.image, 4) site.og_image, 5) site.logo {% endcomment %}
  {% assign og_image = page.og_image %}
  
  {% comment %}í¬ìŠ¤íŠ¸ì¸ ê²½ìš° ìë™ ìƒì„±ëœ OG ì´ë¯¸ì§€ ì°¾ê¸°{% endcomment %}
  {% if page.layout == 'post' and og_image == nil %}
    {% assign post_slug = page.name | replace: '.md', '' | replace: '.html', '' %}
    {% comment %}ì˜ì–´ íŒŒì¼ëª… ìš°ì„  ì‹œë„ (í•œê¸€ íŒŒì¼ëª…ì€ URL ì¸ì½”ë”© ë¬¸ì œ ë°œìƒ ê°€ëŠ¥){% endcomment %}
    {% comment %}ì‹¤ì œ íŒŒì¼ëª… íŒ¨í„´: YYYY-MM-DD-Title_og.png (ì˜ì–´, ì–¸ë”ìŠ¤ì½”ì–´ ì‚¬ìš©){% endcomment %}
    {% assign auto_og_image = '/assets/images/' | append: post_slug | append: '_og.png' %}
    {% assign og_image = auto_og_image %}
  {% endif %}
  
  {% if og_image == nil %}
    {% assign og_image = page.image | default: site.og_image | default: site.logo %}
  {% endif %}
  
  {% if og_image %}
    {% comment %}LinkedInì€ SVGë¥¼ ì§€ì›í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ PNGë¡œ ë³€í™˜ëœ ì´ë¯¸ì§€ ìš°ì„  ì‚¬ìš©{% endcomment %}
    {% assign og_image_url = og_image | absolute_url %}
    {% assign og_image_type = "image/png" %}
    
    {% if og_image contains '.svg' %}
      {% comment %}SVG íŒŒì¼ì¸ ê²½ìš° PNG ë²„ì „ ìš°ì„  ì‹œë„{% endcomment %}
      {% assign og_image_png = og_image | replace: '.svg', '.png' %}
      {% assign og_image_url = og_image_png | absolute_url %}
      {% assign og_image_type = "image/png" %}
    {% elsif og_image contains '.jpg' or og_image contains '.jpeg' %}
      {% assign og_image_type = "image/jpeg" %}
    {% elsif og_image contains '.png' %}
      {% assign og_image_type = "image/png" %}
    {% elsif og_image contains '.webp' %}
      {% assign og_image_type = "image/webp" %}
    {% endif %}
    
  <meta property="og:image" content="{{ og_image_url }}">
  <meta property="og:image:secure_url" content="{{ og_image_url }}">
  <meta property="og:image:width" content="{{ site.og_image_width | default: 1200 }}">
  <meta property="og:image:height" content="{{ site.og_image_height | default: 630 }}">
  <meta property="og:image:type" content="{{ og_image_type }}">
  <meta property="og:image:alt" content="{% if page.title %}{{ page.title | escape }}{% else %}{{ site.title }}{% endif %}">
  {% endif %}

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="{% if page.title %}{{ page.title | escape }}{% else %}{{ site.title }}{% endif %}">
  <meta name="twitter:description" content="{% if page.excerpt %}{{ page.excerpt | strip_html | strip_newlines | truncate: 160 }}{% elsif page.description %}{{ page.description }}{% else %}{{ site.description }}{% endif %}">
  {% if site.twitter.username %}
  <meta name="twitter:site" content="{{ site.twitter.username }}">
  <meta name="twitter:creator" content="{{ site.twitter.username }}">
  {% endif %}
  {% if og_image %}
  <meta name="twitter:image" content="{{ og_image | absolute_url }}">
  <meta name="twitter:image:alt" content="{% if page.title %}{{ page.title | escape }}{% else %}{{ site.title }}{% endif %}">
  {% endif %}

  <!-- KakaoTalk Sharing (uses Open Graph) -->
  <meta name="format-detection" content="telephone=no">

  <!-- Feeds -->
  <link rel="alternate" type="application/rss+xml" title="{{ site.title }}" href="{{ "/feed.xml" | relative_url }}">
  <link rel="alternate" type="application/atom+xml" title="{{ site.title }}" href="{{ "/feed.xml" | relative_url }}">

  <!-- Favicon - PNG íŒŒì¼ ì§ì ‘ ì‚¬ìš© (ë³´ì•ˆ ë° íš¨ìœ¨ì„± í–¥ìƒ) -->
  <link rel="icon" type="image/png" href="{{ "/assets/images/favicon.png" | absolute_url }}">
  <link rel="apple-touch-icon" href="{{ "/assets/images/apple-touch-icon.png" | absolute_url }}">
  <!-- Fallback: SVG ì•„ì´ì½˜ (PNG ë¡œë“œ ì‹¤íŒ¨ ì‹œ) -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ”’</text></svg>">

  <!-- Fonts: Noto Sans KR (í•œê¸€ ê°€ë…ì„±, font-display: swap) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Preload Critical Resources -->
  <link rel="preload" href="{{ "/assets/css/main.css" | relative_url }}" as="style">
  <link rel="preload" href="{{ "/assets/js/main.js" | relative_url }}" as="script">
  {% comment %}OG ì´ë¯¸ì§€ preloadëŠ” ì œê±° (404 ì˜¤ë¥˜ ë° ì„±ëŠ¥ ë¬¸ì œ ë°©ì§€){% endcomment %}
  {% comment %}OG ì´ë¯¸ì§€ëŠ” ë©”íƒ€ íƒœê·¸ë¡œë§Œ ì‚¬ìš©í•˜ê³ , preloadëŠ” í•˜ì§€ ì•ŠìŒ{% endcomment %}

  <!-- DNS Prefetch and Preconnect for External Resources (TTFB ìµœì í™”) -->
  <!-- Critical resources: preconnect (DNS + TCP + TLS) - SentryëŠ” ì—ëŸ¬ ì¶”ì ì„ ìœ„í•´ ë¹ ë¥¸ ë¡œë”© í•„ìš” -->
  <link rel="preconnect" href="https://js.sentry-cdn.com" crossorigin>
  <!-- Google Translate: preconnect for faster widget loading -->
  <link rel="preconnect" href="https://translate.google.com">
  <link rel="preconnect" href="https://translate.googleapis.com">
  <!-- Non-critical resources: dns-prefetch only (ì§€ì—° ë¡œë”©ë˜ëŠ” ë¦¬ì†ŒìŠ¤) -->
  <link rel="dns-prefetch" href="https://giscus.app">
  <link rel="dns-prefetch" href="https://api.deepseek.com">
  <link rel="dns-prefetch" href="https://api.mymemory.translated.net">
  <link rel="dns-prefetch" href="https://pagead2.googlesyndication.com">
  <link rel="dns-prefetch" href="https://www.googletagmanager.com">
  <link rel="dns-prefetch" href="https://va.vercel-scripts.com">
  <link rel="dns-prefetch" href="https://www.gstatic.com">
  
  {% if page.layout == 'post' and page.image %}
  <!-- Preload critical post image -->
  <link rel="preload" href="{{ page.image | relative_url }}" as="image" fetchpriority="high">
  {% endif %}
  
  {% if page.layout == 'post' %}
  <!-- Prefetch next/related posts for better navigation performance -->
  <link rel="prefetch" href="{{ "/assets/css/main.css" | relative_url }}" as="style">
  {% endif %}

  <!-- Image Optimizer (deferred for performance) -->
  <script src="{{ "/assets/js/image-optimizer.js" | relative_url }}" defer></script>
  
  <!-- Ad Optimizer (CLS ë°©ì§€, deferred for performance) -->
  <script src="{{ "/assets/js/ad-optimizer.js" | relative_url }}" defer></script>
  
  <!-- Critical CSS inline (if needed for above-the-fold content) -->
  {% if page.layout == 'post' %}
  <style>
    /* Critical above-the-fold styles inline for faster rendering */
    .post-header { opacity: 0; animation: fadeIn 0.3s ease-in forwards; }
    @keyframes fadeIn { to { opacity: 1; } }
    /* Prevent layout shift for images */
    .post-image img { display: block; max-width: 100%; height: auto; }
    .post-content img { max-width: 100%; height: auto; display: block; }
    /* Critical layout styles */
    .post-article { max-width: 800px; margin: 0 auto; padding: 2rem 1.5rem; }
    .post-title { font-size: 2rem; font-weight: 700; margin: 1rem 0; line-height: 1.2; }
    .post-meta { display: flex; gap: 1rem; flex-wrap: wrap; margin: 1rem 0; font-size: 0.875rem; color: var(--color-text-secondary); }
    /* Prevent FOUC */
    body { visibility: hidden; }
    body.loaded { visibility: visible; }
  </style>
  {% endif %}

  <!-- Font Optimizer -->
  {% include font-optimizer.html %}

  <!-- Styles -->
  <link rel="stylesheet" href="{{ "/assets/css/main.css" | relative_url }}">

  <!-- Body loaded class for FOUC prevention -->
  <script>
    // Mark body as loaded to prevent FOUC
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function() {
        document.body.classList.add('loaded');
      });
    } else {
      document.body.classList.add('loaded');
    }
  </script>

  <!-- Service Worker Registration -->
  <script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
      navigator.serviceWorker.register('/sw.js')
        .then(function(registration) {
          // ì„œë¹„ìŠ¤ ì›Œì»¤ ì—…ë°ì´íŠ¸ í™•ì¸
          registration.addEventListener('updatefound', function() {
            const newWorker = registration.installing;
            newWorker.addEventListener('statechange', function() {
              if (newWorker.state === 'activated') {
                // ìƒˆ ì„œë¹„ìŠ¤ ì›Œì»¤ í™œì„±í™” ì‹œ í˜ì´ì§€ ë¦¬ë¡œë“œ ì œì•ˆ
                if (navigator.serviceWorker.controller) {
                  console.log('[Service Worker] New version available');
                }
              }
            });
          });
          
          // ê°œë°œ í™˜ê²½ì—ì„œë§Œ ë¡œê·¸
          if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            console.log('Service Worker registered:', registration.scope);
          }
        })
        .catch(function(error) {
          // í”„ë¡œë•ì…˜ì—ì„œëŠ” ì¡°ìš©íˆ ì‹¤íŒ¨
          if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            console.log('Service Worker registration failed:', error);
          }
        });
      
      // ì„œë¹„ìŠ¤ ì›Œì»¤ ì—…ë°ì´íŠ¸ ì²´í¬
      if (navigator.serviceWorker.controller) {
        navigator.serviceWorker.controller.postMessage({ type: 'SKIP_WAITING' });
      }
    });
  }
  </script>

  <!-- Theme Detection (Inline for Performance) - ì‹œìŠ¤í…œ ì„¤ì • ìš°ì„  -->
  <script>
    (function() {
      var saved = localStorage.getItem('theme');
      var systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      // ì €ì¥ê°’ì´ ì—†ê±°ë‚˜ 'system'ì´ë©´ ì‹œìŠ¤í…œ ì„¤ì • ë”°ë¦„
      var theme = (!saved || saved === 'system') ? (systemDark ? 'dark' : 'light') : saved;
      document.documentElement.setAttribute('data-theme', theme);
    })();
  </script>

  <!-- Structured Data (JSON-LD) for SEO -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "{% if page.layout == 'post' %}BlogPosting{% else %}WebSite{% endif %}",
    "headline": "{% if page.title %}{{ page.title | escape }}{% else %}{{ site.title }}{% endif %}",
    "description": "{% if page.excerpt %}{{ page.excerpt | strip_html | strip_newlines | truncate: 160 }}{% elsif page.description %}{{ page.description }}{% else %}{{ site.description }}{% endif %}",
    "url": "{{ page.url | absolute_url }}",
    "datePublished": "{% if page.date %}{{ page.date | date_to_xmlschema }}{% endif %}",
    "dateModified": "{% if page.last_modified_at %}{{ page.last_modified_at | date_to_xmlschema }}{% elsif page.date %}{{ page.date | date_to_xmlschema }}{% endif %}",
    "author": {
      "@type": "Person",
      "name": "{{ site.author.name }}",
      "url": "{{ site.url }}"
    },
    "publisher": {
      "@type": "Organization",
      "name": "{{ site.title }}",
      "logo": {
        "@type": "ImageObject",
        "url": "{{ site.logo | absolute_url }}"
      }
    }{% if og_image %},
    "image": {
      "@type": "ImageObject",
      "url": "{{ og_image_url }}",
      "width": {{ site.og_image_width | default: 1200 }},
      "height": {{ site.og_image_height | default: 630 }}
    }{% endif %}{% if page.category %},
    "articleSection": "{{ page.category }}"{% endif %}{% if page.tags %},
    "keywords": "{{ page.tags | join: ', ' }}"{% endif %}
  }
  </script>

  {% if site.google_analytics %}
  <!-- Google Analytics (deferred for performance) -->
  <script>
    // Defer Google Analytics loading until after page load
    window.addEventListener('load', function() {
      var script = document.createElement('script');
      script.async = true;
      script.src = 'https://www.googletagmanager.com/gtag/js?id={{ site.google_analytics }}';
      document.head.appendChild(script);
      
      script.onload = function() {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', '{{ site.google_analytics }}', {
          'send_page_view': false
        });
        // Trigger page view after load
        gtag('event', 'page_view', {
          'page_path': window.location.pathname + window.location.search
        });
      };
    });
  </script>
  {% endif %}

  {% if site.google_adsense %}
  <!-- Google AdSense (deferred for performance) -->
  <script>
    // Defer AdSense loading until after page load
    window.addEventListener('load', function() {
      var script = document.createElement('script');
      script.async = true;
      script.src = 'https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client={{ site.google_adsense }}';
      script.crossOrigin = 'anonymous';
      
      // ì—ëŸ¬ í•¸ë“¤ë§: 403 ë“± ì—ëŸ¬ ë°œìƒ ì‹œ ì¡°ìš©íˆ ì²˜ë¦¬
      script.onerror = function() {
        // AdSense ë¡œë“œ ì‹¤íŒ¨ëŠ” ì¡°ìš©íˆ ì²˜ë¦¬ (ê³„ì • ë¬¸ì œ, CSP ì •ì±… ë“±)
        // ì½˜ì†” ì—ëŸ¬ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŒ
      };
      
      document.head.appendChild(script);
    });
  </script>
  {% endif %}

  {% seo %}

  <!-- Sentry Error Tracking (ìµœìƒë‹¨ì— ìœ„ì¹˜ - ì—ëŸ¬ ì¶”ì  ìš°ì„ , í•˜ì§€ë§Œ ìŠ¤í¬ë¦½íŠ¸ëŠ” deferë¡œ ë¡œë”©) -->
  {% include sentry.html %}
  
  <!-- Vercel Analytics & Speed Insights (TTFB ìµœì í™”: defer ì‚¬ìš©, ìµœí•˜ë‹¨ìœ¼ë¡œ ì´ë™) -->
  <!-- Note: AnalyticsëŠ” í˜ì´ì§€ ë¡œë“œ í›„ ì‹¤í–‰ë˜ë„ë¡ defer ì‚¬ìš© -->
  
  <!-- Performance Monitoring -->
  {% include performance-monitor.html %}
</head>
