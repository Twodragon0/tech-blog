<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google" content="notranslate">

  <!-- Console Filter Module (deferred to reduce FID impact) -->
  <script src="{{ "/assets/js/console-filter.js" | relative_url }}" defer></script>
  <script>
  // Initialize console filter after script loads (defer compatible)
  document.addEventListener('DOMContentLoaded', function() {
    // Wait for console-filter.js to load and initialize
    var initFilter = function() {
      if (window.initConsoleFilter) {
        window.initConsoleFilter();
      } else {
        // Retry if script not yet loaded (defer race condition)
        setTimeout(initFilter, 50);
      }
    };

    if ('requestIdleCallback' in window) {
      requestIdleCallback(initFilter, { timeout: 1000 });
    } else {
      setTimeout(initFilter, 100);
    }
  });
  </script>

  <!-- Security Headers -->
  <!--
    Î≥¥Ïïà Ìó§Îçî ÏÑ§Ï†ï:
    - Vercel.jsonÏóêÏÑú HTTP Ìó§ÎçîÎ°ú Ï§ëÏïô Í¥ÄÎ¶¨Îê©ÎãàÎã§.
    - Content-Security-Policy (CSP)
      * 'unsafe-eval'ÏùÄ Google Translate, Google Ads Îì± third-party Ïä§ÌÅ¨Î¶ΩÌä∏ Ìò∏ÌôòÏÑ±ÏùÑ ÏúÑÌï¥ ÌïÑÏöîÌï©ÎãàÎã§.
      * Ïù¥Îäî Ï†ïÏÉÅÏ†ÅÏù∏ ÏÑ§Ï†ïÏù¥Î©∞, third-party Ïä§ÌÅ¨Î¶ΩÌä∏Ïùò eval() ÏÇ¨Ïö©ÏùÑ ÌóàÏö©Ìï©ÎãàÎã§.
      * Ïö∞Î¶¨ ÏÇ¨Ïù¥Ìä∏Ïùò ÏûêÏ≤¥ ÏΩîÎìúÏóêÏÑúÎäî eval()ÏùÑ ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÏäµÎãàÎã§.
    - X-Content-Type-Options
    - Referrer-Policy
    - Strict-Transport-Security
    - X-Frame-Options
    
    Ï∞∏Í≥†:
    - CSP eval() Í≤ΩÍ≥†: Google Translate, Google Ads Îì± third-party Ïä§ÌÅ¨Î¶ΩÌä∏Í∞Ä eval()ÏùÑ ÏÇ¨Ïö©ÌïòÎØÄÎ°ú
      'unsafe-eval'Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§. Ïù¥Îäî Î≥¥Ïïà Í∞êÏÇ¨ ÎèÑÍµ¨ÏóêÏÑú Í≤ΩÍ≥†Î•º ÌëúÏãúÌï† Ïàò ÏûàÏßÄÎßå,
      third-party Ïä§ÌÅ¨Î¶ΩÌä∏ Ìò∏ÌôòÏÑ±ÏùÑ ÏúÑÌï¥ ÌïÑÏöîÌïú ÏÑ§Ï†ïÏûÖÎãàÎã§.
      * Ïö∞Î¶¨ ÏÇ¨Ïù¥Ìä∏Ïùò ÏûêÏ≤¥ ÏΩîÎìúÏóêÏÑúÎäî eval(), new Function(), setTimeout(string), setInterval(string)ÏùÑ ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÏäµÎãàÎã§.
      * Î™®Îì† setTimeout/setInterval Ìò∏Ï∂úÏùÄ Ìï®Ïàò Ï∞∏Ï°∞Î•º ÏÇ¨Ïö©ÌïòÎ©∞ Î¨∏ÏûêÏó¥ÏùÑ ÌèâÍ∞ÄÌïòÏßÄ ÏïäÏäµÎãàÎã§.
    - Form field id/name: 
      * Ïö∞Î¶¨ ÏÇ¨Ïù¥Ìä∏Ïùò Î™®Îì† Ìèº ÌïÑÎìúÎäî idÏôÄ name ÏÜçÏÑ±ÏùÑ Ìè¨Ìï®Ìï©ÎãàÎã§:
        - Chat widget input: id="chat-widget-input", name="message"
        - Search input: id="search-input", name="search"
        - Google Translate select: ÎèôÏ†ÅÏúºÎ°ú id="google-translate-select", name="google-translate-language" Ï∂îÍ∞ÄÎê®
      * Giscus, Google Ads Îì± third-party ÏúÑÏ†ØÏù¥ iframe ÎÇ¥ÏóêÏÑú ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±ÌïòÎäî form ÌïÑÎìúÎäî
        id/name ÏÜçÏÑ±Ïù¥ ÏóÜÏùÑ Ïàò ÏûàÏäµÎãàÎã§. Ïù¥Îäî third-party ÏúÑÏ†ØÏùò Ï†ïÏÉÅÏ†ÅÏù∏ ÎèôÏûëÏù¥Î©∞,
        iframe ÎÇ¥Î∂ÄÏù¥ÎØÄÎ°ú Ïö∞Î¶¨ ÏÇ¨Ïù¥Ìä∏Ïùò Ï†ëÍ∑ºÏÑ± Ï†ïÏ±ÖÏóê ÏòÅÌñ•ÏùÑ Ï£ºÏßÄ ÏïäÏäµÎãàÎã§.
    - DOCTYPE: Î™®Îì† ÌéòÏù¥ÏßÄÎäî _layouts/default.htmlÏùÑ ÌÜµÌï¥ <!DOCTYPE html>ÏùÑ Ìè¨Ìï®ÌïòÏó¨ Quirks ModeÎ•º Î∞©ÏßÄÌï©ÎãàÎã§.
      * Google Ads iframe ÎÇ¥Î∂ÄÏùò Quirks ModeÎäî GoogleÏùò Ï†úÏñ¥ ÌïòÏóê ÏûàÏúºÎ©∞ Ïö∞Î¶¨ ÏÇ¨Ïù¥Ìä∏Ïóê ÏòÅÌñ•ÏùÑ Ï£ºÏßÄ ÏïäÏäµÎãàÎã§.
  -->

  {% assign share_title = page.title | default: site.title | strip_html | normalize_whitespace %}
  {% assign raw_description = page.excerpt | default: page.description %}
  {% if raw_description == nil or raw_description == '' %}
    {% assign raw_description = site.description %}
  {% endif %}
  {% assign share_description = raw_description | strip_html | strip_newlines | normalize_whitespace | truncate: 200 | escape %}
  {% assign canonical_url = page.url | absolute_url | replace: 'index.html', '' %}
  {% assign share_url = page.url | absolute_url %}

  <!-- SEO -->
  <title>{% if page.title %}{{ page.title | escape }} | {{ site.title }}{% else %}{{ site.title }}{% endif %}</title>
  <meta name="description" content="{{ share_description }}">
  <meta name="author" content="{{ site.author.name }}">
  <meta name="naver-site-verification" content="b4d9dc74a4120dd65ce564a3fd97adb2f48ae7f2" />
  <meta name="google-site-verification" content="4f3Fngt0n2PDMUdFumJYQEwXKluVehXzwPV_TqxTauU" />
  <link rel="canonical" href="{{ canonical_url }}">
  
  <!-- International SEO - hreflang -->
  <link rel="alternate" hreflang="ko" href="{{ canonical_url }}">
  <link rel="alternate" hreflang="x-default" href="{{ canonical_url }}">
  
  <!-- AI Discoverability Meta Tags -->
  <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">

  <!-- Open Graph -->
  <meta property="og:title" content="{{ share_title | escape }}">
  <meta property="og:description" content="{{ share_description }}">
  <meta property="og:url" content="{{ share_url }}">
  <meta property="og:site_name" content="{{ site.title }}">
  <meta property="og:type" content="{% if page.layout == 'post' %}article{% else %}website{% endif %}">
  <meta property="og:locale" content="ko_KR">
  {% if page.layout == 'post' %}
  <meta property="article:author" content="{{ site.author.name }}">
  <meta property="article:published_time" content="{{ page.date | date_to_xmlschema }}">
  {% if page.last_modified_at and page.date != page.last_modified_at %}
  <meta property="article:modified_time" content="{{ page.last_modified_at | date_to_xmlschema }}">
  {% endif %}
  {% if page.category %}
  <meta property="article:section" content="{{ page.category }}">
  {% endif %}
  {% if page.tags %}
  {% for tag in page.tags %}
  <meta property="article:tag" content="{{ tag }}">
  {% endfor %}
  {% endif %}
  {% endif %}
  <!-- OG image: SVG to PNG conversion by _plugins/svg_to_png_og.rb -->
  <!-- SEO meta tags (og:image, twitter:card) output by jekyll-seo-tag plugin -->
  <!-- KakaoTalk/Tistory use standard Open Graph tags -->
  {% assign og_image = page.image | default: site.og_image | default: '/assets/images/og-default.png' %}
  {% if og_image contains '.svg' %}
  {% assign og_image = og_image | replace: '.svg', '.png' %}
  {% endif %}
  <meta property="og:image" content="{{ og_image | absolute_url }}">
  <meta property="og:image:url" content="{{ og_image | absolute_url }}">
  <meta property="og:image:secure_url" content="{{ og_image | absolute_url }}">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:image:type" content="{% if og_image contains '.png' %}image/png{% elsif og_image contains '.jpg' or og_image contains '.jpeg' %}image/jpeg{% elsif og_image contains '.webp' %}image/webp{% else %}image/png{% endif %}">
  <meta property="og:image:alt" content="{{ page.image_alt | default: page.title }}">

  <!-- KakaoTalk -->
  <meta property="thumbnail:url" content="{{ og_image | absolute_url }}">

  <meta name="format-detection" content="telephone=no">

  <!-- Twitter Cards -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@Twodragon0">
  <meta name="twitter:creator" content="@Twodragon0">
  <meta name="twitter:title" content="{{ share_title | escape }}">
  <meta name="twitter:description" content="{{ share_description }}">
  <meta name="twitter:url" content="{{ share_url }}">
  <meta name="twitter:domain" content="{{ site.url | replace: 'https://', '' | replace: 'http://', '' }}">
  <meta name="twitter:image" content="{{ og_image | absolute_url }}">
  <meta name="twitter:image:alt" content="{% if page.image_alt %}{{ page.image_alt }}{% else %}{{ page.title | default: site.title }}{% endif %}">

  <!-- Feeds -->
  <link rel="alternate" type="application/rss+xml" title="{{ site.title }}" href="{{ "/feed.xml" | relative_url }}">
  <link rel="alternate" type="application/atom+xml" title="{{ site.title }}" href="{{ "/feed.xml" | relative_url }}">

  <!-- Favicon - PNG + ICO Ìè¥Î∞± (Î∏åÎùºÏö∞Ï†Ä ÌôïÏû• ÌîÑÎ°úÍ∑∏Îû® Ìò∏ÌôòÏÑ± Ìñ•ÏÉÅ) -->
  <link rel="icon" type="image/png" sizes="32x32" href="{{ "/assets/images/favicon.png" | absolute_url }}">
  <link rel="icon" type="image/png" sizes="16x16" href="{{ "/assets/images/favicon.png" | absolute_url }}">
  <link rel="shortcut icon" href="{{ "/assets/images/favicon.png" | absolute_url }}">
  <link rel="apple-touch-icon" sizes="180x180" href="{{ "/assets/images/apple-touch-icon.png" | absolute_url }}">
  <!-- Fallback: SVG ÏïÑÏù¥ÏΩò (PNG Î°úÎìú Ïã§Ìå® Ïãú) -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üîí</text></svg>">

  <!-- Fonts: Noto Sans KR (ÌïúÍ∏Ä Í∞ÄÎèÖÏÑ±, font-display: swap, Îã®Ïùº ÏöîÏ≤≠) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
  <noscript><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet"></noscript>

  <!-- Prefetch Resources (preload Í≤ΩÍ≥† Î∞©ÏßÄÎ•º ÏúÑÌï¥ prefetch ÏÇ¨Ïö©) -->
  <!-- Î∂ÑÌï†Îêú JavaScript ÌååÏùºÎì§ÏùÑ prefetchÎ°ú ÎØ∏Î¶¨ Ï∫êÏãú -->
  <link rel="prefetch" href="{{ "/assets/js/main-core.js" | relative_url }}" as="script">
  {% if page.layout == 'post' %}
  <link rel="prefetch" href="{{ "/assets/js/main-post.js" | relative_url }}" as="script">
  <link rel="prefetch" href="{{ "/assets/js/post-page.js" | relative_url }}" as="script">
  <link rel="prefetch" href="{{ "/assets/js/mermaid-init.js" | relative_url }}" as="script">
  {% endif %}
  <link rel="prefetch" href="{{ "/assets/js/main-search.js" | relative_url }}" as="script">
  {% comment %}OG Ïù¥ÎØ∏ÏßÄ preloadÎäî Ï†úÍ±∞ (404 Ïò§Î•ò Î∞è ÏÑ±Îä• Î¨∏Ï†ú Î∞©ÏßÄ){% endcomment %}
  {% comment %}OG Ïù¥ÎØ∏ÏßÄÎäî Î©îÌÉÄ ÌÉúÍ∑∏Î°úÎßå ÏÇ¨Ïö©ÌïòÍ≥†, preloadÎäî ÌïòÏßÄ ÏïäÏùå{% endcomment %}

  <!-- DNS Prefetch and Preconnect for External Resources (TTFB ÏµúÏ†ÅÌôî) -->
  {% if site.sentry_dsn and site.sentry_dsn != "" %}
  <link rel="preconnect" href="https://browser.sentry-cdn.com" crossorigin>
  {% endif %}
  <!-- Google Translate: dns-prefetch only (script lazy-loaded on user interaction) -->
  <link rel="dns-prefetch" href="https://translate.google.com">
  <link rel="dns-prefetch" href="https://translate.googleapis.com">
  <!-- Non-critical resources: dns-prefetch only (ÏßÄÏó∞ Î°úÎî©ÎêòÎäî Î¶¨ÏÜåÏä§) -->
  <link rel="dns-prefetch" href="https://giscus.app">
  <link rel="dns-prefetch" href="https://api.deepseek.com">
  <link rel="dns-prefetch" href="https://api.mymemory.translated.net">
  <link rel="dns-prefetch" href="https://pagead2.googlesyndication.com">
  <link rel="dns-prefetch" href="https://www.googletagmanager.com">
  <link rel="dns-prefetch" href="https://va.vercel-scripts.com">
  <link rel="dns-prefetch" href="https://www.gstatic.com">
  
  {% if page.layout == 'post' and page.image %}
  <!-- Preload critical post image -->
  <link rel="preload" href="{{ page.image | relative_url }}" as="image" fetchpriority="high">
  {% endif %}
  
  <!-- Ad Optimizer (CLS Î∞©ÏßÄ, deferred for performance) -->
  <script src="{{ "/assets/js/ad-optimizer.js" | relative_url }}" defer></script>
  
  <!-- Critical CSS inline (if needed for above-the-fold content) -->
  {% if page.layout == 'post' %}
  <style>
    /* Critical above-the-fold styles inline for faster rendering */
    .post-header { opacity: 0; animation: fadeIn 0.3s ease-in forwards; }
    @keyframes fadeIn { to { opacity: 1; } }
    /* Prevent layout shift for images */
    .post-image img { display: block; max-width: 100%; height: auto; }
    .post-content img { max-width: 100%; height: auto; display: block; }
    /* Critical layout styles */
    .post-article { max-width: 800px; margin: 0 auto; padding: 2rem 1.5rem; }
    .post-title { font-size: 2rem; font-weight: 700; margin: 1rem 0; line-height: 1.2; }
    .post-meta { display: flex; gap: 1rem; flex-wrap: wrap; margin: 1rem 0; font-size: 0.875rem; color: var(--color-text-secondary); }
  </style>
  {% endif %}

<!-- Styles - Primary with GitHub Pages fallback -->
  <!-- Critical CSS for layout stability (inline) -->
  <style>
    /* Prevent FOUC and layout shifts */
    body { opacity: 0; transition: opacity 0.3s ease; }
    body.loaded { opacity: 1; }

    /* Basic responsive layout */
    .post-article { max-width: 800px; margin: 0 auto; padding: 2.5rem 2rem; }
    .post-header { margin-bottom: 1.5rem; }
    .post-title { font-size: clamp(1.5rem, 4vw, 2.25rem); margin: 0.5rem 0 1rem; }

    /* Mobile responsiveness */
    @media (max-width: 768px) {
      .post-article { padding: 1.25rem 1rem; }
      .post-title { font-size: clamp(1.25rem, 5vw, 1.75rem); }
    }

    /* TOC container - prevent layout shift */
    .toc-container { margin-bottom: 2rem; background-color: #f8f9fa; border-radius: 12px; border: 1px solid #dee2e6; }
    .toc-card { display: flex; flex-direction: column; overflow: hidden; border-radius: inherit; }
    .toc-header { display: flex; align-items: center; justify-content: space-between; padding: 1rem 1.25rem; border-bottom: 1px solid #dee2e6; }
    .toc-nav { padding: 0.75rem 1rem 1rem; }

    /* Dark mode basic support */
    @media (prefers-color-scheme: dark) {
      body { background-color: #0d1117; color: #c9d1d9; }
      .toc-container { background-color: #161b22; border-color: #30363d; }
    }
  </style>

  <!-- Main CSS with JS-based fallback (CSP-safe, no inline onerror) -->
  <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}?v={{ site.time | date: '%s' }}" id="main-stylesheet" fetchpriority="high">
  <noscript><link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}"></noscript>
  <script>
    // CSS load fallback (replaces inline onerror for CSP compliance)
    (function() {
      var link = document.getElementById('main-stylesheet');
      if (!link) return;
      link.onerror = function() {
        var s = document.createElement('style');
        s.textContent = 'body{font-family:"Noto Sans KR",-apple-system,sans-serif;margin:0;padding:0;background:#fff;color:#1a1a1a}.post-article{max-width:800px;margin:0 auto;padding:2.5rem 2rem}.post-title{font-size:clamp(1.5rem,4vw,2.25rem);margin:.5rem 0 1rem}.post-content{font-size:1.0625rem;line-height:1.8}[data-theme="dark"]{background:#0f172a;color:#f1f5f9}';
        document.head.appendChild(s);
        link.remove();
      };
    })();
  </script>

  {% if page.layout == 'post' %}
  <!-- Post-specific CSS (post, lightbox, syntax) -->
  <link rel="stylesheet" href="{{ '/assets/css/post-page.css' | relative_url }}?v={{ site.time | date: '%s' }}">
  {% endif %}
  {% if page.url contains '/certifications' %}
  <!-- Certification page CSS -->
  <link rel="stylesheet" href="{{ '/assets/css/cert-page.css' | relative_url }}?v={{ site.time | date: '%s' }}">
  {% endif %}

  <!-- Body loaded class for FOUC prevention -->
  <script>
    // Mark body as loaded to prevent FOUC
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function() {
        document.body.classList.add('loaded');
      });
    } else {
      document.body.classList.add('loaded');
    }
  </script>

  <!-- Service Worker Registration (deferred to idle) -->
  <script>
  if ('serviceWorker' in navigator) {
    // Use requestIdleCallback to defer non-critical SW registration
    var registerSW = function() {
      navigator.serviceWorker.register('/sw.js')
        .then(function(registration) {
          registration.addEventListener('updatefound', function() {
            var newWorker = registration.installing;
            newWorker.addEventListener('statechange', function() {
              if (newWorker.state === 'activated' && navigator.serviceWorker.controller) {
                var isDev = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
                if (isDev) console.debug('[SW] New version ready');
              }
            });
          });
        })
        .catch(function() {});

      if (navigator.serviceWorker.controller) {
        navigator.serviceWorker.controller.postMessage({ type: 'SKIP_WAITING' });
      }
    };

    // Defer SW registration using requestIdleCallback (non-blocking)
    if ('requestIdleCallback' in window) {
      requestIdleCallback(registerSW, { timeout: 2000 });
    } else {
      window.addEventListener('load', registerSW);
    }
  }
  </script>

  <!-- Theme Detection (Inline for Performance) - ÏãúÏä§ÌÖú ÏÑ§Ï†ï Ïö∞ÏÑ† -->
  <script>
    (function() {
      var saved = localStorage.getItem('theme');
      var systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      // Ï†ÄÏû•Í∞íÏù¥ ÏóÜÍ±∞ÎÇò 'system'Ïù¥Î©¥ ÏãúÏä§ÌÖú ÏÑ§Ï†ï Îî∞Î¶Ñ
      var theme = (!saved || saved === 'system') ? (systemDark ? 'dark' : 'light') : saved;
      document.documentElement.setAttribute('data-theme', theme);
    })();
  </script>

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "{% if page.layout == 'post' %}BlogPosting{% else %}WebSite{% endif %}",
    "headline": "{% if page.title %}{{ page.title | escape }}{% else %}{{ site.title }}{% endif %}",
    "description": "{% if page.excerpt %}{{ page.excerpt | strip_html | strip_newlines | truncate: 160 }}{% elsif page.description %}{{ page.description }}{% else %}{{ site.description }}{% endif %}",
    "url": "{{ page.url | absolute_url }}",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "{{ page.url | absolute_url }}"
    },
    "inLanguage": "ko-KR",
    "datePublished": "{% if page.date %}{{ page.date | date_to_xmlschema }}{% endif %}",
    "dateModified": "{% if page.last_modified_at %}{{ page.last_modified_at | date_to_xmlschema }}{% elsif page.date %}{{ page.date | date_to_xmlschema }}{% endif %}",
    "author": {
      "@type": "Person",
      "name": "{{ site.author.name }}",
      "url": "{{ site.url }}",
      "sameAs": [
        "https://github.com/Twodragon0"
      ]
    },
    "publisher": {
      "@type": "Organization",
      "name": "{{ site.title }}",
      "logo": {
        "@type": "ImageObject",
        "url": "{{ site.logo | absolute_url }}"
      }
    }{% if page.image %},
    "image": {
      "@type": "ImageObject",
      "url": "{{ page.image | absolute_url }}",
      "width": {{ site.og_image_width | default: 1200 }},
      "height": {{ site.og_image_height | default: 630 }}
    }{% endif %}{% if page.category %},
    "articleSection": "{{ page.category }}"{% endif %}{% if page.tags %},
    "keywords": "{{ page.tags | join: ', ' }}"{% endif %}
  }
  </script>

  {% if site.google_analytics %}
  <!-- Google Analytics (deferred to idle for better FID) -->
  <script>
    // Defer Google Analytics loading using requestIdleCallback (non-blocking)
    var loadGoogleAnalytics = function() {
      var script = document.createElement('script');
      script.async = true;
      script.src = 'https://www.googletagmanager.com/gtag/js?id={{ site.google_analytics }}';
      document.head.appendChild(script);

      script.onload = function() {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', '{{ site.google_analytics }}', {
          'send_page_view': false
        });
        // Trigger page view after load
        gtag('event', 'page_view', {
          'page_path': window.location.pathname + window.location.search
        });
      };
    };

    // Use requestIdleCallback for non-blocking deferred load
    if ('requestIdleCallback' in window) {
      requestIdleCallback(loadGoogleAnalytics, { timeout: 3000 });
    } else {
      window.addEventListener('load', loadGoogleAnalytics);
    }
  </script>
  {% endif %}

  {% if site.google_adsense %}
  <!-- Google AdSense (deferred to idle, graceful degradation) -->
  <script>
    (function() {
      'use strict';

      try {
        window.adsbygoogle = window.adsbygoogle || [];
        window.adsbygoogle.pauseAdRequests = 0;
        window._adsenseLoaded = false;

        var loadAdSense = function() {
          try {
            var script = document.createElement('script');
            script.async = true;
            script.src = 'https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client={{ site.google_adsense }}';
            script.crossOrigin = 'anonymous';
            script.setAttribute('data-ad-frequency-hint', '0');

            script.onload = function() {
              try {
                window._adsenseLoaded = true;
              } catch (e) {
                // Ignore onload error
              }
            };

            script.onerror = function() {
              try {
                // AdSense load failed (403, network error, ad blocker, etc.)
                // Remove all ad placeholders to prevent layout shift
                window._adsenseLoaded = false;
                var ads = document.querySelectorAll('.adsbygoogle');
                for (var i = 0; i < ads.length; i++) {
                  ads[i].style.display = 'none';
                }
              } catch (e) {
                // Ignore onerror processing error
              }
            };

            // Suppress fetch/network error logs for AdSense 403/400 errors
            script.addEventListener('error', function() {
              // Silently handled above - prevent additional console output
            }, { once: true });

            if (document.head) {
              document.head.appendChild(script);
            }
          } catch (e) {
            // Silently fail if AdSense script creation fails
            window._adsenseLoaded = false;
          }
        };

        // Use requestIdleCallback for non-blocking deferred load
        try {
          if ('requestIdleCallback' in window) {
            requestIdleCallback(loadAdSense, { timeout: 5000 });
          } else {
            window.addEventListener('load', loadAdSense);
          }
        } catch (e) {
          // Fallback: load immediately if requestIdleCallback fails
          try {
            loadAdSense();
          } catch (err) {
            // Final fallback: silently fail
          }
        }
      } catch (e) {
        // Global AdSense initialization failure - silently ignore
      }
    })();
  </script>
  
  <style>
    /* Hide Google Ads "Related Topics" UI (advertisement block) while keeping actual ads visible */
    .goog-rtopics,
    .google-anno-skip,
    .google-anno-sc,
    [aria-label="ÎèÑÏõÄÎßêÍ≥º Í¥ÄÎ†®Îêú Ï£ºÏ†ú Ï§ë Í¥ÄÏã¨Ïù¥ ÏûàÏùÑ ÎßåÌïú Ìï≠Î™©ÏûÖÎãàÎã§."] {
      display: none !important;
    }
    /* Hide unfilled/optimized ad placeholders including Related Topics container */
    .adsbygoogle[data-ad-status="unfill-optimized"],
    .adsbygoogle[data-ad-status="unfilled"] {
      display: none !important;
      height: 0 !important;
      min-height: 0 !important;
    }
    /* Hide parent ad-container when ad is unfilled */
    .ad-container:has(.adsbygoogle[data-ad-status="unfilled"]),
    .ad-container:has(.adsbygoogle[data-ad-status="unfill-optimized"]) {
      display: none !important;
      height: 0 !important;
      min-height: 0 !important;
      padding: 0 !important;
      margin: 0 !important;
    }
    /* Hide google-auto-placed ad containers when they contain Related Topics */
    .google-auto-placed:has(.goog-rtopics),
    .google-auto-placed:has(.google-anno-sc),
    .ad-container:has(.goog-rtopics),
    .ad-container:has(.google-anno-sc) {
      display: none !important;
      height: 0 !important;
      min-height: 0 !important;
    }
  </style>
  {% endif %}

  <!-- Sentry Error Tracking (ÏµúÏÉÅÎã®Ïóê ÏúÑÏπò - ÏóêÎü¨ Ï∂îÏ†Å Ïö∞ÏÑ†, ÌïòÏßÄÎßå Ïä§ÌÅ¨Î¶ΩÌä∏Îäî deferÎ°ú Î°úÎî©) -->
  {% include sentry.html %}
  
  <!-- Vercel Analytics & Speed Insights (TTFB ÏµúÏ†ÅÌôî: defer ÏÇ¨Ïö©, ÏµúÌïòÎã®ÏúºÎ°ú Ïù¥Îèô) -->
  <!-- Note: AnalyticsÎäî ÌéòÏù¥ÏßÄ Î°úÎìú ÌõÑ Ïã§ÌñâÎêòÎèÑÎ°ù defer ÏÇ¨Ïö© -->
  
  <!-- Performance Monitoring -->
  {% include performance-monitor.html %}
</head>
