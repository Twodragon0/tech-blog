<!-- Google Translate Integration -->
<script type="text/javascript">
// Google Translate 초기화
function googleTranslateElementInit() {
  new google.translate.TranslateElement({
    pageLanguage: 'ko',
    includedLanguages: 'en,ja,zh-CN,zh-TW',
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
    autoDisplay: false
  }, 'google_translate_element');
}

// 언어 토글 초기화
(function() {
  'use strict';

  var LANG_MAP = {
    'ko': 'KO',
    'en': 'EN',
    'ja': 'JA',
    'zh-CN': 'CN',
    'zh-TW': 'TW'
  };

  function initLangToggle() {
    var langToggle = document.getElementById('lang-toggle');
    var langDropdown = document.getElementById('lang-dropdown');
    var currentLangSpan = document.getElementById('current-lang');

    if (!langToggle || !langDropdown) {
      console.log('[Lang Toggle] Elements not found');
      return;
    }

    console.log('[Lang Toggle] Initializing...');

    // 토글 버튼 클릭
    langToggle.onclick = function(e) {
      e.preventDefault();
      e.stopPropagation();

      var isActive = langDropdown.classList.contains('active');
      console.log('[Lang Toggle] Clicked, isActive:', isActive);

      if (isActive) {
        langDropdown.classList.remove('active');
        langToggle.setAttribute('aria-expanded', 'false');
      } else {
        langDropdown.classList.add('active');
        langToggle.setAttribute('aria-expanded', 'true');
      }
    };

    // 외부 클릭 시 닫기
    document.addEventListener('click', function(e) {
      if (!langToggle.contains(e.target) && !langDropdown.contains(e.target)) {
        langDropdown.classList.remove('active');
        langToggle.setAttribute('aria-expanded', 'false');
      }
    });

    // 언어 옵션 클릭
    var langOptions = document.querySelectorAll('.lang-option');
    for (var i = 0; i < langOptions.length; i++) {
      langOptions[i].onclick = function(e) {
        e.preventDefault();
        e.stopPropagation();

        var lang = this.getAttribute('data-lang');
        console.log('[Lang Toggle] Language selected:', lang);

        // 드롭다운 닫기
        langDropdown.classList.remove('active');
        langToggle.setAttribute('aria-expanded', 'false');

        // 언어 표시 업데이트
        if (LANG_MAP[lang] && currentLangSpan) {
          currentLangSpan.textContent = LANG_MAP[lang];
        }

        // 언어 변경
        changeLang(lang);
      };
    }

    // 현재 언어 감지 및 표시
    var currentLang = getCurrentLang();
    if (LANG_MAP[currentLang] && currentLangSpan) {
      currentLangSpan.textContent = LANG_MAP[currentLang];
    }

    console.log('[Lang Toggle] Initialized successfully');
  }

  function getCurrentLang() {
    var match = document.cookie.match(/googtrans=\/ko\/([^;]+)/);
    return match ? match[1] : 'ko';
  }

  function changeLang(lang) {
    if (lang === 'ko') {
      // 원본으로 복원
      document.cookie = 'googtrans=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
      document.cookie = 'googtrans=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=.' + location.hostname;
      location.reload();
      return;
    }

    // 번역 쿠키 설정
    var cookieVal = '/ko/' + lang;
    document.cookie = 'googtrans=' + cookieVal + '; path=/;';
    document.cookie = 'googtrans=' + cookieVal + '; path=/; domain=.' + location.hostname;

    // Google Translate 트리거
    var select = document.querySelector('.goog-te-combo');
    if (select) {
      select.value = lang;
      select.dispatchEvent(new Event('change'));
    } else {
      location.reload();
    }
  }

  // DOM 준비 시 초기화
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initLangToggle);
  } else {
    initLangToggle();
  }
})();
</script>
<script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
