<!-- Google Translate Integration - ì‹œìŠ¤í…œ ì–¸ì–´ ì„¤ì • ìë™ ì ìš© -->
<script type="text/javascript">
// Google Translate ì´ˆê¸°í™” (ì§€ì—° ë¡œë”©)
var googleTranslateLoaded = false;

function googleTranslateElementInit() {
  try {
    if (typeof google === 'undefined' || !google.translate) {
      console.warn('Google Translate APIê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
      // ì¬ì‹œë„
      setTimeout(function() {
        if (typeof google !== 'undefined' && google.translate) {
          googleTranslateElementInit();
        }
      }, 500);
      return;
    }
    
    var element = document.getElementById('google_translate_element');
    if (!element) {
      console.warn('Google Translate ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      return;
    }
    
    new google.translate.TranslateElement({
      pageLanguage: 'ko',
      includedLanguages: 'en,ja,zh-CN,zh-TW',
      layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
      autoDisplay: false
    }, 'google_translate_element');
    
    googleTranslateLoaded = true;
  } catch (e) {
    console.error('Google Translate ì´ˆê¸°í™” ì‹¤íŒ¨:', e);
    // ì´ˆê¸°í™” ì‹¤íŒ¨í•´ë„ ê³„ì† ì§„í–‰ (ì¿ í‚¤ ê¸°ë°˜ ë²ˆì—­ì€ ì‘ë™í•  ìˆ˜ ìˆìŒ)
  }
}

// ì–¸ì–´ í† ê¸€ ì´ˆê¸°í™”
(function() {
  'use strict';

  var LANG_MAP = {
    'ko': 'KO',
    'en': 'EN',
    'ja': 'JA',
    'zh-CN': 'CN',
    'zh-TW': 'TW',
    'zh': 'CN'
  };

  /* data-lang ê¸°ë°˜ ë³µêµ¬ìš© (Google Translate DOM ë³€ê²½ í›„ UI ë³µì›) */
  var LANG_LABELS = {
    'ko': { flag: '\uD83C\uDDF0\uD83C\uDDF7', name: 'í•œêµ­ì–´' },
    'en': { flag: '\uD83C\uDDFA\uD83C\uDDF8', name: 'English' },
    'ja': { flag: '\uD83C\uDDEF\uD83C\uDDF5', name: 'æ—¥æœ¬èª' },
    'zh-CN': { flag: '\uD83C\uDDE8\uD83C\uDDF3', name: 'ç®€ä½“ä¸­æ–‡' },
    'zh-TW': { flag: '\uD83C\uDDF9\uD83C\uDDFC', name: 'ç¹é«”ä¸­æ–‡' }
  };

  var SUPPORTED_LANGS = ['ko', 'en', 'ja', 'zh-CN', 'zh-TW'];
  var translateScriptLoaded = false;
  var scriptLoadRetries = 0;
  var maxRetries = 3;

  // ì•ˆì „í•œ localStorage ì ‘ê·¼ (ì‹œí¬ë¦¿ ëª¨ë“œ ëŒ€ì‘)
  function safeLocalStorageGet(key) {
    try {
      return localStorage.getItem(key);
    } catch (e) {
      // ì‹œí¬ë¦¿ ëª¨ë“œë‚˜ ì¿ í‚¤ ì°¨ë‹¨ ì‹œ null ë°˜í™˜
      return null;
    }
  }

  function safeLocalStorageSet(key, value) {
    try {
      localStorage.setItem(key, value);
      return true;
    } catch (e) {
      // ì‹œí¬ë¦¿ ëª¨ë“œë‚˜ ì¿ í‚¤ ì°¨ë‹¨ ì‹œ ì‹¤íŒ¨
      return false;
    }
  }

  // ì•ˆì „í•œ sessionStorage ì ‘ê·¼ (ì‹œí¬ë¦¿ ëª¨ë“œ ëŒ€ì‘)
  function safeSessionStorageGet(key) {
    try {
      return sessionStorage.getItem(key);
    } catch (e) {
      return null;
    }
  }

  function safeSessionStorageSet(key, value) {
    try {
      sessionStorage.setItem(key, value);
      return true;
    } catch (e) {
      return false;
    }
  }

  function safeSessionStorageRemove(key) {
    try {
      sessionStorage.removeItem(key);
      return true;
    } catch (e) {
      return false;
    }
  }

  // ì•ˆì „í•œ ì¿ í‚¤ ì„¤ì • (ì‹œí¬ë¦¿ ëª¨ë“œ ëŒ€ì‘)
  function setCookie(name, value, days) {
    try {
      var expires = '';
      if (days) {
        var date = new Date();
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        expires = '; expires=' + date.toUTCString();
      }
      
      // SameSite ì†ì„± ì¶”ê°€ (ì‹œí¬ë¦¿ ëª¨ë“œ í˜¸í™˜ì„±)
      var cookieString = name + '=' + value + expires + '; path=/; SameSite=Lax';
      
      // HTTPSì¸ ê²½ìš° Secure ì†ì„± ì¶”ê°€
      if (location.protocol === 'https:') {
        cookieString += '; Secure';
      }
      
      document.cookie = cookieString;
      
      // ë„ë©”ì¸ ì¿ í‚¤ë„ ì‹œë„ (ì‹¤íŒ¨í•´ë„ ë¬´ì‹œ)
      try {
        var domainCookie = name + '=' + value + expires + '; path=/; domain=.' + location.hostname + '; SameSite=Lax';
        if (location.protocol === 'https:') {
          domainCookie += '; Secure';
        }
        document.cookie = domainCookie;
      } catch (e) {
        // ë„ë©”ì¸ ì¿ í‚¤ ì„¤ì • ì‹¤íŒ¨ëŠ” ë¬´ì‹œ
      }
      
      return true;
    } catch (e) {
      return false;
    }
  }

  // ì•ˆì „í•œ ì¿ í‚¤ ì½ê¸°
  function getCookie(name) {
    try {
      var nameEQ = name + '=';
      var ca = document.cookie.split(';');
      for (var i = 0; i < ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) === ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
      }
      return null;
    } catch (e) {
      return null;
    }
  }

  // ì¿ í‚¤ ì‚­ì œ
  function deleteCookie(name) {
    try {
      document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; SameSite=Lax';
      document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=.' + location.hostname + '; SameSite=Lax';
      return true;
    } catch (e) {
      return false;
    }
  }

  // ì‹œìŠ¤í…œ ì–¸ì–´ ê°ì§€
  function getSystemLanguage() {
    var lang = navigator.language || navigator.userLanguage || 'ko';
    lang = lang.toLowerCase();

    if (lang.startsWith('ko')) return 'ko';
    if (lang.startsWith('ja')) return 'ja';
    if (lang.startsWith('zh-tw') || lang.startsWith('zh-hant')) return 'zh-TW';
    if (lang.startsWith('zh')) return 'zh-CN';
    if (lang.startsWith('en')) return 'en';

    return 'ko';
  }

  // ì €ì¥ëœ ì–¸ì–´ ë˜ëŠ” ì‹œìŠ¤í…œ ì–¸ì–´ ê°€ì ¸ì˜¤ê¸°
  function getPreferredLanguage() {
    var saved = safeLocalStorageGet('preferredLang');
    if (!saved || saved === 'system') {
      return getSystemLanguage();
    }
    return saved;
  }

  // Google Translate ìŠ¤í¬ë¦½íŠ¸ ì§€ì—° ë¡œë”© (ì¬ì‹œë„ ë¡œì§ í¬í•¨)
  function loadTranslateScript(callback, retryCount) {
    retryCount = retryCount || 0;
    
    if (translateScriptLoaded) {
      if (callback) callback();
      return;
    }

    // ì´ë¯¸ ë¡œë”© ì¤‘ì¸ ìŠ¤í¬ë¦½íŠ¸ê°€ ìˆëŠ”ì§€ í™•ì¸
    var existingScript = document.querySelector('script[src*="translate_a/element.js"]');
    if (existingScript) {
      // ìŠ¤í¬ë¦½íŠ¸ê°€ ì´ë¯¸ ìˆìœ¼ë©´ ë¡œë“œ ì™„ë£Œ ëŒ€ê¸°
      var checkInterval = setInterval(function() {
        if (typeof google !== 'undefined' && google.translate) {
          clearInterval(checkInterval);
          translateScriptLoaded = true;
          if (callback) {
            setTimeout(callback, 500);
          }
        }
      }, 100);
      
      // ìµœëŒ€ 10ì´ˆ ëŒ€ê¸°
      setTimeout(function() {
        clearInterval(checkInterval);
      }, 10000);
      return;
    }

    var script = document.createElement('script');
    script.type = 'text/javascript';
    script.src = '//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit';
    
    script.onload = function() {
      // Google Translateê°€ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
      var initCheck = setInterval(function() {
        if (typeof google !== 'undefined' && google.translate && googleTranslateLoaded) {
          clearInterval(initCheck);
          translateScriptLoaded = true;
          scriptLoadRetries = 0;
          if (callback) {
            setTimeout(callback, 500);
          }
        }
      }, 100);
      
      // ìµœëŒ€ 5ì´ˆ ëŒ€ê¸°
      setTimeout(function() {
        clearInterval(initCheck);
        if (!translateScriptLoaded && retryCount < maxRetries) {
          // ì¬ì‹œë„
          scriptLoadRetries++;
          setTimeout(function() {
            loadTranslateScript(callback, retryCount + 1);
          }, 1000 * (retryCount + 1));
        }
      }, 5000);
    };
    
    script.onerror = function() {
      // ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„
      if (retryCount < maxRetries) {
        scriptLoadRetries++;
        setTimeout(function() {
          loadTranslateScript(callback, retryCount + 1);
        }, 1000 * (retryCount + 1));
      } else {
        console.warn('Google Translate ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© ì‹¤íŒ¨');
      }
    };
    
    document.head.appendChild(script);
  }

  function initLangToggle() {
    var langToggle = document.getElementById('lang-toggle');
    var langDropdown = document.getElementById('lang-dropdown');
    var langDropdownOverlay = document.getElementById('lang-dropdown-overlay');
    var currentLangSpan = document.getElementById('current-lang');

    if (!langToggle || !langDropdown) {
      return;
    }

    // í† ê¸€ ë²„íŠ¼ í´ë¦­ - addEventListener ì‚¬ìš©
    langToggle.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();

      var isActive = langDropdown.classList.contains('active');

      if (isActive) {
        langDropdown.classList.remove('active');
        langToggle.setAttribute('aria-expanded', 'false');
        if (langDropdownOverlay) {
          langDropdownOverlay.classList.remove('active');
          langDropdownOverlay.setAttribute('aria-hidden', 'true');
        }
      } else {
        langDropdown.classList.add('active');
        langToggle.setAttribute('aria-expanded', 'true');
        if (langDropdownOverlay) {
          langDropdownOverlay.classList.add('active');
          langDropdownOverlay.setAttribute('aria-hidden', 'false');
        }
      }
    }, true);

    // ë”ë¸”í´ë¦­ìœ¼ë¡œ ì‹œìŠ¤í…œ ì„¤ì •ìœ¼ë¡œ ë³µê·€
    langToggle.addEventListener('dblclick', function(e) {
      e.preventDefault();
      e.stopPropagation();
      safeLocalStorageSet('preferredLang', 'system');
      var sysLang = getSystemLanguage();
      if (LANG_MAP[sysLang] && currentLangSpan) {
        currentLangSpan.textContent = LANG_MAP[sysLang];
      }
      // ì‹œìŠ¤í…œ ì–¸ì–´ë¡œ ë³µê·€ ì‹œ í”Œë˜ê·¸ ì´ˆê¸°í™”
      safeSessionStorageRemove('langApplied');
      safeSessionStorageRemove('langChanging');
      changeLang(sysLang);
    }, true);

    // ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸° (overlay í´ë¦­ ì‹œì—ë„ ë‹«í˜)
    document.addEventListener('click', function(e) {
      var target = e.target;
      while (target && target.tagName === 'FONT') {
        target = target.parentNode;
      }
      if (!langToggle.contains(target) && !langDropdown.contains(target)) {
        langDropdown.classList.remove('active');
        langToggle.setAttribute('aria-expanded', 'false');
        if (langDropdownOverlay) {
          langDropdownOverlay.classList.remove('active');
          langDropdownOverlay.setAttribute('aria-hidden', 'true');
        }
      }
    });

    // ì–¸ì–´ ì˜µì…˜ í´ë¦­ - ì´ë²¤íŠ¸ ìœ„ì„ ì‚¬ìš©
    langDropdown.addEventListener('click', function(e) {
      var target = e.target;
      
      // font íƒœê·¸ë‚˜ í…ìŠ¤íŠ¸ ë…¸ë“œë¥¼ í†µê³¼í•˜ì—¬ lang-option ì°¾ê¸°
      while (target && !target.classList.contains('lang-option')) {
        if (target === langDropdown || target === document.body) {
          return;
        }
        target = target.parentNode;
      }

      if (target && target.classList.contains('lang-option')) {
        e.preventDefault();
        e.stopPropagation();

        var lang = target.getAttribute('data-lang');
        
        // lang ì†ì„±ì´ ì—†ìœ¼ë©´ í…ìŠ¤íŠ¸ì—ì„œ ì¶”ì¶œ ì‹œë„
        if (!lang) {
          var text = target.textContent.trim();
          if (text.includes('í•œêµ­ì–´') || text.includes('ğŸ‡°ğŸ‡·')) lang = 'ko';
          else if (text.includes('English') || text.includes('ğŸ‡ºğŸ‡¸')) lang = 'en';
          else if (text.includes('æ—¥æœ¬èª') || text.includes('ğŸ‡¯ğŸ‡µ')) lang = 'ja';
          else if (text.includes('ç®€ä½“ä¸­æ–‡') || text.includes('ğŸ‡¨ğŸ‡³')) lang = 'zh-CN';
          else if (text.includes('ç¹é«”ä¸­æ–‡') || text.includes('ğŸ‡¹ğŸ‡¼')) lang = 'zh-TW';
        }

        if (lang) {
          langDropdown.classList.remove('active');
          langToggle.setAttribute('aria-expanded', 'false');
          if (langDropdownOverlay) {
            langDropdownOverlay.classList.remove('active');
            langDropdownOverlay.setAttribute('aria-hidden', 'true');
          }

          if (LANG_MAP[lang] && currentLangSpan) {
            currentLangSpan.textContent = LANG_MAP[lang];
          }

          safeLocalStorageSet('preferredLang', lang);
          // ìˆ˜ë™ ì–¸ì–´ ë³€ê²½ ì‹œ í”Œë˜ê·¸ ì´ˆê¸°í™”
          safeSessionStorageRemove('langApplied');
          safeSessionStorageRemove('langChanging');
          changeLang(lang);
        }
      }
    }, true);

    // í˜„ì¬ ì–¸ì–´ ê°ì§€ ë° í‘œì‹œ (localStorage ìš°ì„ , ì¿ í‚¤ ë³´ì¡°)
    var currentLang = getCurrentLang();
    var savedPref = safeLocalStorageGet('preferredLang');
    var displayLang = currentLang;

    // localStorageì— ì‚¬ìš©ìê°€ ëª…ì‹œì ìœ¼ë¡œ ì„ íƒí•œ ì–¸ì–´ê°€ ìˆìœ¼ë©´ ìš°ì„  ì ìš©
    if (savedPref && savedPref !== 'system' && LANG_MAP[savedPref]) {
      displayLang = savedPref;
    }

    if (LANG_MAP[displayLang] && currentLangSpan) {
      currentLangSpan.textContent = LANG_MAP[displayLang];
    }

    // ì‹œìŠ¤í…œ ì–¸ì–´ ìë™ ì ìš©
    applySystemLanguage();
  }

  function getCurrentLang() {
    // ì¿ í‚¤ì—ì„œ ì–¸ì–´ ì •ë³´ ì½ê¸° (ë‹¤ì–‘í•œ í˜•ì‹ ì§€ì›)
    try {
      var cookie = getCookie('googtrans');
      if (cookie) {
        // /ko/[lang] í˜•ì‹
        var match = cookie.match(/\/ko\/([^\/;]+)/);
        if (match && match[1]) {
          return match[1];
        }
        // /auto/[lang] ë˜ëŠ” /[any]/[lang] í˜•ì‹ (Google Translateê°€ ë³€ê²½í•  ìˆ˜ ìˆìŒ)
        match = cookie.match(/\/[^\/]+\/([^\/;]+)/);
        if (match && match[1]) {
          return match[1];
        }
      }

      // ëŒ€ì²´ ë°©ë²•: document.cookie ì§ì ‘ ì½ê¸° (ë‹¤ì–‘í•œ í˜•ì‹)
      var directMatch = document.cookie.match(/googtrans=\/[^\/]+\/([^;\/]+)/);
      if (directMatch && directMatch[1]) {
        return directMatch[1];
      }
    } catch (e) {
      // ì¿ í‚¤ ì½ê¸° ì‹¤íŒ¨ ì‹œ í•œêµ­ì–´ë¡œ ê°„ì£¼
    }

    // ì¿ í‚¤ê°€ ì—†ìœ¼ë©´ í•œêµ­ì–´ë¡œ ê°„ì£¼
    return 'ko';
  }

  // ì‹œìŠ¤í…œ ì–¸ì–´ ìë™ ì ìš© (í•œ ë²ˆë§Œ ì‹¤í–‰)
  function applySystemLanguage() {
    // ì´ë¯¸ ì‹¤í–‰ë˜ì—ˆëŠ”ì§€ í™•ì¸ (ë¬´í•œ ë£¨í”„ ë°©ì§€)
    var appliedFlag = safeSessionStorageGet('langApplied');
    if (appliedFlag === 'true') {
      return;
    }

    var currentLang = getCurrentLang();
    var savedPref = safeLocalStorageGet('preferredLang');

    // ì‚¬ìš©ìê°€ ìˆ˜ë™ìœ¼ë¡œ ì„ íƒí•œ ì–¸ì–´ê°€ ìˆìœ¼ë©´ ê·¸ ì„¤ì •ì„ ìš°ì„  ì ìš©
    if (savedPref && savedPref !== 'system') {
      safeSessionStorageSet('langApplied', 'true');

      // í˜„ì¬ ì–¸ì–´ì™€ ì €ì¥ëœ ì„ íƒì´ ë‹¤ë¥´ë©´ ì €ì¥ëœ ì„ íƒìœ¼ë¡œ ë³€ê²½
      if (savedPref !== currentLang) {
        if (savedPref !== 'ko') {
          loadTranslateScript(function() {
            setTimeout(function() {
              changeLang(savedPref);
            }, 300);
          });
        } else if (currentLang !== 'ko') {
          changeLang('ko');
        }
      } else if (savedPref !== 'ko' && !translateScriptLoaded) {
        loadTranslateScript();
      }
      return;
    }

    // ì €ì¥ëœ ì„ íƒì´ ì—†ìœ¼ë©´ ì‹œìŠ¤í…œ ì–¸ì–´ ì ìš©
    var preferredLang = getPreferredLanguage();

    if (preferredLang !== currentLang) {
      // í”Œë˜ê·¸ ì„¤ì • (ë¬´í•œ ë£¨í”„ ë°©ì§€)
      safeSessionStorageSet('langApplied', 'true');

      // Google Translate ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© í›„ ì–¸ì–´ ë³€ê²½
      if (preferredLang !== 'ko') {
        loadTranslateScript(function() {
          setTimeout(function() {
            changeLang(preferredLang);
          }, 300);
        });
      } else if (currentLang !== 'ko') {
        changeLang('ko');
      }
    } else {
      // ì´ë¯¸ ì˜¬ë°”ë¥¸ ì–¸ì–´ë©´ í”Œë˜ê·¸ ì„¤ì •
      safeSessionStorageSet('langApplied', 'true');

      if (preferredLang !== 'ko' && !translateScriptLoaded) {
        loadTranslateScript();
      }
    }
  }

  function changeLang(lang) {
    // ë¬´í•œ ë£¨í”„ ë°©ì§€: ì´ë¯¸ ì–¸ì–´ ë³€ê²½ì´ ì§„í–‰ ì¤‘ì´ë©´ ì¤‘ë‹¨
    var changingFlag = safeSessionStorageGet('langChanging');
    if (changingFlag === 'true') {
      return;
    }
    
    // ì–¸ì–´ ë³€ê²½ ì‹œì‘ í”Œë˜ê·¸ ì„¤ì •
    safeSessionStorageSet('langChanging', 'true');
    
    if (lang === 'ko') {
      // í•œêµ­ì–´ë¡œ ë³µê·€: ì¿ í‚¤ ì‚­ì œ
      deleteCookie('googtrans');
      safeSessionStorageSet('langChanging', 'false');
      safeSessionStorageSet('langApplied', 'true');

      // ì¿ í‚¤ ì‚­ì œ í›„ ì§§ì€ ì§€ì—° í›„ ë¦¬ë¡œë“œ
      setTimeout(function() {
        location.reload();
      }, 150);
      return;
    }

    // ë‹¤ë¥¸ ì–¸ì–´ë¡œ ë³€ê²½: ì¿ í‚¤ ì„¤ì •
    var cookieVal = '/ko/' + lang;
    var cookieSet = setCookie('googtrans', cookieVal, 365);

    // ë²„íŠ¼ í…ìŠ¤íŠ¸ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (reload ì „ì—ë„ ë°˜ì˜)
    var currentLangSpan = document.getElementById('current-lang');
    if (LANG_MAP[lang] && currentLangSpan) {
      currentLangSpan.textContent = LANG_MAP[lang];
    }

    // ì¿ í‚¤ ì„¤ì • ì‹¤íŒ¨ ì‹œì—ë„ ê³„ì† ì§„í–‰ (ì‹œí¬ë¦¿ ëª¨ë“œì—ì„œë„ ì‘ë™í•˜ë„ë¡)
    var select = document.querySelector('.goog-te-combo');
    if (select && translateScriptLoaded) {
      try {
        select.value = lang;
        var changeEvent = new Event('change', { bubbles: true });
        select.dispatchEvent(changeEvent);
        
        // ì–¸ì–´ ë³€ê²½ ì™„ë£Œ í”Œë˜ê·¸ ì„¤ì •
        safeSessionStorageSet('langChanging', 'false');
        safeSessionStorageSet('langApplied', 'true');
        
        // Google Translateê°€ ì¦‰ì‹œ ë°˜ì˜í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì§§ì€ ì§€ì—° í›„ í™•ì¸
        setTimeout(function() {
          var currentLangAfterChange = getCurrentLang();
          if (currentLangAfterChange !== lang) {
            // ë³€ê²½ì´ ë°˜ì˜ë˜ì§€ ì•Šì•˜ìœ¼ë©´ ë¦¬ë¡œë“œ
            location.reload();
          }
        }, 500);
      } catch (e) {
        // ì´ë²¤íŠ¸ ë””ìŠ¤íŒ¨ì¹˜ ì‹¤íŒ¨ ì‹œ ë¦¬ë¡œë“œ
        setTimeout(function() {
          location.reload();
        }, 150);
      }
    } else {
      // ì¿ í‚¤ ì„¤ì • í›„ ì§§ì€ ì§€ì—° í›„ ë¦¬ë¡œë“œ (ì¿ í‚¤ê°€ í™•ì‹¤íˆ ì„¤ì •ë˜ë„ë¡)
      safeSessionStorageSet('langChanging', 'false');
      safeSessionStorageSet('langApplied', 'true');
      setTimeout(function() {
        location.reload();
      }, 150);
    }
  }

  // Google Translateê°€ ì‚½ì…í•œ font íƒœê·¸ ì œê±° (lang ì˜µì…˜ UI ê¹¨ì§ ë°©ì§€)
  function cleanupFontTags() {
    var selectors = [
      '.notranslate font',
      '[translate="no"] font',
      '.lang-toggle-wrapper font',
      '.lang-toggle font',
      '.lang-code font',
      '.lang-dropdown font',
      '.lang-option font',
      '.chat-widget font'
    ];

    selectors.forEach(function(selector) {
      var fonts = document.querySelectorAll(selector);
      fonts.forEach(function(font) {
        var parent = font.parentNode;
        while (font.firstChild) {
          parent.insertBefore(font.firstChild, font);
        }
        parent.removeChild(font);
      });
    });
  }

  // Google Translate select ìš”ì†Œì— id/name ì†ì„± ì¶”ê°€ (ì ‘ê·¼ì„± ë° autofill ê°œì„ )
  function addAttributesToTranslateSelect() {
    var select = document.querySelector('.goog-te-combo');
    if (select) {
      if (!select.id) {
        select.id = 'google-translate-select';
      }
      if (!select.name) {
        select.name = 'google-translate-language';
      }
      if (!select.getAttribute('aria-label')) {
        select.setAttribute('aria-label', 'ë²ˆì—­ ì–¸ì–´ ì„ íƒ');
      }
    }
  }

  // lang-dropdownê³¼ lang-option êµ¬ì¡° ë³µêµ¬
  function restoreLangStructure() {
    var langDropdown = document.getElementById('lang-dropdown');
    if (!langDropdown) return;

    // lang-dropdownì— ì§ì ‘ ì¶”ê°€ëœ í…ìŠ¤íŠ¸ ë…¸ë“œ ì œê±°
    var childNodes = Array.from(langDropdown.childNodes);
    childNodes.forEach(function(node) {
      if (node.nodeType === Node.TEXT_NODE && node.textContent.trim()) {
        // í…ìŠ¤íŠ¸ ë…¸ë“œê°€ ìˆê³  ë²„íŠ¼ì´ ì•„ë‹Œ ê²½ìš° ì œê±°
        langDropdown.removeChild(node);
      }
    });

    // lang-option êµ¬ì¡° ë³µêµ¬ (Google Translate font/span íŒŒê´´ ì‹œ data-lang ê¸°ë°˜ ë³µì›)
    var langOptions = document.querySelectorAll('.lang-option');
    langOptions.forEach(function(option) {
      var hasFlag = option.querySelector('.lang-flag');
      var hasName = option.querySelector('.lang-name');
      if (hasFlag && hasName) return;

      var dataLang = option.getAttribute('data-lang');
      var flag = '';
      var name = '';

      if (dataLang && LANG_LABELS[dataLang]) {
        flag = LANG_LABELS[dataLang].flag;
        name = LANG_LABELS[dataLang].name;
      } else {
        var textContent = option.textContent.trim();
        var flagMatch = textContent.match(/[\u{1F1E6}-\u{1F1FF}]{2}/u);
        flag = flagMatch ? flagMatch[0] : '';
        name = textContent.replace(/[\u{1F1E6}-\u{1F1FF}]{2}\s*/u, '').trim();
      }

      while (option.firstChild) option.removeChild(option.firstChild);

      if (flag) {
        var flagSpan = document.createElement('span');
        flagSpan.className = 'lang-flag';
        flagSpan.textContent = flag;
        option.appendChild(flagSpan);
      }
      if (name) {
        var nameSpan = document.createElement('span');
        nameSpan.className = 'lang-name';
        nameSpan.textContent = name;
        option.appendChild(nameSpan);
      }
    });
  }

  // Google Translate ë°°ë„ˆ/íŒì—… ê°•ì œ ìˆ¨ê¹€ ë° CLS ë°©ì§€
  function hideGoogleTranslateBanner() {
    var banners = document.querySelectorAll(
      '.goog-te-banner-frame, [class*="VIpgJd"], #goog-gt-tt, .goog-te-balloon-frame, .goog-te-menu-frame'
    );
    banners.forEach(function(el) {
      // CLS ë°©ì§€ë¥¼ ìœ„í•œ ê°•ë ¥í•œ ìŠ¤íƒ€ì¼ ì ìš©
      el.style.setProperty('display', 'none', 'important');
      el.style.setProperty('visibility', 'hidden', 'important');
      el.style.setProperty('position', 'fixed', 'important');
      el.style.setProperty('top', '0', 'important');
      el.style.setProperty('left', '0', 'important');
      el.style.setProperty('width', '0', 'important');
      el.style.setProperty('height', '0', 'important');
      el.style.setProperty('overflow', 'hidden', 'important');
      el.style.setProperty('opacity', '0', 'important');
      el.style.setProperty('z-index', '-1', 'important');
      el.style.setProperty('contain', 'strict', 'important');
    });

    if (document.body) {
      document.body.style.top = '0';
      document.body.style.position = 'static';
    }
  }
  
  // Google Translate ìœ„ì ¯ ë™ì  ì¶”ê°€ ê°ì§€ ë° CLS ë°©ì§€
  function preventGoogleTranslateCLS() {
    if ('MutationObserver' in window) {
      var observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
          mutation.addedNodes.forEach(function(node) {
            if (node.nodeType === 1) { // Element node
              // VIpgJd í´ë˜ìŠ¤ë¥¼ ê°€ì§„ ìš”ì†Œ ê°ì§€
              if (node.classList && node.classList.toString().includes('VIpgJd')) {
                hideGoogleTranslateBanner();
              }
              // í•˜ìœ„ì— ìˆëŠ” Google Translate ìš”ì†Œë„ ì²˜ë¦¬
              var translateElements = node.querySelectorAll && node.querySelectorAll(
                '[class*="VIpgJd"], .goog-te-banner-frame, #goog-gt-tt, .goog-te-balloon-frame'
              );
              if (translateElements && translateElements.length > 0) {
                hideGoogleTranslateBanner();
              }
            }
          });
        });
      });
      
      observer.observe(document.body, {
        childList: true,
        subtree: true,
        attributes: true,
        attributeFilter: ['class']
      });
    }
  }

  // DOM ì¤€ë¹„ ì‹œ ì´ˆê¸°í™”
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
      // í˜ì´ì§€ ë¡œë“œ í›„ ì§§ì€ ì§€ì—°ìœ¼ë¡œ ì–¸ì–´ ì ìš© (ì¿ í‚¤ê°€ í™•ì‹¤íˆ ì½íˆë„ë¡)
      setTimeout(function() {
        initLangToggle();
        cleanupFontTags();
        restoreLangStructure();
        hideGoogleTranslateBanner();
        addAttributesToTranslateSelect();
        preventGoogleTranslateCLS(); // CLS ë°©ì§€ ê°ì‹œ ì‹œì‘
      }, 100);
    });
  } else {
    // í˜ì´ì§€ ë¡œë“œ í›„ ì§§ì€ ì§€ì—°ìœ¼ë¡œ ì–¸ì–´ ì ìš© (ì¿ í‚¤ê°€ í™•ì‹¤íˆ ì½íˆë„ë¡)
    setTimeout(function() {
      initLangToggle();
      cleanupFontTags();
      restoreLangStructure();
      hideGoogleTranslateBanner();
      addAttributesToTranslateSelect();
      preventGoogleTranslateCLS(); // CLS ë°©ì§€ ê°ì‹œ ì‹œì‘
    }, 100);
  }

  // ì£¼ê¸°ì ìœ¼ë¡œ ì •ë¦¬ ì‹¤í–‰ (ê°„ê²© ëŠ˜ë¦¼ - ì„±ëŠ¥ ìµœì í™”)
  setInterval(function() {
    cleanupFontTags();
    restoreLangStructure();
    hideGoogleTranslateBanner();
    addAttributesToTranslateSelect();
  }, 2000);

  // Google Translate select ìš”ì†Œê°€ ë™ì ìœ¼ë¡œ ìƒì„±ë  ë•Œ ì†ì„± ì¶”ê°€ (MutationObserver)
  if ('MutationObserver' in window) {
    var observer = new MutationObserver(function(mutations) {
      addAttributesToTranslateSelect();
    });
    
    observer.observe(document.body, {
      childList: true,
      subtree: true
    });
  }

  // í•œêµ­ì–´ ì‚¬ì´íŠ¸ì´ê³  ì‹œìŠ¤í…œ ì–¸ì–´ë„ í•œêµ­ì–´ë©´ ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© ì•ˆí•¨
  // ë‹¤ë¥¸ ì–¸ì–´ë©´ í•„ìš”ì‹œ ë¡œë”©
  var sysLang = getSystemLanguage();
  var currentLang = getCurrentLang();

  // ë²ˆì—­ì´ í•„ìš”í•œ ê²½ìš°ì—ë§Œ ìŠ¤í¬ë¦½íŠ¸ ë¡œë”©
  if (sysLang !== 'ko' || currentLang !== 'ko') {
    // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ í›„ ì§€ì—° ë¡œë”©
    if (document.readyState === 'complete') {
      setTimeout(loadTranslateScript, 100);
    } else {
      window.addEventListener('load', function() {
        setTimeout(loadTranslateScript, 100);
      });
    }
  }
})();
</script>
