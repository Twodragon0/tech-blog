<footer class="site-footer">
  <div class="container">
    <div class="footer-inner">
      <div class="footer-newsletter">
        <p class="newsletter-title">Subscribe to Newsletter</p>
        <p class="newsletter-desc">Get the latest DevSecOps insights delivered to your inbox</p>
        <a href="https://buttondown.com/twodragon" target="_blank" rel="noopener noreferrer" class="newsletter-btn">
          Subscribe Free
        </a>
      </div>
      
      <nav class="footer-links" role="navigation" aria-label="소셜 링크">
        {% if site.author.github %}
        <a href="https://github.com/{{ site.author.github }}" target="_blank" rel="noopener noreferrer" aria-label="GitHub 프로필 열기">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
          </svg>
        </a>
        {% endif %}
        {% if site.author.linkedin %}
        <a href="https://linkedin.com/in/{{ site.author.linkedin }}" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn 프로필 열기">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/>
          </svg>
        </a>
        {% endif %}
        <a href="{{ "/feed.xml" | relative_url }}" aria-label="RSS 피드" type="application/rss+xml">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20C5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27V4.44m0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93V10.1z"/>
          </svg>
        </a>
        <a href="mailto:{{ site.author.email }}" aria-label="이메일 보내기">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
            <polyline points="22,6 12,13 2,6"/>
          </svg>
        </a>
      </nav>

      <p class="footer-copyright">
        &copy; {{ site.time | date: '%Y' }} {{ site.author.name }}. Built with Jekyll.
      </p>
    </div>
  </div>
</footer>

<!-- Core JavaScript (모든 페이지에서 로드) -->
<script src="{{ "/assets/js/main-core.js" | relative_url }}?v={{ site.time | date: '%Y%m%d%H%M' }}" defer></script>

<!-- Post-specific JavaScript (포스트 페이지에서만 로드) -->
{% if page.layout == 'post' %}
<script src="{{ "/assets/js/main-post.js" | relative_url }}?v={{ site.time | date: '%Y%m%d%H%M' }}" defer></script>
<script src="{{ "/assets/js/post-page.js" | relative_url }}?v={{ site.time | date: '%Y%m%d%H%M' }}" defer></script>
<script src="{{ "/assets/js/share-actions.js" | relative_url }}?v={{ site.time | date: '%Y%m%d%H%M' }}" defer></script>
{% endif %}

<!-- WebP auto-replace for browsers that support it (saves ~75% on PNG images) -->
<script>
(function() {
  if (!self.createImageBitmap) return;
  var webpTest = new Image();
  webpTest.onload = function() {
    document.querySelectorAll('img[src$=".png"]').forEach(function(img) {
      var src = img.getAttribute('src');
      if (src && !src.includes('/og/')) {
        var webpSrc = src.replace(/\.png$/, '.webp');
        var test = new Image();
        test.onload = function() { img.src = webpSrc; };
        test.src = webpSrc;
      }
    });
  };
  webpTest.src = 'data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiTjt7REA';
})();
</script>

<!-- Search & Translation JavaScript (지연 로드) -->
<script>
  // Search input focus 시 지연 로드
  (function() {
    'use strict';
    const searchInput = document.getElementById('search-input');
    if (searchInput) {
      let searchScriptLoaded = false;
      const loadSearchScript = function() {
        if (searchScriptLoaded) return;
        searchScriptLoaded = true;
        const script = document.createElement('script');
        script.src = "{{ "/assets/js/main-search.js" | relative_url }}?v={{ site.time | date: '%Y%m%d%H%M' }}";
        script.defer = true;
        script.onerror = function() {
          console.warn('[Search] Failed to load search script');
          searchScriptLoaded = false;
        };
        document.body.appendChild(script);
      };
      // 검색 입력 포커스 시 로드
      searchInput.addEventListener('focus', loadSearchScript, { once: true, passive: true });
      // 또는 페이지 로드 후 3초 뒤 지연 로드 (사용자가 아직 페이지에 있는 경우)
      setTimeout(function() {
        if (document.visibilityState === 'visible' && !searchScriptLoaded) {
          if (typeof requestIdleCallback !== 'undefined') {
            requestIdleCallback(loadSearchScript, { timeout: 2000 });
          } else {
            setTimeout(loadSearchScript, 0);
          }
        }
      }, 3000);
    }
  })();
</script>

<!-- Vercel Analytics & Speed Insights (페이지 하단에서 로드, 에러 핸들링 포함) -->
<script>
  // Vercel Analytics & Speed Insights 로드 (에러 핸들링 + 샘플링 포함)
  (function() {
    // 프로덕션 환경에서만 로드
    if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
      return; // 개발 환경에서는 로드하지 않음
    }

    // 10% 샘플링 (Free tier 최적화)
    var shouldSample = Math.random() < 0.1;

    // Analytics 스크립트 로드 (샘플링 적용 안 함 - 페이지뷰 추적은 유지)
    var analyticsScript = document.createElement('script');
    analyticsScript.defer = true;
    analyticsScript.src = 'https://va.vercel-scripts.com/v1/script.js';
    analyticsScript.onerror = function() {
      // Analytics 로드 실패는 조용히 처리 (Rate Limiting, 네트워크 문제 등)
    };
    document.head.appendChild(analyticsScript);

    // Speed Insights 스크립트 로드 (샘플링 적용 - vitals만 전송)
    if (shouldSample) {
      var speedInsightsScript = document.createElement('script');
      speedInsightsScript.defer = true;
      speedInsightsScript.src = 'https://va.vercel-scripts.com/v1/speed-insights/script.js';
      speedInsightsScript.onerror = function() {
        // Speed Insights 로드 실패는 조용히 처리 (429 Rate Limiting 등)
      };
      document.head.appendChild(speedInsightsScript);
    }
  })();
</script>

<!-- Cloudflare Web Analytics (무료, 프라이버시 친화적) -->
<!-- 
  Cloudflare Web Analytics 활성화 방법:
  1. Cloudflare 대시보드 → Analytics & Logs → Web Analytics
  2. Add a site → tech.2twodragon.com
  3. 생성된 토큰을 아래 YOUR_CLOUDFLARE_BEACON_TOKEN에 입력
  4. 주석 해제
  
  특징:
  - 무료 (제한 없음)
  - 프라이버시 친화적 (쿠키 없음, 개인정보 수집 안 함)
  - Core Web Vitals 측정
  - 실시간 분석
-->
{% if site.cloudflare_analytics_token %}
<script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "{{ site.cloudflare_analytics_token }}"}'></script>
{% endif %}
